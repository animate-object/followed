(this.webpackJsonpfollowed=this.webpackJsonpfollowed||[]).push([[0],{15:function(n,t,e){n.exports={root:"Cell_root__2ti8K",empty:"Cell_empty__1ByI9",seen:"Cell_seen__2qSTX",visible:"Cell_visible__2bnT3",unknown:"Cell_unknown__2tYkG"}},25:function(n,t,e){n.exports={root:"Grid_root__xSU_B",row:"Grid_row__1rWaL"}},29:function(n,t){},30:function(n,t,e){n.exports={app:"index_app__2lpzC","measuring-stick":"index_measuring-stick__FyhfK",top:"index_top__34qoI",game:"index_game__3FHco",chat:"index_chat__3dkmg",pad:"index_pad__2WSol",bottom:"index_bottom__2ZcVO"}},31:function(n,t,e){n.exports={root:"App_root__ZxxJN"}},34:function(n,t,e){n.exports={root:"Entity_root__MaGTf"}},39:function(n,t,e){n.exports={root:"Chat_root__2csEn"}},43:function(n,t,e){n.exports=e(56)},56:function(n,t,e){"use strict";e.r(t);var r={};e.r(r),e.d(r,"maze",(function(){return Y}));var a={};e.r(a),e.d(a,"nOf",(function(){return V})),e.d(a,"sorted",(function(){return B})),e.d(a,"nonNull",(function(){return Q})),e.d(a,"randomItem",(function(){return K}));var i={};e.r(i),e.d(i,"randomInRange",(function(){return q}));var o={};e.r(o),e.d(o,"centerOnPoint",(function(){return J}));var c={};e.r(c),e.d(c,"getSiteSetting",(function(){return Z}));var u={};e.r(u),e.d(u,"parseQuery",(function(){return nn}));var s={};e.r(s),e.d(s,"create",(function(){return tn})),e.d(s,"area",(function(){return en})),e.d(s,"randomPoint",(function(){return rn})),e.d(s,"pointAlongEdge",(function(){return an})),e.d(s,"inBounds",(function(){return on}));var d={};e.r(d),e.d(d,"fromApi",(function(){return cn})),e.d(d,"randomDirectionalOptions",(function(){return un}));var f={};e.r(f),e.d(f,"fromMazeData",(function(){return ln})),e.d(f,"canWalk",(function(){return pn})),e.d(f,"canTravel",(function(){return mn})),e.d(f,"lookInDirection",(function(){return yn})),e.d(f,"peekableCorners",(function(){return En})),e.d(f,"seenFromPoint",(function(){return vn})),e.d(f,"takeDeadEnd",(function(){return bn})),e.d(f,"deadEnds",(function(){return On})),e.d(f,"placeEntitiesInDeadEnds",(function(){return hn}));var l={};e.r(l),e.d(l,"isLoading",(function(){return gn})),e.d(l,"isLoaded",(function(){return wn})),e.d(l,"isErrored",(function(){return Tn})),e.d(l,"loading",(function(){return xn})),e.d(l,"loaded",(function(){return Sn})),e.d(l,"errored",(function(){return jn})),e.d(l,"map",(function(){return kn}));var p={};e.r(p),e.d(p,"create",(function(){return Mn}));var m={};e.r(m),e.d(m,"create",(function(){return An})),e.d(m,"randomDisplayName",(function(){return Dn}));var y={};e.r(y),e.d(y,"EntityClass",(function(){return I}));var E={};e.r(E),e.d(E,"fromEntities",(function(){return Nn})),e.d(E,"entitiesAtPoint",(function(){return Rn})),e.d(E,"getPlayer",(function(){return Ln})),e.d(E,"byId",(function(){return Cn})),e.d(E,"byType",(function(){return Wn})),e.d(E,"moveEntity",(function(){return Un})),e.d(E,"removeEntity",(function(){return zn})),e.d(E,"updateEntity",(function(){return Hn})),e.d(E,"entitiesCrossed",(function(){return Gn})),e.d(E,"neighborsCrossedByEntity",(function(){return Yn}));var v={};e.r(v),e.d(v,"create",(function(){return Fn})),e.d(v,"lookForEntityInDirection",(function(){return Vn})),e.d(v,"displayGrid",(function(){return Bn})),e.d(v,"generateAllAIInstructions",(function(){return Qn}));var b={};e.r(b),e.d(b,"win",(function(){return Kn})),e.d(b,"lose",(function(){return qn})),e.d(b,"play",(function(){return Jn})),e.d(b,"won",(function(){return Zn})),e.d(b,"lost",(function(){return Xn})),e.d(b,"playing",(function(){return $n}));var O={};e.r(O),e.d(O,"create",(function(){return nt})),e.d(O,"toIndex",(function(){return tt})),e.d(O,"fromIndex",(function(){return et})),e.d(O,"neighbor",(function(){return rt})),e.d(O,"neighbors",(function(){return at})),e.d(O,"diagonalNeighbors",(function(){return it})),e.d(O,"equals",(function(){return ot}));var h={};e.r(h),e.d(h,"move",(function(){return ut})),e.d(h,"update",(function(){return dt})),e.d(h,"wait",(function(){return ft})),e.d(h,"updateGameState",(function(){return lt})),e.d(h,"see",(function(){return pt})),e.d(h,"remove",(function(){return mt})),e.d(h,"validate",(function(){return yt})),e.d(h,"validateAll",(function(){return Et})),e.d(h,"apply",(function(){return vt})),e.d(h,"applyAll",(function(){return bt}));var g={};e.r(g),e.d(g,"create",(function(){return Ot})),e.d(g,"knowing",(function(){return ht})),e.d(g,"DISPLAY",(function(){return gt}));var w={};e.r(w),e.d(w,"getColor",(function(){return wt})),e.d(w,"getDisplayName",(function(){return Tt})),e.d(w,"getDescription",(function(){return xt})),e.d(w,"generateAiInstructions",(function(){return St})),e.d(w,"onCollideWithPlayer",(function(){return jt})),e.d(w,"getKillMessage",(function(){return kt}));var T={};e.r(T),e.d(T,"create",(function(){return _t})),e.d(T,"next",(function(){return Mt})),e.d(T,"DISPLAY",(function(){return At}));var x={};e.r(x),e.d(x,"create",(function(){return Dt})),e.d(x,"next",(function(){return It})),e.d(x,"wander",(function(){return Pt})),e.d(x,"lookForPlayerInDirection",(function(){return Nt})),e.d(x,"DISPLAY",(function(){return Rt}));var S={};e.r(S),e.d(S,"create",(function(){return Lt})),e.d(S,"DISPLAY",(function(){return Ct}));var j={};e.r(j),e.d(j,"create",(function(){return Wt})),e.d(j,"next",(function(){return Ut})),e.d(j,"DISPLAY",(function(){return zt}));var k={};e.r(k),e.d(k,"create",(function(){return Ht}));var _={};e.r(_),e.d(_,"Direction",(function(){return ct})),e.d(_,"all",(function(){return Yt})),e.d(_,"inverse",(function(){return Ft})),e.d(_,"random",(function(){return Vt}));var M={};e.r(M),e.d(M,"ok",(function(){return Bt})),e.d(M,"err",(function(){return Qt})),e.d(M,"isErr",(function(){return Kt})),e.d(M,"isOk",(function(){return qt})),e.d(M,"map",(function(){return Jt}));var A={};e.r(A),e.d(A,"of",(function(){return Zt})),e.d(A,"none",(function(){return Xt})),e.d(A,"withDefault",(function(){return $t})),e.d(A,"map",(function(){return ne})),e.d(A,"ifPresent",(function(){return te}));var D={};e.r(D),e.d(D,"create",(function(){return ee})),e.d(D,"instructions",(function(){return re})),e.d(D,"phenomena",(function(){return ae}));var I,P=e(1),N=e.n(P),R=e(19),L=e.n(R),C=e(30),W=e.n(C),U=e(31),z=e.n(U),H=e(16),G="https://fv9o21r19a.execute-api.us-east-1.amazonaws.com/dev",Y=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.dimension,e=void 0===t?s.create(10,10):t,r=n.algorithm,a=void 0===r?"aldous-broder":r,i=n.corner,o=n.direction,c=fetch("".concat(G),{method:"post",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify({dimensions:e,algorithm:a,corner:i,direction:o})});return c.then((function(n){return n.text()})).then((function(n){return d.fromApi(e,a,n)}))},F=e(4),V=function(n,t){return new Array(n).fill(t)},B=function(n,t){var e=Object(F.a)(n);return e.sort(t),e},Q=function(n){return n.filter((function(n){return null!=n}))},K=function(n){return n[Math.floor(Math.random()*n.length)]},q=function(n,t){return n+Math.floor(Math.random()*(t-n-1))},J=function(n,t,e){for(var r=t.x-e,a=t.x+e+1,i=t.y-e,o=t.y+e+1,c=[],u=i;u<o;u++){for(var s=[],d=function(t){s.push(A.map((function(n){return n[t]}),n[u]))},f=r;f<a;f++)d(f);c.push(s)}return c},Z=function(n,t){return A.withDefault(window.localStorage.getItem("".concat("followed.settings",".").concat(n)),(function(){var e=t();if(e)return window.localStorage.setItem("".concat("followed.settings",".").concat(n),e),e}))},X=e(10),$=e(3),nn=function(){return window.location.search.substring(1).split("&").reduce((function(n,t){var e=t.split("=");return Object($.a)({},n,Object(X.a)({},e[0],e[1]))}),{})},tn=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{width:n,height:t}},en=function(n){return n.width*n.height},rn=function(n){return O.fromIndex(Math.floor(Math.random()*en(n)),n)},an=function(n){var t=Math.random()>.5;return O.create(t?i.randomInRange(0,n.width):Math.random()>.5?0:n.width-1,t?Math.random()>.5?0:n.height-1:i.randomInRange(0,n.height))},on=function(n,t){return t.x>=0&&t.y>=0&&t.x<n.width&&t.y<n.height},cn=function(n,t,e){return{bytes:Uint8Array.from(atob(e),(function(n){return n.charCodeAt(0)})),dimension:n,algorithm:t}},un=function(){return{corner:a.randomItem(["nw","ne","sw","se"]),direction:a.randomItem(["n","e","s","w"])}},sn=e(21),dn=function(n){return{walls:(t={n:!((8&n)>0),s:!((4&n)>0),e:!((2&n)>0),w:!((1&n)>0)},{n:t.n||!1,e:t.e||!1,s:t.s||!1,w:t.w||!1})};var t},fn=function(n){var t=n.walls;return[t.n,t.e,t.s,t.w].filter((function(n){return!0===n})).length>=3},ln=function(n){for(var t=n.dimension,e=n.bytes,r=n.algorithm,a=[],i=[],o=0;o<t.height;o++){for(var c=[],u=0;u<t.width;u++){var s=dn(e[o*t.width+u]);c.push(s),fn(s)&&i.push(O.toIndex(O.create(u,o),t))}a.push(c)}return{grid:a,dimension:t,algorithm:r,deadends:{unused:i,used:[]}}},pn=function(n,t,e){var r=t.x,a=t.y;try{return!function(n,t){var e=n.walls;switch(t){case _.Direction.NORTH:return e.n;case _.Direction.EAST:return e.e;case _.Direction.SOUTH:return e.s;case _.Direction.WEST:return e.w}}(n.grid[a][r],e)}catch(i){return console.error(i),console.log({x:r,y:a}),alert("Well this is embarrasing. . . tried to walk from cell ".concat(r,", ").concat(a,".")),!1}},mn=function(n,t){for(var e=arguments.length,r=new Array(e>2?e-2:0),a=2;a<e;a++)r[a-2]=arguments[a];return!!r.reduce((function(t,e){return t&&pn(n,t,e)?O.neighbor(t,e):void 0}),t)},yn=function n(t,e,r,a){if(pn(t,r,e)&&a>0){var i=O.neighbor(r,e);return[i].concat(Object(F.a)(n(t,e,i,a-1)))}return[]},En=function(n,t){var e=[];return(mn(n,t,_.Direction.NORTH,_.Direction.EAST)||mn(n,t,_.Direction.EAST,_.Direction.NORTH))&&e.push(O.create(t.x+1,t.y-1)),(mn(n,t,_.Direction.NORTH,_.Direction.WEST)||mn(n,t,_.Direction.WEST,_.Direction.NORTH))&&e.push(O.create(t.x-1,t.y-1)),(mn(n,t,_.Direction.SOUTH,_.Direction.EAST)||mn(n,t,_.Direction.EAST,_.Direction.SOUTH))&&e.push(O.create(t.x+1,t.y+1)),(mn(n,t,_.Direction.SOUTH,_.Direction.WEST)||mn(n,t,_.Direction.WEST,_.Direction.SOUTH))&&e.push(O.create(t.x-1,t.y+1)),e},vn=function(n,t,e){return _.all().reduce((function(r,a){return r.concat(yn(n,a,t,e))}),[]).concat(En(n,t)).concat(t)},bn=function(n){var t=a.randomItem(n.deadends.unused);return t?[t,Object($.a)({},n,{deadends:{unused:n.deadends.unused.filter((function(n){return n!==t})),used:[].concat(Object(F.a)(n.deadends.used),[t])}})]:[-1,n]},On=function(n){return[].concat(Object(F.a)(n.deadends.used),Object(F.a)(n.deadends.unused))},hn=function(n,t){return t.reduce((function(n,t){var e,r,a=bn(n.maze),i=Object(sn.a)(a,2),o=i[0],c=i[1];return o?(e=[].concat(Object(F.a)(n.placed),[t(O.fromIndex(o,n.maze.dimension))]),r=Object(F.a)(n.unplaced)):(e=Object(F.a)(n.placed),r=[].concat(Object(F.a)(n.unplaced),[t(O.create(-1,-1))])),{maze:c,placed:e,unplaced:r}}),{maze:n,placed:[],unplaced:[]})},gn=function(n){return"Loading"===n.state},wn=function(n){return"Loaded"===n.state},Tn=function(n){return"Errored"===n.state},xn=function(){return{state:"Loading"}},Sn=function(n){return{state:"Loaded",data:n}},jn=function(n){return{state:"Errored",e:n}},kn=function(n,t){return wn(t)?Sn(n(t.data)):t},_n=e(33),Mn=function(){return Object(_n.v4)()},An=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.create(),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Dn();return{id:p.create(),name:n,position:t,type:"player",visionRadius:e,displayName:r||n,cls:y.EntityClass.PLAYER}},Dn=function(){return a.randomItem(["\ud83d\udc15","\ud83d\udc26","\ud83d\udc08","\ud83d\udc0e","\ud83d\udc16","\ud83d\udc01","\ud83d\udc00","\ud83d\udc22"])};!function(n){n.PLAYER="PLAYER",n.INANIMATE="INANIMATE",n.HOSTILE="HOSTILE",n.ITEM="ITEM"}(I||(I={}));var In,Pn,Nn=function(n,t){return{entityMap:n.reduce((function(n,t){return n[t.id]=t,n}),{}),positionMap:n.reduce((function(n,e){var r=O.toIndex(e.position,t);return n[r]=n[r]?[].concat(Object(F.a)(n[r]),[e.id]):[e.id],n}),{}),playerEntityId:A.map((function(n){return n.id}),n.find((function(n){return"player"===n.type}))),typeMap:n.reduce((function(n,t){return Object($.a)({},n,Object(X.a)({},t.type,n[t.type]?[].concat(Object(F.a)(n[t.type]),[t.id]):[t.id]))}),{})}},Rn=function(n,t,e){var r=O.toIndex(t,e);return(n.positionMap[r]||[]).map((function(t){return n.entityMap[t]}))},Ln=function(n){return A.map((function(t){return n.entityMap[t]}),n.playerEntityId)},Cn=function(n,t){return n.entityMap[t]},Wn=function(n,t){return a.nonNull(n.typeMap[t]||[]).map((function(t){return n.entityMap[t]}))},Un=function(n,t,e,r){var a=t.entityMap[n];if(null!=a){var i,o=O.toIndex(a.position,r),c=O.toIndex(e,r),u=Object($.a)({},a,{position:e});return Object($.a)({},t,{entityMap:Object($.a)({},t.entityMap,Object(X.a)({},n,u)),positionMap:Object($.a)({},t.positionMap,(i={},Object(X.a)(i,o,Object(F.a)((t.positionMap[o]||[]).filter((function(t){return t!==n})))),Object(X.a)(i,c,[].concat(Object(F.a)(t.positionMap[c]||[]),[n])),i))})}return t},zn=function(n,t,e){var r=t.entityMap[n],a=O.toIndex(r.position,e);return Object($.a)({},t,{entityMap:Object.keys(t.entityMap).reduce((function(e,r){return r!==n&&(e[r]=t.entityMap[r]),e}),{}),typeMap:Object.keys(t.typeMap).reduce((function(e,a){return a===r.type?e[a]=t.typeMap[a].filter((function(t){return t!==n})):e[a]=t.typeMap[a],e}),{}),positionMap:Object.keys(t.positionMap).map((function(n){return parseInt(n)})).reduce((function(e,r){return e[r]=r===a?t.positionMap[r].filter((function(t){return t!==n})):t.positionMap[r],e}),{})})},Hn=function(n,t){return Object($.a)({},t,{entityMap:Object($.a)({},t.entityMap,Object(X.a)({},n.id,n))})},Gn=function(n,t,e,r){var a=n.entityMap[e],i=n.entityMap[r],o=t.entityMap[e],c=t.entityMap[r];return O.equals(o.position,i.position)&&O.equals(c.position,a.position)},Yn=function(n,t,e,r){return O.neighbors(t.entityMap[e].position,r).map((function(n){return O.toIndex(n,r)})).reduce((function(n,e){return n.concat(t.positionMap[e]||[])}),[]).filter((function(r){return Gn(n,t,e,r)})).map((function(n){return t.entityMap[n]}))},Fn=function(n,t){var e=E.getPlayer(t),r=new Set(e?f.seenFromPoint(n,e.position,e.visionRadius).map((function(t){return O.toIndex(t,n.dimension)})):[]);return{maze:n,entityData:t,seen:new Set,sees:r,stepCount:0,state:b.play()}},Vn=function(n,t,e,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5;return f.lookInDirection(e.maze,n,t,a).reduce((function(n,t){return n||null!=E.entitiesAtPoint(e.entityData,t,e.maze.dimension).find(r)}),!1)},Bn=function(n){var t=n.maze,e=n.entityData,r=n.seen,a=n.sees;return t.grid.reduce((function(n,i,o){return[].concat(Object(F.a)(n),[i.reduce((function(n,i,c){var u=O.create(c,o),s=r.has(O.toIndex(u,t.dimension)),d=a.has(O.toIndex(u,t.dimension));return n.concat({cell:i,meta:{occupants:E.entitiesAtPoint(e,O.create(c,o),t.dimension),visible:d,seen:s,unknown:!d&&!s}})}),[])])}),[])},Qn=function(n){return Object.keys(n.entityData.entityMap).map((function(t){return E.byId(n.entityData,t)})).filter((function(n){return"player"!==n.type})).reduce((function(t,e){return t.concat(w.generateAiInstructions(e,n))}),[])},Kn=function(){return{type:"Won"}},qn=function(n){return{type:"Lost",causeOfDeath:n}},Jn=function(){return{type:"Playing"}},Zn=function(n){return"Won"===n.type},Xn=function(n){return"Lost"===n.type},$n=function(n){return"Playing"===n.type},nt=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{x:n,y:t}},tt=function(n,t){var e=n.x;return n.y*t.width+e},et=function(n,t){var e=t.width;return nt(n%e,Math.floor(n/e))},rt=function(n,t){switch(t){case"NORTH":return O.create(n.x,n.y-1);case"SOUTH":return O.create(n.x,n.y+1);case"EAST":return O.create(n.x+1,n.y);case"WEST":default:return O.create(n.x-1,n.y)}},at=function(n,t){return _.all().map((function(t){return rt(n,t)})).filter((function(n){return s.inBounds(t,n)}))},it=function(n,t){return[nt(n.x-1,n.y-1),nt(n.x+1,n.y-1),nt(n.x+1,n.y+1),nt(n.x-1,n.y+1)].filter((function(n){return s.inBounds(t,n)}))},ot=function(n,t){return n.x===t.x&&n.y===t.y};!function(n){n[n.FORGETTING=0]="FORGETTING",n.KNOW_DOOR_LOCATION="KNOW_DOOR_LOCATION"}(In||(In={})),function(n){n.MOVE="MOVE",n.UPDATE="UPDATE",n.WAIT="WAIT",n.UPDATE_GAME_STATE="UPDATE_GAME_STATE",n.SEE="SEE",n.REMOVE="REMOVE",n.ADD="ADD"}(Pn||(Pn={}));var ct,ut=function(n,t){return{type:Pn.MOVE,payload:{entityId:n,direction:t}}},st=function(n,t,e){var r=new Set(f.seenFromPoint(e,t.position,t.visionRadius).map((function(n){return O.toIndex(n,e.dimension)})));return{sees:r,seen:new Set([].concat(Object(F.a)(n),Object(F.a)(r)))}},dt=function(n){return{type:Pn.UPDATE,payload:{updated:n}}},ft=function(n){return{type:Pn.WAIT,payload:{entityId:n}}},lt=function(n){return{type:Pn.UPDATE_GAME_STATE,payload:{updated:n}}},pt=function(n){return{type:Pn.SEE,payload:n}},mt=function(n){return{type:Pn.REMOVE,payload:n}},yt=function(n,t){switch(n.type){case Pn.MOVE:return function(n,t){var e=n.payload;return f.canWalk(t.maze,t.entityData.entityMap[e.entityId].position,e.direction)?M.ok(void 0):M.err("way is blocked")}(n,t);case Pn.WAIT:return M.ok(void 0);default:return M.err("Unkown instruction of type ".concat(n.type))}},Et=function(n,t){return n.reduce((function(n,e){return M.isOk(n)?yt(e,t):n}),M.ok(void 0))},vt=function(n,t){try{switch(n.type){case Pn.MOVE:return M.ok(function(n,t){var e=n.payload,r=e.entityId,a=e.direction,i=E.moveEntity(r,t.entityData,O.neighbor(t.entityData.entityMap[r].position,a),t.maze.dimension),o=E.getPlayer(i),c=o&&r===o.id?st(t.seen,o,t.maze):t,u=c.seen,s=c.sees;return Object($.a)({},t,{seen:u,sees:s,entityData:i})}(n,t));case Pn.UPDATE:return M.ok(function(n,t){return Object($.a)({},t,{entityData:E.updateEntity(n.payload.updated,t.entityData)})}(n,t));case Pn.WAIT:return M.ok(function(n,t){return Object($.a)({},t)}(0,t));case Pn.UPDATE_GAME_STATE:return M.ok(function(n,t){return Object($.a)({},t,{state:b.lost(t.state)?t.state:n.payload.updated})}(n,t));case Pn.SEE:return M.ok(function(n,t){return Object($.a)({},t,{seen:new Set([].concat(Object(F.a)(t.seen),Object(F.a)(n.payload)))})}(n,t));case Pn.REMOVE:return M.ok(function(n,t){return Object($.a)({},t,{entityData:E.removeEntity(n.payload,t.entityData,t.maze.dimension)})}(n,t))}}catch(e){return console.warn("Error applying instruction",n),console.error(e),M.err("Error applying instructions")}},bt=function(n,t){return n.reduce((function(n,t){return M.isOk(n)?vt(t,n.data):n}),M.ok(t))},Ot=function(n){var t=function(n){return{id:p.create(),cls:I.ITEM,position:n}}(n);return Object($.a)({},t,{type:"orb-of-knowing",phenomena:ht(t.id),instruction:[]})},ht=function(n){return{name:In.KNOW_DOOR_LOCATION,duration:1,fn:function(t){return alert("You feel enlightened by the forces of providence.\nFor in thine posession is the Orb of Knowing."),[].concat(Object(F.a)(Wn(t.entityData,"exit").map((function(n){return n})).map((function(n){return tt(n.position,t.maze.dimension)})).map((function(n){return pt([n])}))),[mt(n)])}}},gt="\u3299\ufe0f",wt=function(n){return n.type,"transparent"},Tt=function(n){switch(n.type){case"player":return n.displayName;case"blind-guardian":return T.DISPLAY;case"exit":return S.DISPLAY;case"wandering-husk":return x.DISPLAY;case"orb-of-knowing":return g.DISPLAY;case"sinister-dolls":return j.DISPLAY}},xt=function(n){switch(n.type){case"player":return n.name;case"blind-guardian":return"a blind guardian";case"exit":return"an exit";case"wandering-husk":return"a wandering husk";case"orb-of-knowing":return"a mysterious, translucent orb";case"sinister-dolls":return"two lifelike dolls"}},St=function(n,t){switch(n.type){case"blind-guardian":return T.next(n,t);case"wandering-husk":return x.next(n,t);case"sinister-dolls":return j.next(n,t);default:return[]}},jt=function(n,t){return n.cls===I.HOSTILE?D.create([h.updateGameState(b.lose({entityId:n.id}))]):n.cls===I.ITEM?D.create(void 0,[n.phenomena]):"exit"===n.type?D.create([h.updateGameState(b.win())]):D.create()},kt=function(n,t){switch(t.type){case"blind-guardian":return"".concat(n.name," has been annihilated by ").concat(xt(t),". Nothing is left.");case"wandering-husk":return"Blood and sinew cling to the maw of the wandering husk. ".concat(n.name," has been consumed.");case"sinister-dolls":return"The dolls draw closer. ".concat(n.name," is frozen. Then, darkness. ").concat(n.name," is never heard from again.");default:return"".concat(n.name," was killed by ").concat(xt(t))}},_t=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.create();return{type:"blind-guardian",position:n,id:p.create(),heading:_.Direction.NORTH,cls:y.EntityClass.HOSTILE}},Mt=function(n,t){var e,r=_.all().filter((function(e){return f.canWalk(t.maze,n.position,e)})),i=r.filter((function(t){return t!==_.inverse(n.heading)}));return e=r.includes(n.heading)&&Math.random()<.75?n.heading:Math.random()<.75&&i.length>0?a.randomItem(i):r[0],[h.update(Object($.a)({},n,{heading:e})),h.move(n.id,e)]},At="\ud83d\uddff",Dt=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.create();return{type:"wandering-husk",position:n,id:p.create(),heading:_.random(),cls:y.EntityClass.HOSTILE}},It=function(n,t){var e,r=_.all().reduce((function(e,r){return e||(Nt(r,n.position,t)?r:void 0)}),void 0),a=[];return r?Math.random()<.9?(e=r,a.push(h.move(n.id,e))):(e=n.heading,a.push(h.wait(n.id))):(e=Pt(n,t),a.push(h.move(n.id,e))),[h.update(Object($.a)({},n,{heading:e}))].concat(a)},Pt=function(n,t){var e=_.all().filter((function(e){return f.canWalk(t.maze,n.position,e)})),r=e.filter((function(t){return t!==_.inverse(n.heading)}));return e.includes(n.heading)&&Math.random()<.75?n.heading:Math.random()<.75&&r.length>0?a.randomItem(r):e[0]},Nt=function(n,t,e){return f.lookInDirection(e.maze,n,t,5).reduce((function(n,t){return n||null!=E.entitiesAtPoint(e.entityData,t,e.maze.dimension).find((function(n){return"player"===n.type}))}),!1)},Rt="\ud83e\udddf",Lt=function(n){return{position:n,id:p.create(),type:"exit",cls:y.EntityClass.INANIMATE}},Ct="\ud83d\udeaa",Wt=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.create();return{type:"sinister-dolls",position:n,id:p.create(),cls:y.EntityClass.HOSTILE}},Ut=function(n,t){var e=_.all().reduce((function(e,r){return e||(Vn(r,n.position,t,(function(n){return"player"===n.type}))?r:void 0)}),void 0);return e&&Math.random()<.9?[h.move(n.id,e)]:[]},zt="\ud83c\udf8e",Ht=function(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];return{instructions:t,id:p.create()}};!function(n){n.NORTH="NORTH",n.SOUTH="SOUTH",n.EAST="EAST",n.WEST="WEST"}(ct||(ct={}));var Gt,Yt=function(){return[ct.NORTH,ct.SOUTH,ct.EAST,ct.WEST]},Ft=function(n){switch(n){case ct.NORTH:return ct.SOUTH;case ct.SOUTH:return ct.NORTH;case ct.EAST:return ct.WEST;case ct.WEST:return ct.EAST}},Vt=function(){return K(Yt())},Bt=function(n){return{type:"Ok",data:n}},Qt=function(n){return{type:"Error",msg:n}},Kt=function(n){return"Error"===n.type},qt=function(n){return"Ok"===n.type},Jt=function(n,t){return qt(t)?Bt(n(t.data)):t},Zt=(e(29),function(n){return n}),Xt=function(){},$t=function(n,t){return null!=n?n:"function"===typeof t?t():t},ne=function(n,t){return null!=t?n(t):void 0},te=function(n,t){t&&n(t)},ee=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{instructions:n,phenomena:t}},re=function(n){return n.reduce((function(n,t){return[].concat(Object(F.a)(n),Object(F.a)(t.instructions))}),[])},ae=function(n){return n.reduce((function(n,t){return[].concat(Object(F.a)(n),Object(F.a)(t.phenomena))}),[])},ie=e(17),oe=function(n){return n},ce=Object(ie.a)(oe,(function(n){return n.game})),ue=Object(ie.a)(ce,(function(n){return l.map(v.displayGrid,n)})),se=Object(ie.a)(oe,(function(n){return null!=n.stepId})),de=Object(ie.a)(ce,(function(n){return l.isLoaded(n)?A.map((function(t){return n.data.entityData.entityMap[t]}),n.data.entityData.playerEntityId):void 0})),fe=Object(ie.a)(ue,de,(function(n,t){return l.map((function(n){return null!=t?o.centerOnPoint(n,t.position,3):[]}),n)})),le=e(15),pe=e.n(le),me=e(18),ye=e.n(me),Ee=e(34),ve=e.n(Ee),be=function(n){return N.a.createElement("div",{className:ve.a.root},w.getDisplayName(n))},Oe=function(n){return n?"0.5px solid cyan":"0.5px transparent"},he=function(n){var t,e=n.cell,r=n.meta,a=e.walls;return N.a.createElement("div",{className:ye()(pe.a.root,(t={},Object(X.a)(t,pe.a.seen,r.seen),Object(X.a)(t,pe.a.visible,r.visible),Object(X.a)(t,pe.a.unknown,!r.seen&&!r.visible),t)),style:r.unknown?void 0:{borderTop:Oe(a.n),borderRight:Oe(a.e),borderBottom:Oe(a.s),borderLeft:Oe(a.w)}},A.map((function(n){return N.a.createElement(be,n)}),function(n){var t=n.visible,e=n.seen,r=n.occupants;return t?A.withDefault(r.find((function(n){return"player"!==n.type&&"exit"!==n.type})),r[0]):e?r.find((function(n){return"exit"===n.type})):void 0}(r)))},ge=function(){return N.a.createElement("div",{className:ye()(pe.a.empty,pe.a.root)})},we=e(25),Te=e.n(we),xe=function(n){var t=n.grid;n.largeScreen;return N.a.createElement("div",{className:Te.a.root},t.map((function(n,t){return N.a.createElement("div",{key:t,className:Te.a.row},n.map((function(n,t){return A.withDefault(A.map((function(n){return N.a.createElement(he,{key:t,cell:n.cell,meta:n.meta})}),n),N.a.createElement(ge,{key:t}))})))})))},Se=e(8),je=e.n(Se),ke=function(n){var t=n.onMove;return N.a.createElement("div",{className:je.a.root},N.a.createElement("div",{className:je.a.row},N.a.createElement("div",{className:je.a.block}),N.a.createElement("div",{className:je.a.block},N.a.createElement("button",{className:je.a.button,onClick:function(){return t(_.Direction.NORTH)}})),N.a.createElement("div",{className:je.a.block})),N.a.createElement("div",{className:je.a.row},N.a.createElement("div",{className:je.a.block},N.a.createElement("button",{className:je.a.button,onClick:function(){return t(_.Direction.WEST)}})),N.a.createElement("div",{className:je.a.block},N.a.createElement("button",{className:ye()(je.a.button,je.a.wait),onClick:function(){return t(void 0)}})),N.a.createElement("div",{className:je.a.block},N.a.createElement("button",{className:je.a.button,onClick:function(){return t(_.Direction.EAST)}}))),N.a.createElement("div",{className:je.a.row},N.a.createElement("div",{className:je.a.block}),N.a.createElement("div",{className:je.a.block},N.a.createElement("button",{className:je.a.button,onClick:function(){return t(_.Direction.SOUTH)}})),N.a.createElement("div",{className:je.a.block})))},_e=e(35),Me=e(36),Ae=e(41),De=e(37),Ie=e(42),Pe=function(n){function t(){var n,e;Object(_e.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=Object(Ae.a)(this,(n=Object(De.a)(t)).call.apply(n,[this].concat(a)))).handleKeyDown=function(n){e.props.disabled||("ArrowUp"===n.key||"w"===n.key?e.props.onMove(_.Direction.NORTH):"ArrowRight"===n.key||"d"===n.key?e.props.onMove(_.Direction.EAST):"ArrowDown"===n.key||"d"===n.key?e.props.onMove(_.Direction.SOUTH):"ArrowLeft"===n.key||"a"===n.key?e.props.onMove(_.Direction.WEST):" "!==n.key&&"Enter"!==n.key||e.props.onMove(void 0))},e}return Object(Ie.a)(t,n),Object(Me.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleKeyDown)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){return P.createElement(P.Fragment,null)}}]),t}(P.PureComponent),Ne=e(38),Re=e.n(Ne),Le=function(n){var t=n.grid,e=n.onMove,r=n.processingUpdates;return P.createElement(Re.a,{minWidth:1024},(function(n){return P.createElement(P.Fragment,null,P.createElement(xe,{grid:t,largeScreen:n}),!n&&P.createElement(ke,{onMove:e}),P.createElement(Pe,{onMove:e,disabled:r}))}))};!function(n){n.REQUEST_NEW_GAME="REQUEST_NEW_GAME",n.START_NEW_GAME="START_NEW_GAME",n.REQUEST_STEP="REQUEST_STEP",n.PROCESS_STEP="PROCESS_STEP",n.COMPLETE_STEP="COMPLETE_STEP",n.ABORT_STEP="ABORT_STEP",n.MOVE_PLAYER="MOVE_PLAYER"}(Gt||(Gt={}));var Ce,We=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:Gt.REQUEST_NEW_GAME,options:n}},Ue=function(n,t){return{type:Gt.START_NEW_GAME,maze:n,entities:t}},ze=function(n){return{type:Gt.ABORT_STEP,stepId:n}},He=function(n,t){return{type:Gt.PROCESS_STEP,stepId:n,gameData:t}},Ge="true"===c.getSiteSetting("devmode",(function(){var n=u.parseQuery().devmode;return n&&"false"!==n?"true":void 0}));fetch("".concat(window.location.href.substring(0,window.location.href.indexOf("?")),"/VERSION")).then((function(n){return n.text().then((function(n){return Ce=n}))}));var Ye=Object(H.b)((function(n){return{gameData:ce(n)}}))((function(n){var t=n.gameData;return Ge&&l.isLoaded(t)?N.a.createElement("button",{onFocus:function(n){return n.preventDefault()},style:{position:"absolute",top:5,left:5},onClick:function(){window.alert(function(n){return["maze algorithm:: ".concat(n.maze.algorithm),"maze dimensions:: ".concat(n.maze.dimension.width," x ").concat(n.maze.dimension.height),"entityCount:: ".concat((t=n.entityData,"\n\t"+Object.keys(t.typeMap).map((function(n){return"".concat(n,": ").concat(t.typeMap[n].length)})).join("\n\t"))),"step:: ".concat(n.stepCount),"version:: ".concat(Ce)].join("\n");var t}(t.data)),A.ifPresent((function(n){return n.blur()}),document.activeElement)}},"?"):N.a.createElement(N.a.Fragment,null)})),Fe=e(39),Ve=e.n(Fe),Be=function(){return N.a.createElement("h1",{className:Ve.a.root},"???")},Qe=Object(H.b)((function(n){return{grid:fe(n),processingUpdates:se(n)}}),(function(n){return{onMove:function(t){return n((e=t,{type:Gt.MOVE_PLAYER,direction:e}));var e}}}))((function(n){var t=n.grid,e=n.processingUpdates,r=n.onMove;return N.a.createElement("div",{className:z.a.root},l.isLoading(t)&&N.a.createElement("span",null,"Loading . . . "),l.isLoaded(t)&&t.data&&N.a.createElement(N.a.Fragment,null,N.a.createElement(Ye,null),N.a.createElement(Be,null),N.a.createElement(Le,{processingUpdates:e,grid:t.data,onMove:r})))})),Ke=e(13),qe=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object($.a)({game:l.loading()},n)},Je=function(n){return Object($.a)({},n,{game:l.loading()})},Ze=function(n,t,e){return Object($.a)({},n,{game:l.loaded(v.create(t,E.fromEntities(e,t.dimension)))})},Xe=function(n,t){return l.isLoaded(t.game)?n():t},$e=function(n,t){return Object($.a)({},n,{stepId:t})},nr=function(n,t,e){return Xe((function(){return n.stepId===t?Object($.a)({},n,{game:l.loaded(e)}):n}),n)},tr=function(n,t){return Xe((function(){return n.stepId===t?Object($.a)({},n,{stepId:void 0,game:l.map((function(n){return Object($.a)({},n,{stepCount:n.stepCount+1})}),n.game)}):n}),n)},er=function(n,t){return n.stepId===t?Object($.a)({},n,{stepId:void 0}):n},rr=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qe(),t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Gt.REQUEST_STEP:return $e(n,t.step.id);case Gt.COMPLETE_STEP:return tr(n,t.stepId);case Gt.ABORT_STEP:return er(n,t.stepId);case Gt.PROCESS_STEP:return nr(n,t.stepId,t.gameData);case Gt.START_NEW_GAME:return Ze(n,t.maze,t.entities);case Gt.REQUEST_NEW_GAME:return Je(n);default:return n}},ar=e(40),ir=e(7),or=e.n(ir),cr=e(6),ur=or.a.mark(fr),sr=or.a.mark(pr),dr=or.a.mark(mr);function fr(){var n,t,e,r,a,i,o,c,u,s,d,f,p;return or.a.wrap((function(m){for(;;)switch(m.prev=m.next){case 0:n=[];case 1:return m.prev=2,m.next=5,Object(cr.f)(Gt.REQUEST_STEP);case 5:return t=m.sent,e=t.step,m.next=9,Object(cr.d)(ce);case 9:if(r=m.sent,!l.isLoaded(r)){m.next=58;break}return a=r.data,m.next=14,Object(cr.b)(h.validateAll,e.instructions,a);case 14:if(i=m.sent,!M.isErr(i)){m.next=19;break}return m.next=18,Object(cr.c)(ze(e.id));case 18:return m.abrupt("continue",1);case 19:return o=v.generateAllAIInstructions(a),c=[].concat(Object(F.a)(o),Object(F.a)(e.instructions)),m.next=23,Object(cr.b)(h.applyAll,c,a);case 23:if(u=m.sent,!M.isErr(u)){m.next=28;break}return m.next=27,Object(cr.c)(ze(e.id));case 27:return m.abrupt("continue",1);case 28:return m.next=30,Object(cr.b)(lr,a,u.data);case 30:return s=m.sent,m.next=33,Object(cr.b)(h.applyAll,s.reduce((function(n,t){return[].concat(Object(F.a)(n),Object(F.a)(t.instructions))}),[]),u.data);case 33:if(d=m.sent,!M.isErr(d)){m.next=38;break}return m.next=37,Object(cr.c)(ze(e.id));case 37:return m.abrupt("continue",1);case 38:return n=n.concat(D.phenomena(s)),m.next=41,Object(cr.b)(pr,n,a);case 41:return f=m.sent,m.next=44,Object(cr.b)(h.applyAll,f,d.data);case 44:if(p=m.sent,!M.isErr(p)){m.next=49;break}return m.next=48,Object(cr.c)(ze(e.id));case 48:return m.abrupt("continue",1);case 49:return m.next=51,Object(cr.b)(yr,n);case 51:return n=m.sent,m.next=54,Object(cr.c)(He(e.id,p.data));case 54:return m.next=56,Object(cr.b)(mr,p.data);case 56:return m.next=58,Object(cr.c)((y=e.id,{type:Gt.COMPLETE_STEP,stepId:y}));case 58:m.next=64;break;case 60:m.prev=60,m.t0=m.catch(2),console.warn("Error processing step"),console.error(m.t0);case 64:m.next=1;break;case 66:case"end":return m.stop()}var y}),ur,null,[[2,60]])}var lr=function(n,t){var e=E.getPlayer(t.entityData);return E.entitiesAtPoint(t.entityData,e.position,t.maze.dimension).filter((function(n){return n.id!==e.id})).concat(E.neighborsCrossedByEntity(n.entityData,t.entityData,e.id,t.maze.dimension)).map((function(n){return w.onCollideWithPlayer(n,t)}))};function pr(n,t){var e,r,a,i,o,c,u,s;return or.a.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:e=[],r=!0,a=!1,i=void 0,d.prev=4,o=n[Symbol.iterator]();case 6:if(r=(c=o.next()).done){d.next=15;break}return u=c.value,d.next=10,Object(cr.b)(u.fn,t);case 10:s=d.sent,e=e.concat(s);case 12:r=!0,d.next=6;break;case 15:d.next=21;break;case 17:d.prev=17,d.t0=d.catch(4),a=!0,i=d.t0;case 21:d.prev=21,d.prev=22,r||null==o.return||o.return();case 24:if(d.prev=24,!a){d.next=27;break}throw i;case 27:return d.finish(24);case 28:return d.finish(21);case 29:return d.abrupt("return",e);case 30:case"end":return d.stop()}}),sr,null,[[4,17,21,29],[22,,24,28]])}function mr(n){var t,e,r;return or.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(t=n.state,e=n.entityData,r=E.getPlayer(e),!b.lost(t)){a.next=8;break}return a.next=5,Object(cr.b)(window.confirm,w.getKillMessage(E.getPlayer(e),E.byId(e,t.causeOfDeath.entityId)));case 5:window.location.reload(),a.next=12;break;case 8:if(!b.won(t)){a.next=12;break}return a.next=11,Object(cr.b)(window.confirm,"".concat(r.name," escaped. . . this time."));case 11:window.location.reload();case 12:case"end":return a.stop()}}),dr)}var yr=function(n){return n.map((function(n){return Object($.a)({},n,{duration:"FOREVER"!==n.duration?n.duration-1:n.duration})})).filter((function(n){return"FOREVER"===n.duration||n.duration>0}))},Er=or.a.mark(vr);function vr(){return or.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(cr.g)(Gt.MOVE_PLAYER,or.a.mark((function n(t){var e;return or.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(cr.d)(de);case 2:return e=n.sent,n.next=5,Object(cr.d)(se);case 5:if(n.sent||!e){n.next=9;break}return n.next=9,Object(cr.c)((r=k.create(t.direction?h.move(e.id,t.direction):h.wait(e.id)),{type:Gt.REQUEST_STEP,step:r}));case 9:case"end":return n.stop()}var r}),n)})));case 2:case"end":return n.stop()}}),Er)}var br=or.a.mark(gr),Or=or.a.mark(wr),hr=A.withDefault(A.of(localStorage.getItem("name")),(function(){var n=window.prompt("What is your name?")||"";return""!==n&&localStorage.setItem("name",n),""!==n?n:"?"}));function gr(){return or.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(cr.c)(We({mazeOptions:Object($.a)({dimension:a.randomItem([s.create(10,10),s.create(15,15),s.create(15,15),s.create(15,15),s.create(15,15),s.create(20,20),s.create(25,10),s.create(10,25),s.create(20,15),s.create(15,20),s.create(30,5),s.create(5,30)]),algorithm:a.randomItem(["aldous-broder","aldous-broder","aldous-broder","binary-tree","side-winder"])},d.randomDirectionalOptions())}));case 2:case"end":return n.stop()}}),br)}function wr(){var n,t,e,a,i,o,c,u;return or.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=1,s.next=4,Object(cr.f)(Gt.REQUEST_NEW_GAME);case 4:return n=s.sent,t=n.options,s.next=8,Object(cr.b)(r.maze,t.mazeOptions||{});case 8:return e=s.sent,a=f.fromMazeData(e),i=Tr(a),o=Object(sn.a)(i,2),c=o[0],u=o[1],s.next=13,Object(cr.c)(Ue(c,u));case 13:s.next=19;break;case 15:s.prev=15,s.t0=s.catch(1),console.warn("Error initializing new game"),console.error(s.t0);case 19:s.next=0;break;case 21:case"end":return s.stop()}}),Or,null,[[1,15]])}var Tr=function(n){var t=n.dimension,e=m.create(hr,s.pointAlongEdge(t)),r=new Array(i.randomInRange(1,5)).fill(void 0).map((function(n){return T.create(s.randomPoint(t))})),o=new Array(a.randomItem([1,1,2,2,3])).fill(void 0).map((function(n){return x.create(s.randomPoint(t))})),c=[].concat(Object(F.a)(r),Object(F.a)(o)),u=f.placeEntitiesInDeadEnds(n,[S.create,g.create,j.create]),d=u.placed,l=u.maze,p=u.unplaced;return console.log("Ran out of deadends to place these entities ".concat(p.map((function(n){return n.type})).join(", "))),[l,[e].concat(Object(F.a)(c),Object(F.a)(d))]},xr=or.a.mark(jr),Sr=[gr,wr,fr,vr];function jr(){return or.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(cr.a)(Sr.map((function(n){return Object(cr.e)(n)})));case 2:case"end":return n.stop()}}),xr)}L.a.render(N.a.createElement(H.a,{store:function(){var n=Object(ar.a)(),t=Object(Ke.d)(rr,Object(Ke.a)(n));return n.run(jr),t}()},N.a.createElement("div",{className:W.a.app},N.a.createElement(Qe,null))),document.getElementById("root"))},8:function(n,t,e){n.exports={root:"GamePad_root__Lay6t",row:"GamePad_row__164Sm",block:"GamePad_block__l2_xd",button:"GamePad_button__3kDFo",wait:"GamePad_wait__5DVYu"}}},[[43,1,2]]]);
//# sourceMappingURL=main.a595c4bf.chunk.js.map