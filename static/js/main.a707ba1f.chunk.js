(this.webpackJsonpfollowed=this.webpackJsonpfollowed||[]).push([[0],{17:function(n,e,t){n.exports={root:"Cell_root__2ti8K",empty:"Cell_empty__1ByI9",seen:"Cell_seen__2qSTX",visible:"Cell_visible__2bnT3",unknown:"Cell_unknown__2tYkG"}},22:function(n,e,t){n.exports={root:"Grid_root__xSU_B",row:"Grid_row__1rWaL",large:"Grid_large__2_Ser"}},29:function(n,e){},30:function(n,e,t){n.exports={app:"index_app__2lpzC"}},31:function(n,e,t){n.exports={root:"App_root__ZxxJN"}},34:function(n,e,t){n.exports={root:"Entity_root__MaGTf"}},39:function(n,e,t){n.exports={root:"Chat_root__2csEn"}},43:function(n,e,t){n.exports=t(56)},56:function(n,e,t){"use strict";t.r(e);var r={};t.r(r),t.d(r,"maze",(function(){return F}));var a={};t.r(a),t.d(a,"nOf",(function(){return Q})),t.d(a,"sorted",(function(){return Y})),t.d(a,"nonNull",(function(){return K})),t.d(a,"randomItem",(function(){return q}));var i={};t.r(i),t.d(i,"randomInRange",(function(){return J}));var o={};t.r(o),t.d(o,"centerOnPoint",(function(){return X}));var c={};t.r(c),t.d(c,"getSiteSetting",(function(){return Z}));var u={};t.r(u),t.d(u,"parseQuery",(function(){return en}));var s={};t.r(s),t.d(s,"create",(function(){return tn})),t.d(s,"area",(function(){return rn})),t.d(s,"randomPoint",(function(){return an})),t.d(s,"pointAlongEdge",(function(){return on})),t.d(s,"inBounds",(function(){return cn}));var d={};t.r(d),t.d(d,"fromApi",(function(){return un})),t.d(d,"randomDirectionalOptions",(function(){return sn}));var f={};t.r(f),t.d(f,"fromMazeData",(function(){return pn})),t.d(f,"canWalk",(function(){return mn})),t.d(f,"canTravel",(function(){return yn})),t.d(f,"lookInDirection",(function(){return En})),t.d(f,"peekableCorners",(function(){return vn})),t.d(f,"seenFromPoint",(function(){return bn})),t.d(f,"takeDeadEnd",(function(){return On})),t.d(f,"deadEnds",(function(){return hn})),t.d(f,"placeEntitiesInDeadEnds",(function(){return gn}));var l={};t.r(l),t.d(l,"isLoading",(function(){return wn})),t.d(l,"isLoaded",(function(){return Tn})),t.d(l,"isErrored",(function(){return jn})),t.d(l,"loading",(function(){return Sn})),t.d(l,"loaded",(function(){return xn})),t.d(l,"errored",(function(){return kn})),t.d(l,"map",(function(){return Mn}));var p={};t.r(p),t.d(p,"create",(function(){return Dn}));var m={};t.r(m),t.d(m,"create",(function(){return _n})),t.d(m,"randomDisplayName",(function(){return In}));var y={};t.r(y),t.d(y,"EntityClass",(function(){return P}));var E={};t.r(E),t.d(E,"fromEntities",(function(){return Nn})),t.d(E,"entitiesAtPoint",(function(){return Rn})),t.d(E,"getPlayer",(function(){return Cn})),t.d(E,"byId",(function(){return Ln})),t.d(E,"byType",(function(){return Wn})),t.d(E,"moveEntity",(function(){return Un})),t.d(E,"removeEntity",(function(){return zn})),t.d(E,"updateEntity",(function(){return Gn})),t.d(E,"entitiesCrossed",(function(){return Hn})),t.d(E,"neighborsCrossedByEntity",(function(){return Vn}));var v={};t.r(v),t.d(v,"create",(function(){return Fn})),t.d(v,"lookForEntityInDirection",(function(){return Bn})),t.d(v,"displayGrid",(function(){return Qn})),t.d(v,"generateAllAIInstructions",(function(){return Yn}));var b={};t.r(b),t.d(b,"win",(function(){return Kn})),t.d(b,"lose",(function(){return qn})),t.d(b,"play",(function(){return Jn})),t.d(b,"won",(function(){return Xn})),t.d(b,"lost",(function(){return Zn})),t.d(b,"playing",(function(){return $n}));var O={};t.r(O),t.d(O,"getColor",(function(){return ne})),t.d(O,"getDescription",(function(){return ee})),t.d(O,"generateAiInstructions",(function(){return te})),t.d(O,"onCollideWithPlayer",(function(){return re})),t.d(O,"getKillMessage",(function(){return ae}));var h={};t.r(h),t.d(h,"create",(function(){return ie})),t.d(h,"next",(function(){return oe})),t.d(h,"DISPLAY",(function(){return ce}));var g={};t.r(g),t.d(g,"create",(function(){return ue})),t.d(g,"next",(function(){return se})),t.d(g,"wander",(function(){return de})),t.d(g,"lookForPlayerInDirection",(function(){return fe}));var w={};t.r(w),t.d(w,"create",(function(){return le})),t.d(w,"DISPLAY",(function(){return pe}));var T={};t.r(T),t.d(T,"create",(function(){return me})),t.d(T,"next",(function(){return ye}));var j={};t.r(j),t.d(j,"create",(function(){return Ee})),t.d(j,"toIndex",(function(){return ve})),t.d(j,"fromIndex",(function(){return be})),t.d(j,"neighbor",(function(){return Oe})),t.d(j,"neighbors",(function(){return he})),t.d(j,"diagonalNeighbors",(function(){return ge})),t.d(j,"equals",(function(){return we}));var S={};t.r(S),t.d(S,"create",(function(){return Te}));var x={};t.r(x),t.d(x,"move",(function(){return Se})),t.d(x,"update",(function(){return ke})),t.d(x,"wait",(function(){return Me})),t.d(x,"updateGameState",(function(){return Ae})),t.d(x,"see",(function(){return De})),t.d(x,"remove",(function(){return _e})),t.d(x,"validate",(function(){return Ie})),t.d(x,"validateAll",(function(){return Pe})),t.d(x,"apply",(function(){return Ne})),t.d(x,"applyAll",(function(){return Re}));var k={};t.r(k),t.d(k,"Direction",(function(){return je})),t.d(k,"all",(function(){return Le})),t.d(k,"inverse",(function(){return We})),t.d(k,"random",(function(){return Ue}));var M={};t.r(M),t.d(M,"ok",(function(){return ze})),t.d(M,"err",(function(){return Ge})),t.d(M,"isErr",(function(){return He})),t.d(M,"isOk",(function(){return Ve})),t.d(M,"map",(function(){return Fe}));var A={};t.r(A),t.d(A,"of",(function(){return Be})),t.d(A,"none",(function(){return Qe})),t.d(A,"withDefault",(function(){return Ye})),t.d(A,"map",(function(){return Ke})),t.d(A,"ifPresent",(function(){return qe}));var D={};t.r(D),t.d(D,"create",(function(){return Xe})),t.d(D,"instructions",(function(){return Ze})),t.d(D,"phenomena",(function(){return $e}));var _={};t.r(_),t.d(_,"create",(function(){return nt}));var I={};t.r(I),t.d(I,"create",(function(){return Er})),t.d(I,"knowing",(function(){return vr}));var P,N=t(1),R=t.n(N),C=t(19),L=t.n(C),W=t(30),U=t.n(W),z=t(31),G=t.n(z),H=t(18),V="https://fv9o21r19a.execute-api.us-east-1.amazonaws.com/dev",F=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.dimension,t=void 0===e?s.create(10,10):e,r=n.algorithm,a=void 0===r?"aldous-broder":r,i=n.corner,o=n.direction,c=fetch("".concat(V),{method:"post",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify({dimensions:t,algorithm:a,corner:i,direction:o})});return c.then((function(n){return n.text()})).then((function(n){return d.fromApi(t,a,n)}))},B=t(4),Q=function(n,e){return new Array(n).fill(e)},Y=function(n,e){var t=Object(B.a)(n);return t.sort(e),t},K=function(n){return n.filter((function(n){return null!=n}))},q=function(n){return n[Math.floor(Math.random()*n.length)]},J=function(n,e){return n+Math.floor(Math.random()*(e-n-1))},X=function(n,e,t){for(var r=e.x-t,a=e.x+t+1,i=e.y-t,o=e.y+t+1,c=[],u=i;u<o;u++){for(var s=[],d=function(e){s.push(A.map((function(n){return n[e]}),n[u]))},f=r;f<a;f++)d(f);c.push(s)}return c},Z=function(n,e){return A.withDefault(window.localStorage.getItem("".concat("followed.settings",".").concat(n)),(function(){var t=e();if(t)return window.localStorage.setItem("".concat("followed.settings",".").concat(n),t),t}))},$=t(9),nn=t(3),en=function(){return window.location.search.substring(1).split("&").reduce((function(n,e){var t=e.split("=");return Object(nn.a)({},n,Object($.a)({},t[0],t[1]))}),{})},tn=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{width:n,height:e}},rn=function(n){return n.width*n.height},an=function(n){return j.fromIndex(Math.floor(Math.random()*rn(n)),n)},on=function(n){var e=Math.random()>.5;return j.create(e?i.randomInRange(0,n.width):Math.random()>.5?0:n.width-1,e?Math.random()>.5?0:n.height-1:i.randomInRange(0,n.height))},cn=function(n,e){return e.x>=0&&e.y>=0&&e.x<n.width&&e.y<n.height},un=function(n,e,t){return{bytes:Uint8Array.from(atob(t),(function(n){return n.charCodeAt(0)})),dimension:n,algorithm:e}},sn=function(){return{corner:a.randomItem(["nw","ne","sw","se"]),direction:a.randomItem(["n","e","s","w"])}},dn=t(21),fn=function(n){return{walls:(e={n:!((8&n)>0),s:!((4&n)>0),e:!((2&n)>0),w:!((1&n)>0)},{n:e.n||!1,e:e.e||!1,s:e.s||!1,w:e.w||!1})};var e},ln=function(n){var e=n.walls;return[e.n,e.e,e.s,e.w].filter((function(n){return!0===n})).length>=3},pn=function(n){for(var e=n.dimension,t=n.bytes,r=n.algorithm,a=[],i=[],o=0;o<e.height;o++){for(var c=[],u=0;u<e.width;u++){var s=fn(t[o*e.width+u]);c.push(s),ln(s)&&i.push(j.toIndex(j.create(u,o),e))}a.push(c)}return{grid:a,dimension:e,algorithm:r,deadends:{unused:i,used:[]}}},mn=function(n,e,t){var r=e.x,a=e.y;return!function(n,e){var t=n.walls;switch(e){case k.Direction.NORTH:return t.n;case k.Direction.EAST:return t.e;case k.Direction.SOUTH:return t.s;case k.Direction.WEST:return t.w}}(n.grid[a][r],t)},yn=function(n,e){for(var t=arguments.length,r=new Array(t>2?t-2:0),a=2;a<t;a++)r[a-2]=arguments[a];return!!r.reduce((function(e,t){return e&&mn(n,e,t)?j.neighbor(e,t):void 0}),e)},En=function n(e,t,r,a){if(mn(e,r,t)&&a>0){var i=j.neighbor(r,t);return[i].concat(Object(B.a)(n(e,t,i,a-1)))}return[]},vn=function(n,e){var t=[];return(yn(n,e,k.Direction.NORTH,k.Direction.EAST)||yn(n,e,k.Direction.EAST,k.Direction.NORTH))&&t.push(j.create(e.x+1,e.y-1)),(yn(n,e,k.Direction.NORTH,k.Direction.WEST)||yn(n,e,k.Direction.WEST,k.Direction.NORTH))&&t.push(j.create(e.x-1,e.y-1)),(yn(n,e,k.Direction.SOUTH,k.Direction.EAST)||yn(n,e,k.Direction.EAST,k.Direction.SOUTH))&&t.push(j.create(e.x+1,e.y+1)),(yn(n,e,k.Direction.SOUTH,k.Direction.WEST)||yn(n,e,k.Direction.WEST,k.Direction.SOUTH))&&t.push(j.create(e.x-1,e.y+1)),t},bn=function(n,e,t){return k.all().reduce((function(r,a){return r.concat(En(n,a,e,t))}),[]).concat(vn(n,e)).concat(e)},On=function(n){var e=a.randomItem(n.deadends.unused);return e?[e,Object(nn.a)({},n,{deadends:{unused:n.deadends.unused.filter((function(n){return n!==e})),used:[].concat(Object(B.a)(n.deadends.used),[e])}})]:[-1,n]},hn=function(n){return[].concat(Object(B.a)(n.deadends.used),Object(B.a)(n.deadends.unused))},gn=function(n,e){return e.reduce((function(n,e){var t,r,a=On(n.maze),i=Object(dn.a)(a,2),o=i[0],c=i[1];return o?(t=[].concat(Object(B.a)(n.placed),[e(j.fromIndex(o,n.maze.dimension))]),r=Object(B.a)(n.unplaced)):(t=Object(B.a)(n.placed),r=[].concat(Object(B.a)(n.unplaced),[e(j.create(-1,-1))])),{maze:c,placed:t,unplaced:r}}),{maze:n,placed:[],unplaced:[]})},wn=function(n){return"Loading"===n.state},Tn=function(n){return"Loaded"===n.state},jn=function(n){return"Errored"===n.state},Sn=function(){return{state:"Loading"}},xn=function(n){return{state:"Loaded",data:n}},kn=function(n){return{state:"Errored",e:n}},Mn=function(n,e){return Tn(e)?xn(n(e.data)):e},An=t(33),Dn=function(){return Object(An.v4)()},_n=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.create(),t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:In();return{id:p.create(),name:n,position:e,type:"player",visionRadius:t,displayName:r||n,cls:y.EntityClass.PLAYER}},In=function(){return a.randomItem(["\ud83d\udc15","\ud83d\udc26","\ud83d\udc08","\ud83d\udc0e","\ud83d\udc16","\ud83d\udc01","\ud83d\udc00","\ud83d\udc22"])};!function(n){n.PLAYER="PLAYER",n.INANIMATE="INANIMATE",n.HOSTILE="HOSTILE",n.ITEM="ITEM"}(P||(P={}));var Pn,Nn=function(n,e){return{entityMap:n.reduce((function(n,e){return n[e.id]=e,n}),{}),positionMap:n.reduce((function(n,t){var r=j.toIndex(t.position,e);return n[r]=n[r]?[].concat(Object(B.a)(n[r]),[t.id]):[t.id],n}),{}),playerEntityId:A.map((function(n){return n.id}),n.find((function(n){return"player"===n.type}))),typeMap:n.reduce((function(n,e){return Object(nn.a)({},n,Object($.a)({},e.type,n[e.type]?[].concat(Object(B.a)(n[e.type]),[e.id]):[e.id]))}),{})}},Rn=function(n,e,t){var r=j.toIndex(e,t);return(n.positionMap[r]||[]).map((function(e){return n.entityMap[e]}))},Cn=function(n){return A.map((function(e){return n.entityMap[e]}),n.playerEntityId)},Ln=function(n,e){return n.entityMap[e]},Wn=function(n,e){return a.nonNull(n.typeMap[e]||[]).map((function(e){return n.entityMap[e]}))},Un=function(n,e,t,r){var a=e.entityMap[n];if(null!=a){var i,o=j.toIndex(a.position,r),c=j.toIndex(t,r),u=Object(nn.a)({},a,{position:t});return Object(nn.a)({},e,{entityMap:Object(nn.a)({},e.entityMap,Object($.a)({},n,u)),positionMap:Object(nn.a)({},e.positionMap,(i={},Object($.a)(i,o,Object(B.a)((e.positionMap[o]||[]).filter((function(e){return e!==n})))),Object($.a)(i,c,[].concat(Object(B.a)(e.positionMap[c]||[]),[n])),i))})}return e},zn=function(n,e,t){var r=e.entityMap[n],a=j.toIndex(r.position,t);return Object(nn.a)({},e,{entityMap:Object.keys(e.entityMap).reduce((function(t,r){return r!==n&&(t[r]=e.entityMap[r]),t}),{}),typeMap:Object.keys(e.typeMap).reduce((function(t,a){return a===r.type?t[a]=e.typeMap[a].filter((function(e){return e!==n})):t[a]=e.typeMap[a],t}),{}),positionMap:Object.keys(e.positionMap).map((function(n){return parseInt(n)})).reduce((function(t,r){return t[r]=r===a?e.positionMap[r].filter((function(e){return e!==n})):e.positionMap[r],t}),{})})},Gn=function(n,e){return Object(nn.a)({},e,{entityMap:Object(nn.a)({},e.entityMap,Object($.a)({},n.id,n))})},Hn=function(n,e,t,r){var a=n.entityMap[t],i=n.entityMap[r],o=e.entityMap[t],c=e.entityMap[r];return j.equals(o.position,i.position)&&j.equals(c.position,a.position)},Vn=function(n,e,t,r){return j.neighbors(e.entityMap[t].position,r).map((function(n){return j.toIndex(n,r)})).reduce((function(n,t){return n.concat(e.positionMap[t]||[])}),[]).filter((function(r){return Hn(n,e,t,r)})).map((function(n){return e.entityMap[n]}))},Fn=function(n,e){var t=E.getPlayer(e),r=new Set(t?f.seenFromPoint(n,t.position,t.visionRadius).map((function(e){return j.toIndex(e,n.dimension)})):[]);return{maze:n,entityData:e,seen:new Set,sees:r,stepCount:0,state:b.play()}},Bn=function(n,e,t,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5;return f.lookInDirection(t.maze,n,e,a).reduce((function(n,e){return n||null!=E.entitiesAtPoint(t.entityData,e,t.maze.dimension).find(r)}),!1)},Qn=function(n){var e=n.maze,t=n.entityData,r=n.seen,a=n.sees;return e.grid.reduce((function(n,i,o){return[].concat(Object(B.a)(n),[i.reduce((function(n,i,c){var u=j.create(c,o),s=r.has(j.toIndex(u,e.dimension)),d=a.has(j.toIndex(u,e.dimension));return n.concat({cell:i,meta:{occupants:E.entitiesAtPoint(t,j.create(c,o),e.dimension),visible:d,seen:s,unknown:!d&&!s}})}),[])])}),[])},Yn=function(n){return Object.keys(n.entityData.entityMap).map((function(e){return E.byId(n.entityData,e)})).filter((function(n){return"player"!==n.type})).reduce((function(e,t){return e.concat(O.generateAiInstructions(t,n))}),[])},Kn=function(){return{type:"Won"}},qn=function(n){return{type:"Lost",causeOfDeath:n}},Jn=function(){return{type:"Playing"}},Xn=function(n){return"Won"===n.type},Zn=function(n){return"Lost"===n.type},$n=function(n){return"Playing"===n.type},ne=function(n){return n.type,"transparent"},ee=function(n){switch(n.type){case"player":return n.name;case"blind-guardian":return"a blind guardian";case"exit":return"an exit";case"wandering-husk":return"a wandering husk";case"orb-of-knowing":return"a mysterious, translucent orb";case"sinister-dolls":return"two lifelike dolls"}},te=function(n,e){switch(n.type){case"blind-guardian":return h.next(n,e);case"wandering-husk":return g.next(n,e);case"sinister-dolls":return T.next(n,e);default:return[]}},re=function(n,e){return n.cls===P.HOSTILE?D.create([x.updateGameState(b.lose({entityId:n.id}))]):n.cls===P.ITEM?D.create(void 0,[n.phenomena]):"exit"===n.type?D.create([x.updateGameState(b.win())]):D.create()},ae=function(n,e){switch(e.type){case"blind-guardian":return"".concat(n.name," has been annihilated by ").concat(ee(e),". Nothing is left.");case"wandering-husk":return"Blood and sinew cling to the maw of the wandering husk. ".concat(n.name," has been consumed.");case"sinister-dolls":return"The dolls draw closer. ".concat(n.name," is frozen. Then, darkness. ").concat(n.name," is never heard from again.");default:return"".concat(n.name," was killed by ").concat(ee(e))}},ie=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.create();return{type:"blind-guardian",position:n,id:p.create(),heading:k.Direction.NORTH,cls:y.EntityClass.HOSTILE}},oe=function(n,e){var t,r=k.all().filter((function(t){return f.canWalk(e.maze,n.position,t)})),i=r.filter((function(e){return e!==k.inverse(n.heading)}));return t=r.includes(n.heading)&&Math.random()<.75?n.heading:Math.random()<.75&&i.length>0?a.randomItem(i):r[0],[x.update(Object(nn.a)({},n,{heading:t})),x.move(n.id,t)]},ce="\ud83d\uddff",ue=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.create();return{type:"wandering-husk",position:n,id:p.create(),heading:k.random(),cls:y.EntityClass.HOSTILE}},se=function(n,e){var t,r=k.all().reduce((function(t,r){return t||(fe(r,n.position,e)?r:void 0)}),void 0),a=[];return r?Math.random()<.9?(t=r,a.push(x.move(n.id,t))):(t=n.heading,a.push(x.wait(n.id))):(t=de(n,e),a.push(x.move(n.id,t))),[x.update(Object(nn.a)({},n,{heading:t}))].concat(a)},de=function(n,e){var t=k.all().filter((function(t){return f.canWalk(e.maze,n.position,t)})),r=t.filter((function(e){return e!==k.inverse(n.heading)}));return t.includes(n.heading)&&Math.random()<.75?n.heading:Math.random()<.75&&r.length>0?a.randomItem(r):t[0]},fe=function(n,e,t){return f.lookInDirection(t.maze,n,e,5).reduce((function(n,e){return n||null!=E.entitiesAtPoint(t.entityData,e,t.maze.dimension).find((function(n){return"player"===n.type}))}),!1)},le=function(n){return{position:n,id:p.create(),type:"exit",cls:y.EntityClass.INANIMATE}},pe="\ud83d\udeaa",me=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.create();return{type:"sinister-dolls",position:n,id:p.create(),cls:y.EntityClass.HOSTILE}},ye=function(n,e){var t=k.all().reduce((function(t,r){return t||(Bn(r,n.position,e,(function(n){return"player"===n.type}))?r:void 0)}),void 0);return t&&Math.random()<.9?[x.move(n.id,t)]:[]},Ee=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{x:n,y:e}},ve=function(n,e){var t=n.x;return n.y*e.width+t},be=function(n,e){var t=e.width;return Ee(n%t,Math.floor(n/t))},Oe=function(n,e){switch(e){case"NORTH":return j.create(n.x,n.y-1);case"SOUTH":return j.create(n.x,n.y+1);case"EAST":return j.create(n.x+1,n.y);case"WEST":default:return j.create(n.x-1,n.y)}},he=function(n,e){return k.all().map((function(e){return Oe(n,e)})).filter((function(n){return s.inBounds(e,n)}))},ge=function(n,e){return[Ee(n.x-1,n.y-1),Ee(n.x+1,n.y-1),Ee(n.x+1,n.y+1),Ee(n.x-1,n.y+1)].filter((function(n){return s.inBounds(e,n)}))},we=function(n,e){return n.x===e.x&&n.y===e.y},Te=function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return{instructions:e,id:p.create()}};!function(n){n.MOVE="MOVE",n.UPDATE="UPDATE",n.WAIT="WAIT",n.UPDATE_GAME_STATE="UPDATE_GAME_STATE",n.SEE="SEE",n.REMOVE="REMOVE",n.ADD="ADD"}(Pn||(Pn={}));var je,Se=function(n,e){return{type:Pn.MOVE,payload:{entityId:n,direction:e}}},xe=function(n,e,t){var r=new Set(f.seenFromPoint(t,e.position,e.visionRadius).map((function(n){return j.toIndex(n,t.dimension)})));return{sees:r,seen:new Set([].concat(Object(B.a)(n),Object(B.a)(r)))}},ke=function(n){return{type:Pn.UPDATE,payload:{updated:n}}},Me=function(n){return{type:Pn.WAIT,payload:{entityId:n}}},Ae=function(n){return{type:Pn.UPDATE_GAME_STATE,payload:{updated:n}}},De=function(n){return{type:Pn.SEE,payload:n}},_e=function(n){return{type:Pn.REMOVE,payload:n}},Ie=function(n,e){switch(n.type){case Pn.MOVE:return function(n,e){var t=n.payload;return f.canWalk(e.maze,e.entityData.entityMap[t.entityId].position,t.direction)?M.ok(void 0):M.err("way is blocked")}(n,e);case Pn.WAIT:return M.ok(void 0);default:return M.err("Unkown instruction of type ".concat(n.type))}},Pe=function(n,e){return n.reduce((function(n,t){return M.isOk(n)?Ie(t,e):n}),M.ok(void 0))},Ne=function(n,e){try{switch(n.type){case Pn.MOVE:return M.ok(function(n,e){var t=n.payload,r=t.entityId,a=t.direction,i=E.moveEntity(r,e.entityData,j.neighbor(e.entityData.entityMap[r].position,a),e.maze.dimension),o=E.getPlayer(i),c=o&&r===o.id?xe(e.seen,o,e.maze):e,u=c.seen,s=c.sees;return Object(nn.a)({},e,{seen:u,sees:s,entityData:i})}(n,e));case Pn.UPDATE:return M.ok(function(n,e){return Object(nn.a)({},e,{entityData:E.updateEntity(n.payload.updated,e.entityData)})}(n,e));case Pn.WAIT:return M.ok(function(n,e){return Object(nn.a)({},e)}(0,e));case Pn.UPDATE_GAME_STATE:return M.ok(function(n,e){return Object(nn.a)({},e,{state:b.lost(e.state)?e.state:n.payload.updated})}(n,e));case Pn.SEE:return M.ok(function(n,e){return Object(nn.a)({},e,{seen:new Set([].concat(Object(B.a)(e.seen),Object(B.a)(n.payload)))})}(n,e));case Pn.REMOVE:return M.ok(function(n,e){return Object(nn.a)({},e,{entityData:E.removeEntity(n.payload,e.entityData,e.maze.dimension)})}(n,e))}}catch(t){return console.warn("Error applying instruction",n),console.error(t),M.err("Error applying instructions")}},Re=function(n,e){return n.reduce((function(n,e){return M.isOk(n)?Ne(e,n.data):n}),M.ok(e))};!function(n){n.NORTH="NORTH",n.SOUTH="SOUTH",n.EAST="EAST",n.WEST="WEST"}(je||(je={}));var Ce,Le=function(){return[je.NORTH,je.SOUTH,je.EAST,je.WEST]},We=function(n){switch(n){case je.NORTH:return je.SOUTH;case je.SOUTH:return je.NORTH;case je.EAST:return je.WEST;case je.WEST:return je.EAST}},Ue=function(){return q(Le())},ze=function(n){return{type:"Ok",data:n}},Ge=function(n){return{type:"Error",msg:n}},He=function(n){return"Error"===n.type},Ve=function(n){return"Ok"===n.type},Fe=function(n,e){return Ve(e)?ze(n(e.data)):e},Be=(t(29),function(n){return n}),Qe=function(){},Ye=function(n,e){return null!=n?n:"function"===typeof e?e():e},Ke=function(n,e){return null!=e?n(e):void 0},qe=function(n,e){e&&n(e)};!function(n){n[n.FORGETTING=0]="FORGETTING",n.KNOW_DOOR_LOCATION="KNOW_DOOR_LOCATION"}(Ce||(Ce={}));var Je,Xe=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{instructions:n,phenomena:e}},Ze=function(n){return n.reduce((function(n,e){return[].concat(Object(B.a)(n),Object(B.a)(e.instructions))}),[])},$e=function(n){return n.reduce((function(n,e){return[].concat(Object(B.a)(n),Object(B.a)(e.phenomena))}),[])},nt=function(n,e){return{message:n,speaker:e}},et=t(16),tt=function(n){return n},rt=Object(et.a)(tt,(function(n){return n.game})),at=Object(et.a)(rt,(function(n){return l.map(v.displayGrid,n)})),it=Object(et.a)(tt,(function(n){return null!=n.stepId})),ot=Object(et.a)(rt,(function(n){return l.isLoaded(n)?A.map((function(e){return n.data.entityData.entityMap[e]}),n.data.entityData.playerEntityId):void 0})),ct=Object(et.a)(at,ot,(function(n,e){return l.map((function(n){return null!=e?o.centerOnPoint(n,e.position,3):[]}),n)})),ut=Object(et.a)(tt,(function(n){return n.chat.messages})),st=t(17),dt=t.n(st),ft=t(14),lt=t.n(ft),pt=t(34),mt=t.n(pt),yt=function(n){return R.a.createElement("div",{className:mt.a.root,style:{color:(e=n,"player"===e.type?"black":"exit"===e.type||"orb-of-knowing"===e.type?"blue":"red")}},function(n){switch(n.type){case"player":return n.name[0].toUpperCase();case"sinister-dolls":return"D";case"wandering-husk":case"blind-guardian":return"H";case"orb-of-knowing":return"O";case"exit":return"E";default:return"?"}}(n));var e},Et=function(n){return n?"0.5px solid #444444":"0.5px solid transparent"},vt=function(n){var e,t=n.cell,r=n.meta,a=t.walls;return R.a.createElement("div",{className:lt()(dt.a.root,(e={},Object($.a)(e,dt.a.seen,r.seen),Object($.a)(e,dt.a.visible,r.visible),Object($.a)(e,dt.a.unknown,!r.seen&&!r.visible),e)),style:r.unknown?void 0:{borderTop:Et(a.n),borderRight:Et(a.e),borderBottom:Et(a.s),borderLeft:Et(a.w)}},A.map((function(n){return R.a.createElement(yt,n)}),function(n){var e=n.visible,t=n.seen,r=n.occupants;return e?A.withDefault(r.find((function(n){return"player"!==n.type&&"exit"!==n.type})),r[0]):t?r.find((function(n){return"exit"===n.type})):void 0}(r)))},bt=function(){return R.a.createElement("div",{className:lt()(dt.a.empty,dt.a.root)})},Ot=t(22),ht=t.n(Ot),gt=function(n){var e=n.grid,t=n.largeScreen;return R.a.createElement("div",{className:lt()(ht.a.root,Object($.a)({},ht.a.large,t))},e.map((function(n,e){return R.a.createElement("div",{key:e,className:ht.a.row},n.map((function(n,e){return A.withDefault(A.map((function(n){return R.a.createElement(vt,{key:e,cell:n.cell,meta:n.meta})}),n),R.a.createElement(bt,{key:e}))})))})))},wt=t(8),Tt=t.n(wt),jt=function(n){var e=n.onMove;return R.a.createElement("div",{className:Tt.a.root},R.a.createElement("div",{className:Tt.a.row},R.a.createElement("div",{className:Tt.a.block}),R.a.createElement("div",{className:Tt.a.block},R.a.createElement("button",{className:Tt.a.button,onClick:function(){return e(k.Direction.NORTH)}})),R.a.createElement("div",{className:Tt.a.block})),R.a.createElement("div",{className:Tt.a.row},R.a.createElement("div",{className:Tt.a.block},R.a.createElement("button",{className:Tt.a.button,onClick:function(){return e(k.Direction.WEST)}})),R.a.createElement("div",{className:Tt.a.block},R.a.createElement("button",{className:lt()(Tt.a.button,Tt.a.wait),onClick:function(){return e(void 0)}})),R.a.createElement("div",{className:Tt.a.block},R.a.createElement("button",{className:Tt.a.button,onClick:function(){return e(k.Direction.EAST)}}))),R.a.createElement("div",{className:Tt.a.row},R.a.createElement("div",{className:Tt.a.block}),R.a.createElement("div",{className:Tt.a.block},R.a.createElement("button",{className:Tt.a.button,onClick:function(){return e(k.Direction.SOUTH)}})),R.a.createElement("div",{className:Tt.a.block})))},St=t(35),xt=t(36),kt=t(41),Mt=t(37),At=t(42),Dt=function(n){function e(){var n,t;Object(St.a)(this,e);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=Object(kt.a)(this,(n=Object(Mt.a)(e)).call.apply(n,[this].concat(a)))).handleKeyDown=function(n){t.props.disabled||("ArrowUp"===n.key||"w"===n.key?t.props.onMove(k.Direction.NORTH):"ArrowRight"===n.key||"d"===n.key?t.props.onMove(k.Direction.EAST):"ArrowDown"===n.key||"d"===n.key?t.props.onMove(k.Direction.SOUTH):"ArrowLeft"===n.key||"a"===n.key?t.props.onMove(k.Direction.WEST):" "!==n.key&&"Enter"!==n.key||t.props.onMove(void 0))},t}return Object(At.a)(e,n),Object(xt.a)(e,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleKeyDown)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){return N.createElement(N.Fragment,null)}}]),e}(N.PureComponent),_t=t(38),It=t.n(_t),Pt=t(39),Nt=t.n(Pt),Rt=function(n){var e=n.messages;return R.a.createElement("div",{className:Nt.a.root},e.map((function(n){return R.a.createElement("div",null,n.message)})))},Ct=function(n){var e=n.grid,t=n.onMove,r=n.processingUpdates,a=n.messages;return N.createElement(It.a,{minWidth:1024},(function(n){return N.createElement(N.Fragment,null,N.createElement(Rt,{messages:a}),N.createElement(gt,{grid:e,largeScreen:n}),!n&&N.createElement(jt,{onMove:t}),N.createElement(Dt,{onMove:t,disabled:r}))}))};!function(n){n.REQUEST_NEW_GAME="REQUEST_NEW_GAME",n.START_NEW_GAME="START_NEW_GAME",n.REQUEST_STEP="REQUEST_STEP",n.PROCESS_STEP="PROCESS_STEP",n.COMPLETE_STEP="COMPLETE_STEP",n.ABORT_STEP="ABORT_STEP",n.MOVE_PLAYER="MOVE_PLAYER",n.ADD_MESSAGE="ADD_MESSAGE"}(Je||(Je={}));var Lt,Wt=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:Je.REQUEST_NEW_GAME,options:n}},Ut=function(n,e){return{type:Je.START_NEW_GAME,maze:n,entities:e}},zt=function(n){return{type:Je.ABORT_STEP,stepId:n}},Gt=function(n,e){return{type:Je.PROCESS_STEP,stepId:n,gameData:e}},Ht="true"===c.getSiteSetting("devmode",(function(){var n=u.parseQuery().devmode;return n&&"false"!==n?"true":void 0}));fetch("".concat(window.location.href.substring(0,window.location.href.indexOf("?")),"/VERSION")).then((function(n){return n.text().then((function(n){return Lt=n}))}));var Vt=Object(H.b)((function(n){return{gameData:rt(n)}}))((function(n){var e=n.gameData;return Ht&&l.isLoaded(e)?R.a.createElement("button",{onFocus:function(n){return n.preventDefault()},style:{position:"absolute",top:5,left:5},onClick:function(){window.alert(function(n){return["maze algorithm:: ".concat(n.maze.algorithm),"maze dimensions:: ".concat(n.maze.dimension.width," x ").concat(n.maze.dimension.height),"entityCount:: ".concat((e=n.entityData,"\n\t"+Object.keys(e.typeMap).map((function(n){return"".concat(n,": ").concat(e.typeMap[n].length)})).join("\n\t"))),"step:: ".concat(n.stepCount),"version:: ".concat(Lt)].join("\n");var e}(e.data)),A.ifPresent((function(n){return n.blur()}),document.activeElement)}},"?"):R.a.createElement(R.a.Fragment,null)})),Ft=Object(H.b)((function(n){return{grid:ct(n),processingUpdates:it(n),messages:ut(n)}}),(function(n){return{onMove:function(e){return n((t=e,{type:Je.MOVE_PLAYER,direction:t}));var t}}}))((function(n){var e=n.grid,t=n.processingUpdates,r=n.messages,a=n.onMove;return R.a.createElement("div",{className:G.a.root},l.isLoading(e)&&R.a.createElement("span",null,"Loading . . . "),l.isLoaded(e)&&e.data&&R.a.createElement(R.a.Fragment,null,R.a.createElement(Vt,null),R.a.createElement(Ct,{processingUpdates:t,grid:e.data,onMove:a,messages:r})))})),Bt=t(13),Qt=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(nn.a)({game:l.loading(),chat:{messages:[],roundsSince:0}},n)},Yt=function(n){return Object(nn.a)({},n,{game:l.loading()})},Kt=function(n,e,t){return Object(nn.a)({},n,{game:l.loaded(v.create(e,E.fromEntities(t,e.dimension)))})},qt=function(n,e){return l.isLoaded(e.game)?n():e},Jt=function(n,e){return Object(nn.a)({},n,{stepId:e})},Xt=function(n,e,t){return qt((function(){return n.stepId===e?Object(nn.a)({},n,{game:l.loaded(t)}):n}),n)},Zt=function(n,e){return qt((function(){return n.stepId===e?Object(nn.a)({},n,{stepId:void 0,game:l.map((function(n){return Object(nn.a)({},n,{stepCount:n.stepCount+1})}),n.game),chat:Object(nn.a)({},n.chat,{messages:[_.create("")].concat(Object(B.a)(n.chat.messages)).slice(0,5),roundsSince:n.chat.roundsSince+=1})}):n}),n)},$t=function(n,e){return n.stepId===e?Object(nn.a)({},n,{stepId:void 0}):n},nr=function(n,e){return Object(nn.a)({},n,{chat:{messages:[e].concat(Object(B.a)(n.chat.messages)).slice(0,5),roundsSince:0}})},er=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qt(),e=arguments.length>1?arguments[1]:void 0;switch(e.type){case Je.REQUEST_STEP:return Jt(n,e.step.id);case Je.COMPLETE_STEP:return Zt(n,e.stepId);case Je.ABORT_STEP:return $t(n,e.stepId);case Je.PROCESS_STEP:return Xt(n,e.stepId,e.gameData);case Je.START_NEW_GAME:return Kt(n,e.maze,e.entities);case Je.REQUEST_NEW_GAME:return Yt(n);case Je.ADD_MESSAGE:return nr(n,e.message);default:return n}},tr=t(40),rr=t(7),ar=t.n(rr),ir=t(6),or=ar.a.mark(sr),cr=ar.a.mark(fr),ur=ar.a.mark(lr);function sr(){var n,e,t,r,a,i,o,c,u,s,d,f,p;return ar.a.wrap((function(m){for(;;)switch(m.prev=m.next){case 0:n=[];case 1:return m.prev=2,m.next=5,Object(ir.f)(Je.REQUEST_STEP);case 5:return e=m.sent,t=e.step,m.next=9,Object(ir.d)(rt);case 9:if(r=m.sent,!l.isLoaded(r)){m.next=58;break}return a=r.data,m.next=14,Object(ir.b)(x.validateAll,t.instructions,a);case 14:if(i=m.sent,!M.isErr(i)){m.next=19;break}return m.next=18,Object(ir.c)(zt(t.id));case 18:return m.abrupt("continue",1);case 19:return o=v.generateAllAIInstructions(a),c=[].concat(Object(B.a)(o),Object(B.a)(t.instructions)),m.next=23,Object(ir.b)(x.applyAll,c,a);case 23:if(u=m.sent,!M.isErr(u)){m.next=28;break}return m.next=27,Object(ir.c)(zt(t.id));case 27:return m.abrupt("continue",1);case 28:return m.next=30,Object(ir.b)(dr,a,u.data);case 30:return s=m.sent,m.next=33,Object(ir.b)(x.applyAll,s.reduce((function(n,e){return[].concat(Object(B.a)(n),Object(B.a)(e.instructions))}),[]),u.data);case 33:if(d=m.sent,!M.isErr(d)){m.next=38;break}return m.next=37,Object(ir.c)(zt(t.id));case 37:return m.abrupt("continue",1);case 38:return n=n.concat(D.phenomena(s)),m.next=41,Object(ir.b)(fr,n,a);case 41:return f=m.sent,m.next=44,Object(ir.b)(x.applyAll,f,d.data);case 44:if(p=m.sent,!M.isErr(p)){m.next=49;break}return m.next=48,Object(ir.c)(zt(t.id));case 48:return m.abrupt("continue",1);case 49:return m.next=51,Object(ir.b)(pr,n);case 51:return n=m.sent,m.next=54,Object(ir.c)(Gt(t.id,p.data));case 54:return m.next=56,Object(ir.b)(lr,p.data);case 56:return m.next=58,Object(ir.c)((y=t.id,{type:Je.COMPLETE_STEP,stepId:y}));case 58:m.next=64;break;case 60:m.prev=60,m.t0=m.catch(2),console.warn("Error processing step"),console.error(m.t0);case 64:m.next=1;break;case 66:case"end":return m.stop()}var y}),or,null,[[2,60]])}var dr=function(n,e){var t=E.getPlayer(e.entityData);return E.entitiesAtPoint(e.entityData,t.position,e.maze.dimension).filter((function(n){return n.id!==t.id})).concat(E.neighborsCrossedByEntity(n.entityData,e.entityData,t.id,e.maze.dimension)).map((function(n){return O.onCollideWithPlayer(n,e)}))};function fr(n,e){var t,r,a,i,o,c,u,s;return ar.a.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:t=[],r=!0,a=!1,i=void 0,d.prev=4,o=n[Symbol.iterator]();case 6:if(r=(c=o.next()).done){d.next=15;break}return u=c.value,d.next=10,Object(ir.b)(u.fn,e);case 10:s=d.sent,t=t.concat(s);case 12:r=!0,d.next=6;break;case 15:d.next=21;break;case 17:d.prev=17,d.t0=d.catch(4),a=!0,i=d.t0;case 21:d.prev=21,d.prev=22,r||null==o.return||o.return();case 24:if(d.prev=24,!a){d.next=27;break}throw i;case 27:return d.finish(24);case 28:return d.finish(21);case 29:return d.abrupt("return",t);case 30:case"end":return d.stop()}}),cr,null,[[4,17,21,29],[22,,24,28]])}function lr(n){var e,t,r;return ar.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e=n.state,t=n.entityData,r=E.getPlayer(t),!b.lost(e)){a.next=8;break}return a.next=5,Object(ir.b)(window.confirm,O.getKillMessage(E.getPlayer(t),E.byId(t,e.causeOfDeath.entityId)));case 5:window.location.reload(),a.next=12;break;case 8:if(!b.won(e)){a.next=12;break}return a.next=11,Object(ir.b)(window.confirm,"".concat(r.name," escaped. . . this time."));case 11:window.location.reload();case 12:case"end":return a.stop()}}),ur)}var pr=function(n){return n.map((function(n){return Object(nn.a)({},n,{duration:"FOREVER"!==n.duration?n.duration-1:n.duration})})).filter((function(n){return"FOREVER"===n.duration||n.duration>0}))},mr=ar.a.mark(yr);function yr(){return ar.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(ir.g)(Je.MOVE_PLAYER,ar.a.mark((function n(e){var t;return ar.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(ir.d)(ot);case 2:return t=n.sent,n.next=5,Object(ir.d)(it);case 5:if(n.sent||!t){n.next=9;break}return n.next=9,Object(ir.c)((r=S.create(e.direction?x.move(t.id,e.direction):x.wait(t.id)),{type:Je.REQUEST_STEP,step:r}));case 9:case"end":return n.stop()}var r}),n)})));case 2:case"end":return n.stop()}}),mr)}var Er=function(n){var e=function(n){return{id:p.create(),cls:P.ITEM,position:n}}(n);return Object(nn.a)({},e,{type:"orb-of-knowing",phenomena:vr(e.id),instruction:[]})},vr=function(n){return{name:Ce.KNOW_DOOR_LOCATION,duration:1,fn:function(e){return alert("You feel enlightened by the forces of providence.\nFor in thine posession is the Orb of Knowing."),[].concat(Object(B.a)(Wn(e.entityData,"exit").map((function(n){return n})).map((function(n){return ve(n.position,e.maze.dimension)})).map((function(n){return De([n])}))),[_e(n)])}}},br=ar.a.mark(gr),Or=ar.a.mark(wr),hr=A.withDefault(A.of(localStorage.getItem("name")),(function(){var n=window.prompt("What is your name?")||"";return""!==n&&localStorage.setItem("name",n),""!==n?n:"?"}));function gr(){return ar.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(ir.c)(Wt({mazeOptions:Object(nn.a)({dimension:a.randomItem([s.create(10,10),s.create(15,15),s.create(15,15),s.create(15,15),s.create(15,15),s.create(20,20),s.create(25,10),s.create(10,25),s.create(20,15),s.create(15,20),s.create(30,5),s.create(5,30)]),algorithm:a.randomItem(["aldous-broder","aldous-broder","aldous-broder","binary-tree","side-winder"])},d.randomDirectionalOptions())}));case 2:case"end":return n.stop()}}),br)}function wr(){var n,e,t,a,i,o,c,u;return ar.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=1,s.next=4,Object(ir.f)(Je.REQUEST_NEW_GAME);case 4:return n=s.sent,e=n.options,s.next=8,Object(ir.b)(r.maze,e.mazeOptions||{});case 8:return t=s.sent,a=f.fromMazeData(t),i=Tr(a),o=Object(dn.a)(i,2),c=o[0],u=o[1],s.next=13,Object(ir.c)(Ut(c,u));case 13:return s.next=15,Object(ir.c)((d=_.create("The game is afoot."),{type:Je.ADD_MESSAGE,message:d}));case 15:s.next=21;break;case 17:s.prev=17,s.t0=s.catch(1),console.warn("Error initializing new game"),console.error(s.t0);case 21:s.next=0;break;case 23:case"end":return s.stop()}var d}),Or,null,[[1,17]])}var Tr=function(n){var e=n.dimension,t=m.create(hr,s.pointAlongEdge(e)),r=new Array(i.randomInRange(1,5)).fill(void 0).map((function(n){return h.create(s.randomPoint(e))})),o=new Array(a.randomItem([1,1,2,2,3])).fill(void 0).map((function(n){return g.create(s.randomPoint(e))})),c=[].concat(Object(B.a)(r),Object(B.a)(o)),u=f.placeEntitiesInDeadEnds(n,[w.create,I.create,T.create]),d=u.placed,l=u.maze,p=u.unplaced;return p.length>0&&console.log("Ran out of deadends to place these entities ".concat(p.map((function(n){return n.type})).join(", "))),[l,[t].concat(Object(B.a)(c),Object(B.a)(d))]},jr=ar.a.mark(xr),Sr=[gr,wr,sr,yr];function xr(){return ar.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(ir.a)(Sr.map((function(n){return Object(ir.e)(n)})));case 2:case"end":return n.stop()}}),jr)}L.a.render(R.a.createElement(H.a,{store:function(){var n=Object(tr.a)(),e=Object(Bt.d)(er,Object(Bt.a)(n));return n.run(xr),e}()},R.a.createElement("div",{className:U.a.app},R.a.createElement(Ft,null))),document.getElementById("root"))},8:function(n,e,t){n.exports={root:"GamePad_root__Lay6t",row:"GamePad_row__164Sm",block:"GamePad_block__l2_xd",button:"GamePad_button__3kDFo",wait:"GamePad_wait__5DVYu"}}},[[43,1,2]]]);
//# sourceMappingURL=main.a707ba1f.chunk.js.map