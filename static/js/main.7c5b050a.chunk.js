(this.webpackJsonpfollowed=this.webpackJsonpfollowed||[]).push([[0],{16:function(n,t,e){n.exports={root:"Cell_root__2ti8K",empty:"Cell_empty__1ByI9",seen:"Cell_seen__2qSTX",visible:"Cell_visible__2bnT3",unknown:"Cell_unknown__2tYkG"}},24:function(n,t,e){n.exports={root:"Grid_root__xSU_B",row:"Grid_row__1rWaL"}},28:function(n,t){},29:function(n,t,e){n.exports={app:"index_app__2lpzC"}},30:function(n,t,e){n.exports={root:"App_root__ZxxJN"}},33:function(n,t,e){n.exports={root:"Entity_root__MaGTf"}},40:function(n,t,e){n.exports=e(53)},53:function(n,t,e){"use strict";e.r(t);var r={};e.r(r),e.d(r,"maze",(function(){return Y}));var a={};e.r(a),e.d(a,"nOf",(function(){return F})),e.d(a,"sorted",(function(){return V})),e.d(a,"nonNull",(function(){return Q})),e.d(a,"randomItem",(function(){return K}));var o={};e.r(o),e.d(o,"randomInRange",(function(){return q}));var i={};e.r(i),e.d(i,"centerOnPoint",(function(){return J}));var u={};e.r(u),e.d(u,"getSiteSetting",(function(){return X}));var c={};e.r(c),e.d(c,"parseQuery",(function(){return nn}));var s={};e.r(s),e.d(s,"create",(function(){return tn})),e.d(s,"area",(function(){return en})),e.d(s,"randomPoint",(function(){return rn})),e.d(s,"pointAlongEdge",(function(){return an})),e.d(s,"inBounds",(function(){return on}));var d={};e.r(d),e.d(d,"fromApi",(function(){return un}));var f={};e.r(f),e.d(f,"fromMazeData",(function(){return sn})),e.d(f,"canWalk",(function(){return dn})),e.d(f,"canTravel",(function(){return fn})),e.d(f,"lookInDirection",(function(){return ln})),e.d(f,"peekableCorners",(function(){return pn})),e.d(f,"seenFromPoint",(function(){return mn}));var l={};e.r(l),e.d(l,"isLoading",(function(){return yn})),e.d(l,"isLoaded",(function(){return bn})),e.d(l,"isErrored",(function(){return En})),e.d(l,"loading",(function(){return vn})),e.d(l,"loaded",(function(){return On})),e.d(l,"errored",(function(){return hn})),e.d(l,"map",(function(){return gn}));var p={};e.r(p),e.d(p,"create",(function(){return Tn}));var m={};e.r(m),e.d(m,"create",(function(){return xn})),e.d(m,"randomDisplayName",(function(){return Sn}));var y={};e.r(y),e.d(y,"EntityClass",(function(){return D})),e.d(y,"baseItem",(function(){return jn}));var b={};e.r(b),e.d(b,"fromEntities",(function(){return An})),e.d(b,"entitiesAtPoint",(function(){return _n})),e.d(b,"getPlayer",(function(){return In})),e.d(b,"byId",(function(){return Mn})),e.d(b,"byType",(function(){return Dn})),e.d(b,"moveEntity",(function(){return Pn})),e.d(b,"updateEntity",(function(){return Nn})),e.d(b,"entitiesCrossed",(function(){return Rn})),e.d(b,"neighborsCrossedByEntity",(function(){return Ln}));var E={};e.r(E),e.d(E,"create",(function(){return Cn})),e.d(E,"displayGrid",(function(){return Wn})),e.d(E,"generateAllAIInstructions",(function(){return Un}));var v={};e.r(v),e.d(v,"win",(function(){return Hn})),e.d(v,"lose",(function(){return Gn})),e.d(v,"play",(function(){return zn})),e.d(v,"won",(function(){return Yn})),e.d(v,"lost",(function(){return Bn})),e.d(v,"playing",(function(){return Fn}));var O={};e.r(O),e.d(O,"getColor",(function(){return Vn})),e.d(O,"getDisplayName",(function(){return Qn})),e.d(O,"getDescription",(function(){return Kn})),e.d(O,"generateAiInstructions",(function(){return qn})),e.d(O,"onCollideWithPlayer",(function(){return Jn})),e.d(O,"getKillMessage",(function(){return Xn}));var h={};e.r(h),e.d(h,"create",(function(){return Zn})),e.d(h,"next",(function(){return $n})),e.d(h,"DISPLAY",(function(){return nt}));var g={};e.r(g),e.d(g,"create",(function(){return tt})),e.d(g,"next",(function(){return et})),e.d(g,"wander",(function(){return rt})),e.d(g,"lookForPlayerInDirection",(function(){return at})),e.d(g,"DISPLAY",(function(){return ot}));var w={};e.r(w),e.d(w,"create",(function(){return it})),e.d(w,"DISPLAY",(function(){return ut}));var T={};e.r(T),e.d(T,"create",(function(){return ct})),e.d(T,"toIndex",(function(){return st})),e.d(T,"fromIndex",(function(){return dt})),e.d(T,"neighbor",(function(){return ft})),e.d(T,"neighbors",(function(){return lt})),e.d(T,"diagonalNeighbors",(function(){return pt})),e.d(T,"equals",(function(){return mt}));var x={};e.r(x),e.d(x,"create",(function(){return yt}));var S={};e.r(S),e.d(S,"move",(function(){return Et})),e.d(S,"update",(function(){return Ot})),e.d(S,"wait",(function(){return ht})),e.d(S,"updateGameState",(function(){return gt})),e.d(S,"see",(function(){return wt})),e.d(S,"validate",(function(){return Tt})),e.d(S,"validateAll",(function(){return xt})),e.d(S,"apply",(function(){return St})),e.d(S,"applyAll",(function(){return kt}));var k={};e.r(k),e.d(k,"Direction",(function(){return bt})),e.d(k,"all",(function(){return At})),e.d(k,"inverse",(function(){return _t})),e.d(k,"random",(function(){return It}));var j={};e.r(j),e.d(j,"ok",(function(){return Mt})),e.d(j,"err",(function(){return Dt})),e.d(j,"isErr",(function(){return Pt})),e.d(j,"isOk",(function(){return Nt})),e.d(j,"map",(function(){return Rt}));var A={};e.r(A),e.d(A,"of",(function(){return Lt})),e.d(A,"none",(function(){return Ct})),e.d(A,"withDefault",(function(){return Wt})),e.d(A,"map",(function(){return Ut})),e.d(A,"ifPresent",(function(){return Ht}));var _={};e.r(_),e.d(_,"Phenomena",(function(){return jt}));var I={};e.r(I),e.d(I,"create",(function(){return zt})),e.d(I,"instructions",(function(){return Yt})),e.d(I,"phenomena",(function(){return Bt}));var M={};e.r(M),e.d(M,"orbOfKnowing",(function(){return $e})),e.d(M,"knowing",(function(){return nr}));var D,P=e(1),N=e.n(P),R=e(19),L=e.n(R),C=e(29),W=e.n(C),U=e(30),H=e.n(U),G=e(17),z="https://fv9o21r19a.execute-api.us-east-1.amazonaws.com/dev",Y=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.dimension,e=void 0===t?s.create(10,10):t,r=n.algorithm,a=void 0===r?"aldous-broder":r,o=fetch("".concat(z),{method:"post",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify({dimensions:e,algorithm:a})});return o.then((function(n){return n.text()})).then((function(n){return d.fromApi(e,a,n)}))},B=e(6),F=function(n,t){return new Array(n).fill(t)},V=function(n,t){var e=Object(B.a)(n);return e.sort(t),e},Q=function(n){return n.filter((function(n){return null!=n}))},K=function(n){return n[Math.floor(Math.random()*n.length)]},q=function(n,t){return n+Math.floor(Math.random()*(t-n-1))},J=function(n,t,e){for(var r=t.x-e,a=t.x+e+1,o=t.y-e,i=t.y+e+1,u=[],c=o;c<i;c++){for(var s=[],d=function(t){s.push(A.map((function(n){return n[t]}),n[c]))},f=r;f<a;f++)d(f);u.push(s)}return u},X=function(n,t){return A.withDefault(window.localStorage.getItem("".concat("followed.settings",".").concat(n)),(function(){var e=t();if(e)return window.localStorage.setItem("".concat("followed.settings",".").concat(n),e),e}))},Z=e(10),$=e(3),nn=function(){return window.location.search.substring(1).split("&").reduce((function(n,t){var e=t.split("=");return Object($.a)({},n,Object(Z.a)({},e[0],e[1]))}),{})},tn=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{width:n,height:t}},en=function(n){return n.width*n.height},rn=function(n){return T.fromIndex(Math.floor(Math.random()*en(n)),n)},an=function(n){var t=Math.random()>.5;return T.create(t?o.randomInRange(0,n.width):Math.random()>.5?0:n.width-1,t?Math.random()>.5?0:n.height-1:o.randomInRange(0,n.height))},on=function(n,t){return t.x>=0&&t.y>=0&&t.x<n.width&&t.y<n.height},un=function(n,t,e){return{bytes:Uint8Array.from(atob(e),(function(n){return n.charCodeAt(0)})),dimension:n,algorithm:t}},cn=function(n){return{walls:(t={n:!((8&n)>0),s:!((4&n)>0),e:!((2&n)>0),w:!((1&n)>0)},{n:t.n||!1,e:t.e||!1,s:t.s||!1,w:t.w||!1})};var t},sn=function(n){for(var t=n.dimension,e=n.bytes,r=n.algorithm,a=[],o=0;o<t.height;o++){for(var i=[],u=0;u<t.width;u++)i.push(cn(e[o*t.width+u]));a.push(i)}return{grid:a,dimension:t,algorithm:r}},dn=function(n,t,e){var r=t.x,a=t.y;return!function(n,t){var e=n.walls;switch(t){case k.Direction.NORTH:return e.n;case k.Direction.EAST:return e.e;case k.Direction.SOUTH:return e.s;case k.Direction.WEST:return e.w}}(n.grid[a][r],e)},fn=function(n,t){for(var e=arguments.length,r=new Array(e>2?e-2:0),a=2;a<e;a++)r[a-2]=arguments[a];return!!r.reduce((function(t,e){return t&&dn(n,t,e)?T.neighbor(t,e):void 0}),t)},ln=function n(t,e,r,a){if(dn(t,r,e)&&a>0){var o=T.neighbor(r,e);return[o].concat(Object(B.a)(n(t,e,o,a-1)))}return[]},pn=function(n,t){var e=[];return(fn(n,t,k.Direction.NORTH,k.Direction.EAST)||fn(n,t,k.Direction.EAST,k.Direction.NORTH))&&e.push(T.create(t.x+1,t.y-1)),(fn(n,t,k.Direction.NORTH,k.Direction.WEST)||fn(n,t,k.Direction.WEST,k.Direction.NORTH))&&e.push(T.create(t.x-1,t.y-1)),(fn(n,t,k.Direction.SOUTH,k.Direction.EAST)||fn(n,t,k.Direction.EAST,k.Direction.SOUTH))&&e.push(T.create(t.x+1,t.y+1)),(fn(n,t,k.Direction.SOUTH,k.Direction.WEST)||fn(n,t,k.Direction.WEST,k.Direction.SOUTH))&&e.push(T.create(t.x-1,t.y+1)),e},mn=function(n,t,e){return k.all().reduce((function(r,a){return r.concat(ln(n,a,t,e))}),[]).concat(pn(n,t)).concat(t)},yn=function(n){return"Loading"===n.state},bn=function(n){return"Loaded"===n.state},En=function(n){return"Errored"===n.state},vn=function(){return{state:"Loading"}},On=function(n){return{state:"Loaded",data:n}},hn=function(n){return{state:"Errored",e:n}},gn=function(n,t){return bn(t)?On(n(t.data)):t},wn=e(32),Tn=function(){return Object(wn.v4)()},xn=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.create(),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Sn();return{id:p.create(),name:n,position:t,type:"player",visionRadius:e,displayName:r||n,cls:y.EntityClass.PLAYER}},Sn=function(){return a.randomItem(["\ud83d\udc15","\ud83d\udc26","\ud83d\udc08","\ud83d\udc0e","\ud83d\udc16","\ud83d\udc01","\ud83d\udc00","\ud83d\udc22"])};!function(n){n.PLAYER="PLAYER",n.INANIMATE="INANIMATE",n.HOSTILE="HOSTILE",n.ITEM="ITEM"}(D||(D={}));var kn,jn=function(n){return{id:p.create(),cls:D.ITEM,position:n}},An=function(n,t){return{entityMap:n.reduce((function(n,t){return n[t.id]=t,n}),{}),positionMap:n.reduce((function(n,e){var r=T.toIndex(e.position,t);return n[r]=n[r]?[].concat(Object(B.a)(n[r]),[e.id]):[e.id],n}),{}),playerEntityId:A.map((function(n){return n.id}),n.find((function(n){return"player"===n.type}))),typeMap:n.reduce((function(n,t){return Object($.a)({},n,Object(Z.a)({},t.type,n[t.type]?[].concat(Object(B.a)(n[t.type]),[t.id]):[t.id]))}),{})}},_n=function(n,t,e){var r=T.toIndex(t,e);return(n.positionMap[r]||[]).map((function(t){return n.entityMap[t]}))},In=function(n){return A.map((function(t){return n.entityMap[t]}),n.playerEntityId)},Mn=function(n,t){return n.entityMap[t]},Dn=function(n,t){return a.nonNull(n.typeMap[t]||[]).map((function(t){return n.entityMap[t]}))},Pn=function(n,t,e,r){var a=t.entityMap[n];if(null!=a){var o,i=T.toIndex(a.position,r),u=T.toIndex(e,r),c=Object($.a)({},a,{position:e});return Object($.a)({},t,{entityMap:Object($.a)({},t.entityMap,Object(Z.a)({},n,c)),positionMap:Object($.a)({},t.positionMap,(o={},Object(Z.a)(o,i,Object(B.a)((t.positionMap[i]||[]).filter((function(t){return t!==n})))),Object(Z.a)(o,u,[].concat(Object(B.a)(t.positionMap[u]||[]),[n])),o))})}return t},Nn=function(n,t){return Object($.a)({},t,{entityMap:Object($.a)({},t.entityMap,Object(Z.a)({},n.id,n))})},Rn=function(n,t,e,r){var a=n.entityMap[e],o=n.entityMap[r],i=t.entityMap[e],u=t.entityMap[r];return T.equals(i.position,o.position)&&T.equals(u.position,a.position)},Ln=function(n,t,e,r){return T.neighbors(t.entityMap[e].position,r).map((function(n){return T.toIndex(n,r)})).reduce((function(n,e){return n.concat(t.positionMap[e]||[])}),[]).filter((function(r){return Rn(n,t,e,r)})).map((function(n){return t.entityMap[n]}))},Cn=function(n,t){var e=b.getPlayer(t),r=new Set(e?f.seenFromPoint(n,e.position,e.visionRadius).map((function(t){return T.toIndex(t,n.dimension)})):[]);return{maze:n,entityData:t,seen:new Set,sees:r,stepCount:0,state:v.play()}},Wn=function(n){var t=n.maze,e=n.entityData,r=n.seen,a=n.sees;return t.grid.reduce((function(n,o,i){return[].concat(Object(B.a)(n),[o.reduce((function(n,o,u){var c=T.create(u,i),s=r.has(T.toIndex(c,t.dimension)),d=a.has(T.toIndex(c,t.dimension));return n.concat({cell:o,meta:{occupants:b.entitiesAtPoint(e,T.create(u,i),t.dimension),visible:d,seen:s,unknown:!d&&!s}})}),[])])}),[])},Un=function(n){return Object.keys(n.entityData.entityMap).map((function(t){return b.byId(n.entityData,t)})).filter((function(n){return"player"!==n.type})).reduce((function(t,e){return t.concat(O.generateAiInstructions(e,n))}),[])},Hn=function(){return{type:"Won"}},Gn=function(n){return{type:"Lost",causeOfDeath:n}},zn=function(){return{type:"Playing"}},Yn=function(n){return"Won"===n.type},Bn=function(n){return"Lost"===n.type},Fn=function(n){return"Playing"===n.type},Vn=function(n){return n.type,"transparent"},Qn=function(n){switch(n.type){case"player":return n.displayName;case"blind-guardian":return h.DISPLAY;case"exit":return w.DISPLAY;case"wandering-husk":return g.DISPLAY;case"orb-of-knowing":return"\ud83d\udfe3"}},Kn=function(n){switch(n.type){case"player":return n.name;case"blind-guardian":return"a blind guardian";case"exit":return"an exit";case"wandering-husk":return"a wandering husk";case"orb-of-knowing":return"a mysterious, translucent orb"}},qn=function(n,t){switch(n.type){case"blind-guardian":return h.next(n,t);case"wandering-husk":return g.next(n,t);default:return[]}},Jn=function(n,t){return n.cls===D.HOSTILE?I.create([S.updateGameState(v.lose({entityId:n.id}))]):n.cls===D.ITEM?I.create(void 0,[n.phenomena]):"exit"===n.type?I.create([S.updateGameState(v.win())]):I.create()},Xn=function(n,t){switch(t.type){case"blind-guardian":return"".concat(n.name," has been annihilated by ").concat(Kn(t),". Nothing is left.");case"wandering-husk":return"Blood and sinew cling to the maw of the wandering husk. ".concat(n.name," has been consumed.");default:return"".concat(n.name," was killed by ").concat(Kn(t))}},Zn=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.create();return{type:"blind-guardian",position:n,id:p.create(),heading:k.Direction.NORTH,cls:y.EntityClass.HOSTILE}},$n=function(n,t){var e,r=k.all().filter((function(e){return f.canWalk(t.maze,n.position,e)})),o=r.filter((function(t){return t!==k.inverse(n.heading)}));return e=r.includes(n.heading)&&Math.random()<.75?n.heading:Math.random()<.75&&o.length>0?a.randomItem(o):r[0],[S.update(Object($.a)({},n,{heading:e})),S.move(n.id,e)]},nt="\ud83d\uddff",tt=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.create();return{type:"wandering-husk",position:n,id:p.create(),heading:k.random(),cls:y.EntityClass.HOSTILE}},et=function(n,t){var e,r=k.all().reduce((function(e,r){return e||(at(r,n.position,t)?r:void 0)}),void 0),a=[];return r?Math.random()<.9?(e=r,a.push(S.move(n.id,e))):(e=n.heading,a.push(S.wait(n.id))):(e=rt(n,t),a.push(S.move(n.id,e))),[S.update(Object($.a)({},n,{heading:e}))].concat(a)},rt=function(n,t){var e=k.all().filter((function(e){return f.canWalk(t.maze,n.position,e)})),r=e.filter((function(t){return t!==k.inverse(n.heading)}));return e.includes(n.heading)&&Math.random()<.75?n.heading:Math.random()<.75&&r.length>0?a.randomItem(r):e[0]},at=function(n,t,e){return f.lookInDirection(e.maze,n,t,5).reduce((function(n,t){return n||null!=b.entitiesAtPoint(e.entityData,t,e.maze.dimension).find((function(n){return"player"===n.type}))}),!1)},ot="\ud83e\udddf",it=function(n){return{position:n,id:p.create(),type:"exit",cls:y.EntityClass.INANIMATE}},ut="\ud83d\udeaa",ct=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{x:n,y:t}},st=function(n,t){var e=n.x;return n.y*t.width+e},dt=function(n,t){var e=t.width;return ct(n%e,Math.floor(n/e))},ft=function(n,t){switch(t){case"NORTH":return T.create(n.x,n.y-1);case"SOUTH":return T.create(n.x,n.y+1);case"EAST":return T.create(n.x+1,n.y);case"WEST":default:return T.create(n.x-1,n.y)}},lt=function(n,t){return k.all().map((function(t){return ft(n,t)})).filter((function(n){return s.inBounds(t,n)}))},pt=function(n,t){return[ct(n.x-1,n.y-1),ct(n.x+1,n.y-1),ct(n.x+1,n.y+1),ct(n.x-1,n.y+1)].filter((function(n){return s.inBounds(t,n)}))},mt=function(n,t){return n.x===t.x&&n.y===t.y},yt=function(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];return{instructions:t,id:p.create()}};!function(n){n.MOVE="MOVE",n.UPDATE="UPDATE",n.WAIT="WAIT",n.UPDATE_GAME_STATE="UPDATE_GAME_STATE",n.SEE="SEE"}(kn||(kn={}));var bt,Et=function(n,t){return{type:kn.MOVE,payload:{entityId:n,direction:t}}},vt=function(n,t,e){var r=new Set(f.seenFromPoint(e,t.position,t.visionRadius).map((function(n){return T.toIndex(n,e.dimension)})));return{sees:r,seen:new Set([].concat(Object(B.a)(n),Object(B.a)(r)))}},Ot=function(n){return{type:kn.UPDATE,payload:{updated:n}}},ht=function(n){return{type:kn.WAIT,payload:{entityId:n}}},gt=function(n){return{type:kn.UPDATE_GAME_STATE,payload:{updated:n}}},wt=function(n){return{type:kn.SEE,payload:n}},Tt=function(n,t){switch(n.type){case kn.MOVE:return function(n,t){var e=n.payload;return f.canWalk(t.maze,t.entityData.entityMap[e.entityId].position,e.direction)?j.ok(void 0):j.err("way is blocked")}(n,t);case kn.WAIT:return j.ok(void 0);default:return j.err("Unkown instruction of type ".concat(n.type))}},xt=function(n,t){return n.reduce((function(n,e){return j.isOk(n)?Tt(e,t):n}),j.ok(void 0))},St=function(n,t){try{switch(n.type){case kn.MOVE:return j.ok(function(n,t){var e=n.payload,r=e.entityId,a=e.direction,o=b.moveEntity(r,t.entityData,T.neighbor(t.entityData.entityMap[r].position,a),t.maze.dimension),i=b.getPlayer(o),u=i&&r===i.id?vt(t.seen,i,t.maze):t,c=u.seen,s=u.sees;return Object($.a)({},t,{seen:c,sees:s,entityData:o})}(n,t));case kn.UPDATE:return j.ok(function(n,t){return Object($.a)({},t,{entityData:b.updateEntity(n.payload.updated,t.entityData)})}(n,t));case kn.WAIT:return j.ok(function(n,t){return Object($.a)({},t)}(0,t));case kn.UPDATE_GAME_STATE:return j.ok(function(n,t){return Object($.a)({},t,{state:v.lost(t.state)?t.state:n.payload.updated})}(n,t));case kn.SEE:return j.ok(function(n,t){return Object($.a)({},t,{seen:new Set([].concat(Object(B.a)(t.seen),Object(B.a)(n.payload)))})}(n,t))}}catch(e){return console.warn("Error applying instruction",n),console.error(e),j.err("Error applying instructions")}},kt=function(n,t){return n.reduce((function(n,t){return j.isOk(n)?St(t,n.data):n}),j.ok(t))};!function(n){n.NORTH="NORTH",n.SOUTH="SOUTH",n.EAST="EAST",n.WEST="WEST"}(bt||(bt={}));var jt,At=function(){return[bt.NORTH,bt.SOUTH,bt.EAST,bt.WEST]},_t=function(n){switch(n){case bt.NORTH:return bt.SOUTH;case bt.SOUTH:return bt.NORTH;case bt.EAST:return bt.WEST;case bt.WEST:return bt.EAST}},It=function(){return a.randomItem(At())},Mt=function(n){return{type:"Ok",data:n}},Dt=function(n){return{type:"Error",msg:n}},Pt=function(n){return"Error"===n.type},Nt=function(n){return"Ok"===n.type},Rt=function(n,t){return Nt(t)?Mt(n(t.data)):t},Lt=(e(28),function(n){return n}),Ct=function(){},Wt=function(n,t){return null!=n?n:"function"===typeof t?t():t},Ut=function(n,t){return null!=t?n(t):void 0},Ht=function(n,t){t&&n(t)};!function(n){n[n.FORGETTING=0]="FORGETTING",n[n.KNOW_DOOR_LOCATION=1]="KNOW_DOOR_LOCATION"}(jt||(jt={}));var Gt,zt=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{instructions:n,phenomena:t}},Yt=function(n){return n.reduce((function(n,t){return[].concat(Object(B.a)(n),Object(B.a)(t.instructions))}),[])},Bt=function(n){return n.reduce((function(n,t){return[].concat(Object(B.a)(n),Object(B.a)(t.phenomena))}),[])},Ft=e(18),Vt=function(n){return n},Qt=Object(Ft.a)(Vt,(function(n){return n.game})),Kt=Object(Ft.a)(Qt,(function(n){return l.map(E.displayGrid,n)})),qt=Object(Ft.a)(Vt,(function(n){return null!=n.stepId})),Jt=Object(Ft.a)(Qt,(function(n){return l.isLoaded(n)?A.map((function(t){return n.data.entityData.entityMap[t]}),n.data.entityData.playerEntityId):void 0})),Xt=Object(Ft.a)(Kt,Jt,(function(n,t){return l.map((function(n){return null!=t?i.centerOnPoint(n,t.position,3):[]}),n)})),Zt=e(16),$t=e.n(Zt),ne=e(13),te=e.n(ne),ee=e(33),re=e.n(ee),ae=function(n){return N.a.createElement("div",{className:re.a.root},O.getDisplayName(n))},oe=function(n){return n?"0.5px solid cyan":"0.5px transparent"},ie=function(n){var t,e=n.cell,r=n.meta,a=e.walls;return N.a.createElement("div",{className:te()($t.a.root,(t={},Object(Z.a)(t,$t.a.seen,r.seen),Object(Z.a)(t,$t.a.visible,r.visible),Object(Z.a)(t,$t.a.unknown,!r.seen&&!r.visible),t)),style:r.unknown?void 0:{borderTop:oe(a.n),borderRight:oe(a.e),borderBottom:oe(a.s),borderLeft:oe(a.w)}},A.map((function(n){return N.a.createElement(ae,n)}),function(n){var t=n.visible,e=n.seen,r=n.occupants;return t?A.withDefault(r.find((function(n){return"player"!==n.type&&"exit"!==n.type})),r[0]):e?r.find((function(n){return"exit"===n.type})):void 0}(r)))},ue=function(){return N.a.createElement("div",{className:te()($t.a.empty,$t.a.root)})},ce=e(24),se=e.n(ce),de=function(n){var t=n.grid;return N.a.createElement("div",{className:se.a.root},t.map((function(n,t){return N.a.createElement("div",{key:t,className:se.a.row},n.map((function(n,t){return A.withDefault(A.map((function(n){return N.a.createElement(ie,{key:t,cell:n.cell,meta:n.meta})}),n),N.a.createElement(ue,{key:t}))})))})))},fe=e(8),le=e.n(fe),pe=function(n){var t=n.onMove;return N.a.createElement("div",{className:le.a.root},N.a.createElement("div",{className:le.a.row},N.a.createElement("div",{className:le.a.block}),N.a.createElement("button",{className:te()(le.a.block,le.a.button),onClick:function(){return t(k.Direction.NORTH)}}),N.a.createElement("div",{className:le.a.block})),N.a.createElement("div",{className:le.a.row},N.a.createElement("button",{className:te()(le.a.block,le.a.button),onClick:function(){return t(k.Direction.WEST)}}),N.a.createElement("button",{className:te()(le.a.block,le.a.button,le.a.wait),onClick:function(){return t(void 0)}}),N.a.createElement("button",{className:te()(le.a.block,le.a.button),onClick:function(){return t(k.Direction.EAST)}})),N.a.createElement("div",{className:le.a.row},N.a.createElement("div",{className:le.a.block}),N.a.createElement("button",{className:te()(le.a.block,le.a.button),onClick:function(){return t(k.Direction.SOUTH)}}),N.a.createElement("div",{className:le.a.block})))},me=e(34),ye=e(35),be=e(38),Ee=e(36),ve=e(39),Oe=function(n){function t(){var n,e;Object(me.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=Object(be.a)(this,(n=Object(Ee.a)(t)).call.apply(n,[this].concat(a)))).handleKeyDown=function(n){e.props.disabled||("ArrowUp"===n.key||"w"===n.key?e.props.onMove(k.Direction.NORTH):"ArrowRight"===n.key||"d"===n.key?e.props.onMove(k.Direction.EAST):"ArrowDown"===n.key||"d"===n.key?e.props.onMove(k.Direction.SOUTH):"ArrowLeft"===n.key||"a"===n.key?e.props.onMove(k.Direction.WEST):" "!==n.key&&"Enter"!==n.key||e.props.onMove(void 0))},e}return Object(ve.a)(t,n),Object(ye.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleKeyDown)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){return P.createElement(P.Fragment,null)}}]),t}(P.PureComponent),he=function(n){var t=n.grid,e=n.onMove,r=n.processingUpdates;return P.createElement(P.Fragment,null,P.createElement(de,{grid:t}),P.createElement(pe,{onMove:e}),P.createElement(Oe,{onMove:e,disabled:r}))};!function(n){n.REQUEST_NEW_GAME="REQUEST_NEW_GAME",n.START_NEW_GAME="START_NEW_GAME",n.REQUEST_STEP="REQUEST_STEP",n.PROCESS_STEP="PROCESS_STEP",n.COMPLETE_STEP="COMPLETE_STEP",n.ABORT_STEP="ABORT_STEP",n.MOVE_PLAYER="MOVE_PLAYER"}(Gt||(Gt={}));var ge,we=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:Gt.REQUEST_NEW_GAME,options:n}},Te=function(n,t){return{type:Gt.START_NEW_GAME,maze:n,entities:t}},xe=function(n){return{type:Gt.ABORT_STEP,stepId:n}},Se=function(n,t){return{type:Gt.PROCESS_STEP,stepId:n,gameData:t}},ke="true"===u.getSiteSetting("devmode",(function(){var n=c.parseQuery().devmode;return n&&"false"!==n?"true":void 0}));fetch("".concat(window.location.href.substring(0,window.location.href.indexOf("?")),"/VERSION")).then((function(n){return n.text().then((function(n){return ge=n}))}));var je=Object(G.b)((function(n){return{gameData:Qt(n)}}))((function(n){var t=n.gameData;return ke&&l.isLoaded(t)?N.a.createElement("button",{onFocus:function(n){return n.preventDefault()},style:{position:"absolute",top:5,left:5},onClick:function(){window.alert(function(n){return["maze algorithm:: ".concat(n.maze.algorithm),"maze dimensions:: ".concat(n.maze.dimension.width," x ").concat(n.maze.dimension.height),"entityCount:: ".concat((t=n.entityData,"\n\t"+Object.keys(t.typeMap).map((function(n){return"".concat(n,": ").concat(t.typeMap[n].length)})).join("\n\t"))),"step:: ".concat(n.stepCount),"version:: ".concat(ge)].join("\n");var t}(t.data)),A.ifPresent((function(n){return n.blur()}),document.activeElement)}},"?"):N.a.createElement(N.a.Fragment,null)})),Ae=Object(G.b)((function(n){return{grid:Xt(n),processingUpdates:qt(n)}}),(function(n){return{onMove:function(t){return n((e=t,{type:Gt.MOVE_PLAYER,direction:e}));var e}}}))((function(n){var t=n.grid,e=n.processingUpdates,r=n.onMove;return N.a.createElement("div",{className:H.a.root},l.isLoading(t)&&N.a.createElement("span",null,"Loading . . . "),l.isLoaded(t)&&t.data&&N.a.createElement(N.a.Fragment,null,N.a.createElement(je,null),N.a.createElement(he,{processingUpdates:e,grid:t.data,onMove:r})))})),_e=e(14),Ie=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object($.a)({game:l.loading()},n)},Me=function(n){return Object($.a)({},n,{game:l.loading()})},De=function(n,t,e){return Object($.a)({},n,{game:l.loaded(E.create(t,b.fromEntities(e,t.dimension)))})},Pe=function(n,t){return l.isLoaded(t.game)?n():t},Ne=function(n,t){return Object($.a)({},n,{stepId:t})},Re=function(n,t,e){return Pe((function(){return n.stepId===t?Object($.a)({},n,{game:l.loaded(e)}):n}),n)},Le=function(n,t){return Pe((function(){return n.stepId===t?Object($.a)({},n,{stepId:void 0,game:l.map((function(n){return Object($.a)({},n,{stepCount:n.stepCount+1})}),n.game)}):n}),n)},Ce=function(n,t){return n.stepId===t?Object($.a)({},n,{stepId:void 0}):n},We=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ie(),t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Gt.REQUEST_STEP:return Ne(n,t.step.id);case Gt.COMPLETE_STEP:return Le(n,t.stepId);case Gt.ABORT_STEP:return Ce(n,t.stepId);case Gt.PROCESS_STEP:return Re(n,t.stepId,t.gameData);case Gt.START_NEW_GAME:return De(n,t.maze,t.entities);case Gt.REQUEST_NEW_GAME:return Me(n);default:return n}},Ue=e(37),He=e(7),Ge=e.n(He),ze=e(5),Ye=Ge.a.mark(Ve),Be=Ge.a.mark(Ke),Fe=Ge.a.mark(qe);function Ve(){var n,t,e,r,a,o,i,u,c,s,d,f,p;return Ge.a.wrap((function(m){for(;;)switch(m.prev=m.next){case 0:n=[];case 1:return m.prev=2,m.next=5,Object(ze.f)(Gt.REQUEST_STEP);case 5:return t=m.sent,e=t.step,m.next=9,Object(ze.d)(Qt);case 9:if(r=m.sent,!l.isLoaded(r)){m.next=58;break}return a=r.data,m.next=14,Object(ze.b)(S.validateAll,e.instructions,a);case 14:if(o=m.sent,!j.isErr(o)){m.next=19;break}return m.next=18,Object(ze.c)(xe(e.id));case 18:return m.abrupt("continue",1);case 19:return i=E.generateAllAIInstructions(a),u=[].concat(Object(B.a)(i),Object(B.a)(e.instructions)),m.next=23,Object(ze.b)(S.applyAll,u,a);case 23:if(c=m.sent,!j.isErr(c)){m.next=28;break}return m.next=27,Object(ze.c)(xe(e.id));case 27:return m.abrupt("continue",1);case 28:return m.next=30,Object(ze.b)(Qe,a,c.data);case 30:return s=m.sent,m.next=33,Object(ze.b)(S.applyAll,s.reduce((function(n,t){return[].concat(Object(B.a)(n),Object(B.a)(t.instructions))}),[]),c.data);case 33:if(d=m.sent,!j.isErr(d)){m.next=38;break}return m.next=37,Object(ze.c)(xe(e.id));case 37:return m.abrupt("continue",1);case 38:return n=n.concat(I.phenomena(s)),m.next=41,Object(ze.b)(Ke,n,a);case 41:return f=m.sent,m.next=44,Object(ze.b)(S.applyAll,f,d.data);case 44:if(p=m.sent,!j.isErr(p)){m.next=49;break}return m.next=48,Object(ze.c)(xe(e.id));case 48:return m.abrupt("continue",1);case 49:return m.next=51,Object(ze.b)(Je,n);case 51:return n=m.sent,m.next=54,Object(ze.c)(Se(e.id,p.data));case 54:return m.next=56,Object(ze.b)(qe,p.data);case 56:return m.next=58,Object(ze.c)((y=e.id,{type:Gt.COMPLETE_STEP,stepId:y}));case 58:m.next=64;break;case 60:m.prev=60,m.t0=m.catch(2),console.warn("Error processing step"),console.error(m.t0);case 64:m.next=1;break;case 66:case"end":return m.stop()}var y}),Ye,null,[[2,60]])}var Qe=function(n,t){var e=b.getPlayer(t.entityData);return b.entitiesAtPoint(t.entityData,e.position,t.maze.dimension).filter((function(n){return n.id!==e.id})).concat(b.neighborsCrossedByEntity(n.entityData,t.entityData,e.id,t.maze.dimension)).map((function(n){return O.onCollideWithPlayer(n,t)}))};function Ke(n,t){var e,r,a,o,i,u,c,s;return Ge.a.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:e=[],r=!0,a=!1,o=void 0,d.prev=4,i=n[Symbol.iterator]();case 6:if(r=(u=i.next()).done){d.next=15;break}return c=u.value,d.next=10,Object(ze.b)(c.fn,t);case 10:s=d.sent,e=e.concat(s);case 12:r=!0,d.next=6;break;case 15:d.next=21;break;case 17:d.prev=17,d.t0=d.catch(4),a=!0,o=d.t0;case 21:d.prev=21,d.prev=22,r||null==i.return||i.return();case 24:if(d.prev=24,!a){d.next=27;break}throw o;case 27:return d.finish(24);case 28:return d.finish(21);case 29:return d.abrupt("return",e);case 30:case"end":return d.stop()}}),Be,null,[[4,17,21,29],[22,,24,28]])}function qe(n){var t,e,r;return Ge.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(t=n.state,e=n.entityData,r=b.getPlayer(e),!v.lost(t)){a.next=8;break}return a.next=5,Object(ze.b)(window.confirm,O.getKillMessage(b.getPlayer(e),b.byId(e,t.causeOfDeath.entityId)));case 5:window.location.reload(),a.next=12;break;case 8:if(!v.won(t)){a.next=12;break}return a.next=11,Object(ze.b)(window.confirm,"".concat(r.name," escaped. . . this time."));case 11:window.location.reload();case 12:case"end":return a.stop()}}),Fe)}var Je=function(n){return n.map((function(n){return Object($.a)({},n,{duration:"FOREVER"!==n.duration?n.duration-1:n.duration})})).filter((function(n){return"FOREVER"===n.duration||n.duration>0}))},Xe=Ge.a.mark(Ze);function Ze(){return Ge.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(ze.g)(Gt.MOVE_PLAYER,Ge.a.mark((function n(t){var e;return Ge.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(ze.d)(Jt);case 2:return e=n.sent,n.next=5,Object(ze.d)(qt);case 5:if(n.sent||!e){n.next=9;break}return n.next=9,Object(ze.c)((r=x.create(t.direction?S.move(e.id,t.direction):S.wait(e.id)),{type:Gt.REQUEST_STEP,step:r}));case 9:case"end":return n.stop()}var r}),n)})));case 2:case"end":return n.stop()}}),Xe)}var $e=function(n){return Object($.a)({},jn(n),{type:"orb-of-knowing",phenomena:nr})},nr={name:_.Phenomena.KNOW_DOOR_LOCATION,duration:1,fn:function(n){return b.byType(n.entityData,"exit").map((function(t){return T.toIndex(t.position,n.maze.dimension)})).map((function(n){return S.see([n])}))}},tr=Ge.a.mark(ar),er=Ge.a.mark(or),rr=A.withDefault(A.of(localStorage.getItem("name")),(function(){var n=window.prompt("What is your name?")||"";return""!==n&&localStorage.setItem("name",n),""!==n?n:"?"}));function ar(){return Ge.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(ze.c)(we({mazeOptions:{dimension:a.randomItem([s.create(5,5)]),algorithm:a.randomItem(["aldous-broder","aldous-broder","aldous-broder","binary-tree","side-winder"])}}));case 2:case"end":return n.stop()}}),tr)}function or(){var n,t,e,a;return Ge.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=1,o.next=4,Object(ze.f)(Gt.REQUEST_NEW_GAME);case 4:return n=o.sent,t=n.options,o.next=8,Object(ze.b)(r.maze,t.mazeOptions||{});case 8:return e=o.sent,a=f.fromMazeData(e),o.next=12,Object(ze.c)(Te(a,ir(a)));case 12:o.next=19;break;case 14:throw o.prev=14,o.t0=o.catch(1),console.warn("Error initializing new game"),console.error(o.t0),o.t0;case 19:o.next=0;break;case 21:case"end":return o.stop()}}),er,null,[[1,14]])}var ir=function(n){var t=n.dimension,e=m.create(rr,s.pointAlongEdge(t)),r=w.create(s.randomPoint(t)),i=new Array(o.randomInRange(1,5)).fill(void 0).map((function(n){return h.create(s.randomPoint(t))})),u=new Array(a.randomItem([1,1,2,2,3])).fill(void 0).map((function(n){return g.create(s.randomPoint(t))})),c=[].concat(Object(B.a)(i),Object(B.a)(u));return[e,r].concat(Object(B.a)(c),[M.orbOfKnowing(s.randomPoint(t))])},ur=Ge.a.mark(sr),cr=[ar,or,Ve,Ze];function sr(){return Ge.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(ze.a)(cr.map((function(n){return Object(ze.e)(n)})));case 2:case"end":return n.stop()}}),ur)}L.a.render(N.a.createElement(G.a,{store:function(){var n=Object(Ue.a)(),t=Object(_e.d)(We,Object(_e.a)(n));return n.run(sr),t}()},N.a.createElement("div",{className:W.a.app},N.a.createElement(Ae,null))),document.getElementById("root"))},8:function(n,t,e){n.exports={root:"GamePad_root__Lay6t",row:"GamePad_row__164Sm",block:"GamePad_block__l2_xd",button:"GamePad_button__3kDFo",wait:"GamePad_wait__5DVYu"}}},[[40,1,2]]]);
//# sourceMappingURL=main.7c5b050a.chunk.js.map