(this.webpackJsonpfollowed=this.webpackJsonpfollowed||[]).push([[0],{16:function(n,t,e){n.exports={root:"Cell_root__2ti8K",empty:"Cell_empty__1ByI9",seen:"Cell_seen__2qSTX",visible:"Cell_visible__2bnT3",unknown:"Cell_unknown__2tYkG"}},24:function(n,t,e){n.exports={root:"Grid_root__xSU_B",row:"Grid_row__1rWaL"}},28:function(n,t){},29:function(n,t,e){n.exports={app:"index_app__2lpzC"}},30:function(n,t,e){n.exports={root:"App_root__ZxxJN"}},33:function(n,t,e){n.exports={root:"Entity_root__MaGTf"}},40:function(n,t,e){n.exports=e(53)},53:function(n,t,e){"use strict";e.r(t);var r={};e.r(r),e.d(r,"maze",(function(){return z}));var a={};e.r(a),e.d(a,"nOf",(function(){return V})),e.d(a,"sorted",(function(){return F})),e.d(a,"nonNull",(function(){return B})),e.d(a,"randomItem",(function(){return Q}));var i={};e.r(i),e.d(i,"randomInRange",(function(){return K}));var o={};e.r(o),e.d(o,"centerOnPoint",(function(){return q}));var c={};e.r(c),e.d(c,"getSiteSetting",(function(){return J}));var u={};e.r(u),e.d(u,"parseQuery",(function(){return $}));var s={};e.r(s),e.d(s,"create",(function(){return nn})),e.d(s,"area",(function(){return tn})),e.d(s,"randomPoint",(function(){return en})),e.d(s,"pointAlongEdge",(function(){return rn})),e.d(s,"inBounds",(function(){return an}));var d={};e.r(d),e.d(d,"fromApi",(function(){return on}));var f={};e.r(f),e.d(f,"fromMazeData",(function(){return un})),e.d(f,"canWalk",(function(){return sn})),e.d(f,"canTravel",(function(){return dn})),e.d(f,"lookInDirection",(function(){return fn})),e.d(f,"peekableCorners",(function(){return ln})),e.d(f,"seenFromPoint",(function(){return pn}));var l={};e.r(l),e.d(l,"isLoading",(function(){return mn})),e.d(l,"isLoaded",(function(){return yn})),e.d(l,"isErrored",(function(){return En})),e.d(l,"loading",(function(){return bn})),e.d(l,"loaded",(function(){return vn})),e.d(l,"errored",(function(){return On})),e.d(l,"map",(function(){return hn}));var p={};e.r(p),e.d(p,"create",(function(){return wn}));var m={};e.r(m),e.d(m,"create",(function(){return Tn})),e.d(m,"randomDisplayName",(function(){return Sn}));var y={};e.r(y),e.d(y,"EntityClass",(function(){return _}));var E={};e.r(E),e.d(E,"fromEntities",(function(){return jn})),e.d(E,"entitiesAtPoint",(function(){return kn})),e.d(E,"getPlayer",(function(){return An})),e.d(E,"byId",(function(){return Dn})),e.d(E,"byType",(function(){return _n})),e.d(E,"moveEntity",(function(){return In})),e.d(E,"removeEntity",(function(){return Pn})),e.d(E,"updateEntity",(function(){return Nn})),e.d(E,"entitiesCrossed",(function(){return Rn})),e.d(E,"neighborsCrossedByEntity",(function(){return Ln}));var b={};e.r(b),e.d(b,"create",(function(){return Cn})),e.d(b,"displayGrid",(function(){return Wn})),e.d(b,"generateAllAIInstructions",(function(){return Un}));var v={};e.r(v),e.d(v,"win",(function(){return Hn})),e.d(v,"lose",(function(){return Gn})),e.d(v,"play",(function(){return zn})),e.d(v,"won",(function(){return Yn})),e.d(v,"lost",(function(){return Vn})),e.d(v,"playing",(function(){return Fn}));var O={};e.r(O),e.d(O,"create",(function(){return Bn})),e.d(O,"toIndex",(function(){return Qn})),e.d(O,"fromIndex",(function(){return Kn})),e.d(O,"neighbor",(function(){return qn})),e.d(O,"neighbors",(function(){return Jn})),e.d(O,"diagonalNeighbors",(function(){return Xn})),e.d(O,"equals",(function(){return Zn}));var h={};e.r(h),e.d(h,"move",(function(){return nt})),e.d(h,"update",(function(){return et})),e.d(h,"wait",(function(){return rt})),e.d(h,"updateGameState",(function(){return at})),e.d(h,"see",(function(){return it})),e.d(h,"remove",(function(){return ot})),e.d(h,"validate",(function(){return ct})),e.d(h,"validateAll",(function(){return ut})),e.d(h,"apply",(function(){return st})),e.d(h,"applyAll",(function(){return dt}));var g={};e.r(g),e.d(g,"create",(function(){return ft})),e.d(g,"knowing",(function(){return lt})),e.d(g,"DISPLAY",(function(){return pt}));var w={};e.r(w),e.d(w,"getColor",(function(){return mt})),e.d(w,"getDisplayName",(function(){return yt})),e.d(w,"getDescription",(function(){return Et})),e.d(w,"generateAiInstructions",(function(){return bt})),e.d(w,"onCollideWithPlayer",(function(){return vt})),e.d(w,"getKillMessage",(function(){return Ot}));var T={};e.r(T),e.d(T,"create",(function(){return ht})),e.d(T,"next",(function(){return gt})),e.d(T,"DISPLAY",(function(){return wt}));var S={};e.r(S),e.d(S,"create",(function(){return Tt})),e.d(S,"next",(function(){return St})),e.d(S,"wander",(function(){return xt})),e.d(S,"lookForPlayerInDirection",(function(){return Mt})),e.d(S,"DISPLAY",(function(){return jt}));var x={};e.r(x),e.d(x,"create",(function(){return kt})),e.d(x,"DISPLAY",(function(){return At}));var M={};e.r(M),e.d(M,"create",(function(){return Dt}));var j={};e.r(j),e.d(j,"Direction",(function(){return $n})),e.d(j,"all",(function(){return It})),e.d(j,"inverse",(function(){return Pt})),e.d(j,"random",(function(){return Nt}));var k={};e.r(k),e.d(k,"ok",(function(){return Rt})),e.d(k,"err",(function(){return Lt})),e.d(k,"isErr",(function(){return Ct})),e.d(k,"isOk",(function(){return Wt})),e.d(k,"map",(function(){return Ut}));var A={};e.r(A),e.d(A,"of",(function(){return Ht})),e.d(A,"none",(function(){return Gt})),e.d(A,"withDefault",(function(){return zt})),e.d(A,"map",(function(){return Yt})),e.d(A,"ifPresent",(function(){return Vt}));var D={};e.r(D),e.d(D,"create",(function(){return Ft})),e.d(D,"instructions",(function(){return Bt})),e.d(D,"phenomena",(function(){return Qt}));var _,I=e(1),P=e.n(I),N=e(19),R=e.n(N),L=e(29),C=e.n(L),W=e(30),U=e.n(W),H=e(17),G="https://fv9o21r19a.execute-api.us-east-1.amazonaws.com/dev",z=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.dimension,e=void 0===t?s.create(10,10):t,r=n.algorithm,a=void 0===r?"aldous-broder":r,i=fetch("".concat(G),{method:"post",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify({dimensions:e,algorithm:a})});return i.then((function(n){return n.text()})).then((function(n){return d.fromApi(e,a,n)}))},Y=e(5),V=function(n,t){return new Array(n).fill(t)},F=function(n,t){var e=Object(Y.a)(n);return e.sort(t),e},B=function(n){return n.filter((function(n){return null!=n}))},Q=function(n){return n[Math.floor(Math.random()*n.length)]},K=function(n,t){return n+Math.floor(Math.random()*(t-n-1))},q=function(n,t,e){for(var r=t.x-e,a=t.x+e+1,i=t.y-e,o=t.y+e+1,c=[],u=i;u<o;u++){for(var s=[],d=function(t){s.push(A.map((function(n){return n[t]}),n[u]))},f=r;f<a;f++)d(f);c.push(s)}return c},J=function(n,t){return A.withDefault(window.localStorage.getItem("".concat("followed.settings",".").concat(n)),(function(){var e=t();if(e)return window.localStorage.setItem("".concat("followed.settings",".").concat(n),e),e}))},X=e(10),Z=e(3),$=function(){return window.location.search.substring(1).split("&").reduce((function(n,t){var e=t.split("=");return Object(Z.a)({},n,Object(X.a)({},e[0],e[1]))}),{})},nn=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{width:n,height:t}},tn=function(n){return n.width*n.height},en=function(n){return O.fromIndex(Math.floor(Math.random()*tn(n)),n)},rn=function(n){var t=Math.random()>.5;return O.create(t?i.randomInRange(0,n.width):Math.random()>.5?0:n.width-1,t?Math.random()>.5?0:n.height-1:i.randomInRange(0,n.height))},an=function(n,t){return t.x>=0&&t.y>=0&&t.x<n.width&&t.y<n.height},on=function(n,t,e){return{bytes:Uint8Array.from(atob(e),(function(n){return n.charCodeAt(0)})),dimension:n,algorithm:t}},cn=function(n){return{walls:(t={n:!((8&n)>0),s:!((4&n)>0),e:!((2&n)>0),w:!((1&n)>0)},{n:t.n||!1,e:t.e||!1,s:t.s||!1,w:t.w||!1})};var t},un=function(n){for(var t=n.dimension,e=n.bytes,r=n.algorithm,a=[],i=0;i<t.height;i++){for(var o=[],c=0;c<t.width;c++)o.push(cn(e[i*t.width+c]));a.push(o)}return{grid:a,dimension:t,algorithm:r}},sn=function(n,t,e){var r=t.x,a=t.y;return!function(n,t){var e=n.walls;switch(t){case j.Direction.NORTH:return e.n;case j.Direction.EAST:return e.e;case j.Direction.SOUTH:return e.s;case j.Direction.WEST:return e.w}}(n.grid[a][r],e)},dn=function(n,t){for(var e=arguments.length,r=new Array(e>2?e-2:0),a=2;a<e;a++)r[a-2]=arguments[a];return!!r.reduce((function(t,e){return t&&sn(n,t,e)?O.neighbor(t,e):void 0}),t)},fn=function n(t,e,r,a){if(sn(t,r,e)&&a>0){var i=O.neighbor(r,e);return[i].concat(Object(Y.a)(n(t,e,i,a-1)))}return[]},ln=function(n,t){var e=[];return(dn(n,t,j.Direction.NORTH,j.Direction.EAST)||dn(n,t,j.Direction.EAST,j.Direction.NORTH))&&e.push(O.create(t.x+1,t.y-1)),(dn(n,t,j.Direction.NORTH,j.Direction.WEST)||dn(n,t,j.Direction.WEST,j.Direction.NORTH))&&e.push(O.create(t.x-1,t.y-1)),(dn(n,t,j.Direction.SOUTH,j.Direction.EAST)||dn(n,t,j.Direction.EAST,j.Direction.SOUTH))&&e.push(O.create(t.x+1,t.y+1)),(dn(n,t,j.Direction.SOUTH,j.Direction.WEST)||dn(n,t,j.Direction.WEST,j.Direction.SOUTH))&&e.push(O.create(t.x-1,t.y+1)),e},pn=function(n,t,e){return j.all().reduce((function(r,a){return r.concat(fn(n,a,t,e))}),[]).concat(ln(n,t)).concat(t)},mn=function(n){return"Loading"===n.state},yn=function(n){return"Loaded"===n.state},En=function(n){return"Errored"===n.state},bn=function(){return{state:"Loading"}},vn=function(n){return{state:"Loaded",data:n}},On=function(n){return{state:"Errored",e:n}},hn=function(n,t){return yn(t)?vn(n(t.data)):t},gn=e(32),wn=function(){return Object(gn.v4)()},Tn=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.create(),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Sn();return{id:p.create(),name:n,position:t,type:"player",visionRadius:e,displayName:r||n,cls:y.EntityClass.PLAYER}},Sn=function(){return a.randomItem(["\ud83d\udc15","\ud83d\udc26","\ud83d\udc08","\ud83d\udc0e","\ud83d\udc16","\ud83d\udc01","\ud83d\udc00","\ud83d\udc22"])};!function(n){n.PLAYER="PLAYER",n.INANIMATE="INANIMATE",n.HOSTILE="HOSTILE",n.ITEM="ITEM"}(_||(_={}));var xn,Mn,jn=function(n,t){return{entityMap:n.reduce((function(n,t){return n[t.id]=t,n}),{}),positionMap:n.reduce((function(n,e){var r=O.toIndex(e.position,t);return n[r]=n[r]?[].concat(Object(Y.a)(n[r]),[e.id]):[e.id],n}),{}),playerEntityId:A.map((function(n){return n.id}),n.find((function(n){return"player"===n.type}))),typeMap:n.reduce((function(n,t){return Object(Z.a)({},n,Object(X.a)({},t.type,n[t.type]?[].concat(Object(Y.a)(n[t.type]),[t.id]):[t.id]))}),{})}},kn=function(n,t,e){var r=O.toIndex(t,e);return(n.positionMap[r]||[]).map((function(t){return n.entityMap[t]}))},An=function(n){return A.map((function(t){return n.entityMap[t]}),n.playerEntityId)},Dn=function(n,t){return n.entityMap[t]},_n=function(n,t){return a.nonNull(n.typeMap[t]||[]).map((function(t){return n.entityMap[t]}))},In=function(n,t,e,r){var a=t.entityMap[n];if(null!=a){var i,o=O.toIndex(a.position,r),c=O.toIndex(e,r),u=Object(Z.a)({},a,{position:e});return Object(Z.a)({},t,{entityMap:Object(Z.a)({},t.entityMap,Object(X.a)({},n,u)),positionMap:Object(Z.a)({},t.positionMap,(i={},Object(X.a)(i,o,Object(Y.a)((t.positionMap[o]||[]).filter((function(t){return t!==n})))),Object(X.a)(i,c,[].concat(Object(Y.a)(t.positionMap[c]||[]),[n])),i))})}return t},Pn=function(n,t,e){var r=t.entityMap[n],a=O.toIndex(r.position,e);return Object(Z.a)({},t,{entityMap:Object.keys(t.entityMap).reduce((function(e,r){return r!==n&&(e[r]=t.entityMap[r]),e}),{}),typeMap:Object.keys(t.typeMap).reduce((function(e,a){return a===r.type?e[a]=t.typeMap[a].filter((function(t){return t!==n})):e[a]=t.typeMap[a],e}),{}),positionMap:Object.keys(t.positionMap).map((function(n){return parseInt(n)})).reduce((function(e,r){return e[r]=r===a?t.positionMap[r].filter((function(t){return t!==n})):t.positionMap[r],e}),{})})},Nn=function(n,t){return Object(Z.a)({},t,{entityMap:Object(Z.a)({},t.entityMap,Object(X.a)({},n.id,n))})},Rn=function(n,t,e,r){var a=n.entityMap[e],i=n.entityMap[r],o=t.entityMap[e],c=t.entityMap[r];return O.equals(o.position,i.position)&&O.equals(c.position,a.position)},Ln=function(n,t,e,r){return O.neighbors(t.entityMap[e].position,r).map((function(n){return O.toIndex(n,r)})).reduce((function(n,e){return n.concat(t.positionMap[e]||[])}),[]).filter((function(r){return Rn(n,t,e,r)})).map((function(n){return t.entityMap[n]}))},Cn=function(n,t){var e=E.getPlayer(t),r=new Set(e?f.seenFromPoint(n,e.position,e.visionRadius).map((function(t){return O.toIndex(t,n.dimension)})):[]);return{maze:n,entityData:t,seen:new Set,sees:r,stepCount:0,state:v.play()}},Wn=function(n){var t=n.maze,e=n.entityData,r=n.seen,a=n.sees;return t.grid.reduce((function(n,i,o){return[].concat(Object(Y.a)(n),[i.reduce((function(n,i,c){var u=O.create(c,o),s=r.has(O.toIndex(u,t.dimension)),d=a.has(O.toIndex(u,t.dimension));return n.concat({cell:i,meta:{occupants:E.entitiesAtPoint(e,O.create(c,o),t.dimension),visible:d,seen:s,unknown:!d&&!s}})}),[])])}),[])},Un=function(n){return Object.keys(n.entityData.entityMap).map((function(t){return E.byId(n.entityData,t)})).filter((function(n){return"player"!==n.type})).reduce((function(t,e){return t.concat(w.generateAiInstructions(e,n))}),[])},Hn=function(){return{type:"Won"}},Gn=function(n){return{type:"Lost",causeOfDeath:n}},zn=function(){return{type:"Playing"}},Yn=function(n){return"Won"===n.type},Vn=function(n){return"Lost"===n.type},Fn=function(n){return"Playing"===n.type},Bn=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{x:n,y:t}},Qn=function(n,t){var e=n.x;return n.y*t.width+e},Kn=function(n,t){var e=t.width;return Bn(n%e,Math.floor(n/e))},qn=function(n,t){switch(t){case"NORTH":return O.create(n.x,n.y-1);case"SOUTH":return O.create(n.x,n.y+1);case"EAST":return O.create(n.x+1,n.y);case"WEST":default:return O.create(n.x-1,n.y)}},Jn=function(n,t){return j.all().map((function(t){return qn(n,t)})).filter((function(n){return s.inBounds(t,n)}))},Xn=function(n,t){return[Bn(n.x-1,n.y-1),Bn(n.x+1,n.y-1),Bn(n.x+1,n.y+1),Bn(n.x-1,n.y+1)].filter((function(n){return s.inBounds(t,n)}))},Zn=function(n,t){return n.x===t.x&&n.y===t.y};!function(n){n[n.FORGETTING=0]="FORGETTING",n.KNOW_DOOR_LOCATION="KNOW_DOOR_LOCATION"}(xn||(xn={})),function(n){n.MOVE="MOVE",n.UPDATE="UPDATE",n.WAIT="WAIT",n.UPDATE_GAME_STATE="UPDATE_GAME_STATE",n.SEE="SEE",n.REMOVE="REMOVE",n.ADD="ADD"}(Mn||(Mn={}));var $n,nt=function(n,t){return{type:Mn.MOVE,payload:{entityId:n,direction:t}}},tt=function(n,t,e){var r=new Set(f.seenFromPoint(e,t.position,t.visionRadius).map((function(n){return O.toIndex(n,e.dimension)})));return{sees:r,seen:new Set([].concat(Object(Y.a)(n),Object(Y.a)(r)))}},et=function(n){return{type:Mn.UPDATE,payload:{updated:n}}},rt=function(n){return{type:Mn.WAIT,payload:{entityId:n}}},at=function(n){return{type:Mn.UPDATE_GAME_STATE,payload:{updated:n}}},it=function(n){return{type:Mn.SEE,payload:n}},ot=function(n){return{type:Mn.REMOVE,payload:n}},ct=function(n,t){switch(n.type){case Mn.MOVE:return function(n,t){var e=n.payload;return f.canWalk(t.maze,t.entityData.entityMap[e.entityId].position,e.direction)?k.ok(void 0):k.err("way is blocked")}(n,t);case Mn.WAIT:return k.ok(void 0);default:return k.err("Unkown instruction of type ".concat(n.type))}},ut=function(n,t){return n.reduce((function(n,e){return k.isOk(n)?ct(e,t):n}),k.ok(void 0))},st=function(n,t){try{switch(n.type){case Mn.MOVE:return k.ok(function(n,t){var e=n.payload,r=e.entityId,a=e.direction,i=E.moveEntity(r,t.entityData,O.neighbor(t.entityData.entityMap[r].position,a),t.maze.dimension),o=E.getPlayer(i),c=o&&r===o.id?tt(t.seen,o,t.maze):t,u=c.seen,s=c.sees;return Object(Z.a)({},t,{seen:u,sees:s,entityData:i})}(n,t));case Mn.UPDATE:return k.ok(function(n,t){return Object(Z.a)({},t,{entityData:E.updateEntity(n.payload.updated,t.entityData)})}(n,t));case Mn.WAIT:return k.ok(function(n,t){return Object(Z.a)({},t)}(0,t));case Mn.UPDATE_GAME_STATE:return k.ok(function(n,t){return Object(Z.a)({},t,{state:v.lost(t.state)?t.state:n.payload.updated})}(n,t));case Mn.SEE:return k.ok(function(n,t){return Object(Z.a)({},t,{seen:new Set([].concat(Object(Y.a)(t.seen),Object(Y.a)(n.payload)))})}(n,t));case Mn.REMOVE:return k.ok(function(n,t){return Object(Z.a)({},t,{entityData:E.removeEntity(n.payload,t.entityData,t.maze.dimension)})}(n,t))}}catch(e){return console.warn("Error applying instruction",n),console.error(e),k.err("Error applying instructions")}},dt=function(n,t){return n.reduce((function(n,t){return k.isOk(n)?st(t,n.data):n}),k.ok(t))},ft=function(n){var t=function(n){return{id:p.create(),cls:_.ITEM,position:n}}(n);return Object(Z.a)({},t,{type:"orb-of-knowing",phenomena:lt(t.id),instruction:[]})},lt=function(n){return{name:xn.KNOW_DOOR_LOCATION,duration:1,fn:function(t){return alert("You feel enlightened by the forces of providence.\nFor in thine posession is the Orb of Knowing."),[].concat(Object(Y.a)(_n(t.entityData,"exit").map((function(n){return n})).map((function(n){return Qn(n.position,t.maze.dimension)})).map((function(n){return it([n])}))),[ot(n)])}}},pt="\u3299\ufe0f",mt=function(n){return n.type,"transparent"},yt=function(n){switch(n.type){case"player":return n.displayName;case"blind-guardian":return T.DISPLAY;case"exit":return x.DISPLAY;case"wandering-husk":return S.DISPLAY;case"orb-of-knowing":return g.DISPLAY}},Et=function(n){switch(n.type){case"player":return n.name;case"blind-guardian":return"a blind guardian";case"exit":return"an exit";case"wandering-husk":return"a wandering husk";case"orb-of-knowing":return"a mysterious, translucent orb"}},bt=function(n,t){switch(n.type){case"blind-guardian":return T.next(n,t);case"wandering-husk":return S.next(n,t);default:return[]}},vt=function(n,t){return n.cls===_.HOSTILE?D.create([h.updateGameState(v.lose({entityId:n.id}))]):n.cls===_.ITEM?D.create(void 0,[n.phenomena]):"exit"===n.type?D.create([h.updateGameState(v.win())]):D.create()},Ot=function(n,t){switch(t.type){case"blind-guardian":return"".concat(n.name," has been annihilated by ").concat(Et(t),". Nothing is left.");case"wandering-husk":return"Blood and sinew cling to the maw of the wandering husk. ".concat(n.name," has been consumed.");default:return"".concat(n.name," was killed by ").concat(Et(t))}},ht=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.create();return{type:"blind-guardian",position:n,id:p.create(),heading:j.Direction.NORTH,cls:y.EntityClass.HOSTILE}},gt=function(n,t){var e,r=j.all().filter((function(e){return f.canWalk(t.maze,n.position,e)})),i=r.filter((function(t){return t!==j.inverse(n.heading)}));return e=r.includes(n.heading)&&Math.random()<.75?n.heading:Math.random()<.75&&i.length>0?a.randomItem(i):r[0],[h.update(Object(Z.a)({},n,{heading:e})),h.move(n.id,e)]},wt="\ud83d\uddff",Tt=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.create();return{type:"wandering-husk",position:n,id:p.create(),heading:j.random(),cls:y.EntityClass.HOSTILE}},St=function(n,t){var e,r=j.all().reduce((function(e,r){return e||(Mt(r,n.position,t)?r:void 0)}),void 0),a=[];return r?Math.random()<.9?(e=r,a.push(h.move(n.id,e))):(e=n.heading,a.push(h.wait(n.id))):(e=xt(n,t),a.push(h.move(n.id,e))),[h.update(Object(Z.a)({},n,{heading:e}))].concat(a)},xt=function(n,t){var e=j.all().filter((function(e){return f.canWalk(t.maze,n.position,e)})),r=e.filter((function(t){return t!==j.inverse(n.heading)}));return e.includes(n.heading)&&Math.random()<.75?n.heading:Math.random()<.75&&r.length>0?a.randomItem(r):e[0]},Mt=function(n,t,e){return f.lookInDirection(e.maze,n,t,5).reduce((function(n,t){return n||null!=E.entitiesAtPoint(e.entityData,t,e.maze.dimension).find((function(n){return"player"===n.type}))}),!1)},jt="\ud83e\udddf",kt=function(n){return{position:n,id:p.create(),type:"exit",cls:y.EntityClass.INANIMATE}},At="\ud83d\udeaa",Dt=function(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];return{instructions:t,id:p.create()}};!function(n){n.NORTH="NORTH",n.SOUTH="SOUTH",n.EAST="EAST",n.WEST="WEST"}($n||($n={}));var _t,It=function(){return[$n.NORTH,$n.SOUTH,$n.EAST,$n.WEST]},Pt=function(n){switch(n){case $n.NORTH:return $n.SOUTH;case $n.SOUTH:return $n.NORTH;case $n.EAST:return $n.WEST;case $n.WEST:return $n.EAST}},Nt=function(){return Q(It())},Rt=function(n){return{type:"Ok",data:n}},Lt=function(n){return{type:"Error",msg:n}},Ct=function(n){return"Error"===n.type},Wt=function(n){return"Ok"===n.type},Ut=function(n,t){return Wt(t)?Rt(n(t.data)):t},Ht=(e(28),function(n){return n}),Gt=function(){},zt=function(n,t){return null!=n?n:"function"===typeof t?t():t},Yt=function(n,t){return null!=t?n(t):void 0},Vt=function(n,t){t&&n(t)},Ft=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{instructions:n,phenomena:t}},Bt=function(n){return n.reduce((function(n,t){return[].concat(Object(Y.a)(n),Object(Y.a)(t.instructions))}),[])},Qt=function(n){return n.reduce((function(n,t){return[].concat(Object(Y.a)(n),Object(Y.a)(t.phenomena))}),[])},Kt=e(18),qt=function(n){return n},Jt=Object(Kt.a)(qt,(function(n){return n.game})),Xt=Object(Kt.a)(Jt,(function(n){return l.map(b.displayGrid,n)})),Zt=Object(Kt.a)(qt,(function(n){return null!=n.stepId})),$t=Object(Kt.a)(Jt,(function(n){return l.isLoaded(n)?A.map((function(t){return n.data.entityData.entityMap[t]}),n.data.entityData.playerEntityId):void 0})),ne=Object(Kt.a)(Xt,$t,(function(n,t){return l.map((function(n){return null!=t?o.centerOnPoint(n,t.position,3):[]}),n)})),te=e(16),ee=e.n(te),re=e(13),ae=e.n(re),ie=e(33),oe=e.n(ie),ce=function(n){return P.a.createElement("div",{className:oe.a.root},w.getDisplayName(n))},ue=function(n){return n?"0.5px solid cyan":"0.5px transparent"},se=function(n){var t,e=n.cell,r=n.meta,a=e.walls;return P.a.createElement("div",{className:ae()(ee.a.root,(t={},Object(X.a)(t,ee.a.seen,r.seen),Object(X.a)(t,ee.a.visible,r.visible),Object(X.a)(t,ee.a.unknown,!r.seen&&!r.visible),t)),style:r.unknown?void 0:{borderTop:ue(a.n),borderRight:ue(a.e),borderBottom:ue(a.s),borderLeft:ue(a.w)}},A.map((function(n){return P.a.createElement(ce,n)}),function(n){var t=n.visible,e=n.seen,r=n.occupants;return t?A.withDefault(r.find((function(n){return"player"!==n.type&&"exit"!==n.type})),r[0]):e?r.find((function(n){return"exit"===n.type})):void 0}(r)))},de=function(){return P.a.createElement("div",{className:ae()(ee.a.empty,ee.a.root)})},fe=e(24),le=e.n(fe),pe=function(n){var t=n.grid;return P.a.createElement("div",{className:le.a.root},t.map((function(n,t){return P.a.createElement("div",{key:t,className:le.a.row},n.map((function(n,t){return A.withDefault(A.map((function(n){return P.a.createElement(se,{key:t,cell:n.cell,meta:n.meta})}),n),P.a.createElement(de,{key:t}))})))})))},me=e(8),ye=e.n(me),Ee=function(n){var t=n.onMove;return P.a.createElement("div",{className:ye.a.root},P.a.createElement("div",{className:ye.a.row},P.a.createElement("div",{className:ye.a.block}),P.a.createElement("button",{className:ae()(ye.a.block,ye.a.button),onClick:function(){return t(j.Direction.NORTH)}}),P.a.createElement("div",{className:ye.a.block})),P.a.createElement("div",{className:ye.a.row},P.a.createElement("button",{className:ae()(ye.a.block,ye.a.button),onClick:function(){return t(j.Direction.WEST)}}),P.a.createElement("button",{className:ae()(ye.a.block,ye.a.button,ye.a.wait),onClick:function(){return t(void 0)}}),P.a.createElement("button",{className:ae()(ye.a.block,ye.a.button),onClick:function(){return t(j.Direction.EAST)}})),P.a.createElement("div",{className:ye.a.row},P.a.createElement("div",{className:ye.a.block}),P.a.createElement("button",{className:ae()(ye.a.block,ye.a.button),onClick:function(){return t(j.Direction.SOUTH)}}),P.a.createElement("div",{className:ye.a.block})))},be=e(34),ve=e(35),Oe=e(38),he=e(36),ge=e(39),we=function(n){function t(){var n,e;Object(be.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=Object(Oe.a)(this,(n=Object(he.a)(t)).call.apply(n,[this].concat(a)))).handleKeyDown=function(n){e.props.disabled||("ArrowUp"===n.key||"w"===n.key?e.props.onMove(j.Direction.NORTH):"ArrowRight"===n.key||"d"===n.key?e.props.onMove(j.Direction.EAST):"ArrowDown"===n.key||"d"===n.key?e.props.onMove(j.Direction.SOUTH):"ArrowLeft"===n.key||"a"===n.key?e.props.onMove(j.Direction.WEST):" "!==n.key&&"Enter"!==n.key||e.props.onMove(void 0))},e}return Object(ge.a)(t,n),Object(ve.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleKeyDown)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){return I.createElement(I.Fragment,null)}}]),t}(I.PureComponent),Te=function(n){var t=n.grid,e=n.onMove,r=n.processingUpdates;return I.createElement(I.Fragment,null,I.createElement(pe,{grid:t}),I.createElement(Ee,{onMove:e}),I.createElement(we,{onMove:e,disabled:r}))};!function(n){n.REQUEST_NEW_GAME="REQUEST_NEW_GAME",n.START_NEW_GAME="START_NEW_GAME",n.REQUEST_STEP="REQUEST_STEP",n.PROCESS_STEP="PROCESS_STEP",n.COMPLETE_STEP="COMPLETE_STEP",n.ABORT_STEP="ABORT_STEP",n.MOVE_PLAYER="MOVE_PLAYER"}(_t||(_t={}));var Se,xe=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:_t.REQUEST_NEW_GAME,options:n}},Me=function(n,t){return{type:_t.START_NEW_GAME,maze:n,entities:t}},je=function(n){return{type:_t.ABORT_STEP,stepId:n}},ke=function(n,t){return{type:_t.PROCESS_STEP,stepId:n,gameData:t}},Ae="true"===c.getSiteSetting("devmode",(function(){var n=u.parseQuery().devmode;return n&&"false"!==n?"true":void 0}));fetch("".concat(window.location.href.substring(0,window.location.href.indexOf("?")),"/VERSION")).then((function(n){return n.text().then((function(n){return Se=n}))}));var De=Object(H.b)((function(n){return{gameData:Jt(n)}}))((function(n){var t=n.gameData;return Ae&&l.isLoaded(t)?P.a.createElement("button",{onFocus:function(n){return n.preventDefault()},style:{position:"absolute",top:5,left:5},onClick:function(){window.alert(function(n){return["maze algorithm:: ".concat(n.maze.algorithm),"maze dimensions:: ".concat(n.maze.dimension.width," x ").concat(n.maze.dimension.height),"entityCount:: ".concat((t=n.entityData,"\n\t"+Object.keys(t.typeMap).map((function(n){return"".concat(n,": ").concat(t.typeMap[n].length)})).join("\n\t"))),"step:: ".concat(n.stepCount),"version:: ".concat(Se)].join("\n");var t}(t.data)),A.ifPresent((function(n){return n.blur()}),document.activeElement)}},"?"):P.a.createElement(P.a.Fragment,null)})),_e=Object(H.b)((function(n){return{grid:ne(n),processingUpdates:Zt(n)}}),(function(n){return{onMove:function(t){return n((e=t,{type:_t.MOVE_PLAYER,direction:e}));var e}}}))((function(n){var t=n.grid,e=n.processingUpdates,r=n.onMove;return P.a.createElement("div",{className:U.a.root},l.isLoading(t)&&P.a.createElement("span",null,"Loading . . . "),l.isLoaded(t)&&t.data&&P.a.createElement(P.a.Fragment,null,P.a.createElement(De,null),P.a.createElement(Te,{processingUpdates:e,grid:t.data,onMove:r})))})),Ie=e(14),Pe=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(Z.a)({game:l.loading()},n)},Ne=function(n){return Object(Z.a)({},n,{game:l.loading()})},Re=function(n,t,e){return Object(Z.a)({},n,{game:l.loaded(b.create(t,E.fromEntities(e,t.dimension)))})},Le=function(n,t){return l.isLoaded(t.game)?n():t},Ce=function(n,t){return Object(Z.a)({},n,{stepId:t})},We=function(n,t,e){return Le((function(){return n.stepId===t?Object(Z.a)({},n,{game:l.loaded(e)}):n}),n)},Ue=function(n,t){return Le((function(){return n.stepId===t?Object(Z.a)({},n,{stepId:void 0,game:l.map((function(n){return Object(Z.a)({},n,{stepCount:n.stepCount+1})}),n.game)}):n}),n)},He=function(n,t){return n.stepId===t?Object(Z.a)({},n,{stepId:void 0}):n},Ge=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Pe(),t=arguments.length>1?arguments[1]:void 0;switch(t.type){case _t.REQUEST_STEP:return Ce(n,t.step.id);case _t.COMPLETE_STEP:return Ue(n,t.stepId);case _t.ABORT_STEP:return He(n,t.stepId);case _t.PROCESS_STEP:return We(n,t.stepId,t.gameData);case _t.START_NEW_GAME:return Re(n,t.maze,t.entities);case _t.REQUEST_NEW_GAME:return Ne(n);default:return n}},ze=e(37),Ye=e(7),Ve=e.n(Ye),Fe=e(6),Be=Ve.a.mark(qe),Qe=Ve.a.mark(Xe),Ke=Ve.a.mark(Ze);function qe(){var n,t,e,r,a,i,o,c,u,s,d,f,p;return Ve.a.wrap((function(m){for(;;)switch(m.prev=m.next){case 0:n=[];case 1:return m.prev=2,m.next=5,Object(Fe.f)(_t.REQUEST_STEP);case 5:return t=m.sent,e=t.step,m.next=9,Object(Fe.d)(Jt);case 9:if(r=m.sent,!l.isLoaded(r)){m.next=58;break}return a=r.data,m.next=14,Object(Fe.b)(h.validateAll,e.instructions,a);case 14:if(i=m.sent,!k.isErr(i)){m.next=19;break}return m.next=18,Object(Fe.c)(je(e.id));case 18:return m.abrupt("continue",1);case 19:return o=b.generateAllAIInstructions(a),c=[].concat(Object(Y.a)(o),Object(Y.a)(e.instructions)),m.next=23,Object(Fe.b)(h.applyAll,c,a);case 23:if(u=m.sent,!k.isErr(u)){m.next=28;break}return m.next=27,Object(Fe.c)(je(e.id));case 27:return m.abrupt("continue",1);case 28:return m.next=30,Object(Fe.b)(Je,a,u.data);case 30:return s=m.sent,m.next=33,Object(Fe.b)(h.applyAll,s.reduce((function(n,t){return[].concat(Object(Y.a)(n),Object(Y.a)(t.instructions))}),[]),u.data);case 33:if(d=m.sent,!k.isErr(d)){m.next=38;break}return m.next=37,Object(Fe.c)(je(e.id));case 37:return m.abrupt("continue",1);case 38:return n=n.concat(D.phenomena(s)),m.next=41,Object(Fe.b)(Xe,n,a);case 41:return f=m.sent,m.next=44,Object(Fe.b)(h.applyAll,f,d.data);case 44:if(p=m.sent,!k.isErr(p)){m.next=49;break}return m.next=48,Object(Fe.c)(je(e.id));case 48:return m.abrupt("continue",1);case 49:return m.next=51,Object(Fe.b)($e,n);case 51:return n=m.sent,m.next=54,Object(Fe.c)(ke(e.id,p.data));case 54:return m.next=56,Object(Fe.b)(Ze,p.data);case 56:return m.next=58,Object(Fe.c)((y=e.id,{type:_t.COMPLETE_STEP,stepId:y}));case 58:m.next=64;break;case 60:m.prev=60,m.t0=m.catch(2),console.warn("Error processing step"),console.error(m.t0);case 64:m.next=1;break;case 66:case"end":return m.stop()}var y}),Be,null,[[2,60]])}var Je=function(n,t){var e=E.getPlayer(t.entityData);return E.entitiesAtPoint(t.entityData,e.position,t.maze.dimension).filter((function(n){return n.id!==e.id})).concat(E.neighborsCrossedByEntity(n.entityData,t.entityData,e.id,t.maze.dimension)).map((function(n){return w.onCollideWithPlayer(n,t)}))};function Xe(n,t){var e,r,a,i,o,c,u,s;return Ve.a.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:e=[],r=!0,a=!1,i=void 0,d.prev=4,o=n[Symbol.iterator]();case 6:if(r=(c=o.next()).done){d.next=15;break}return u=c.value,d.next=10,Object(Fe.b)(u.fn,t);case 10:s=d.sent,e=e.concat(s);case 12:r=!0,d.next=6;break;case 15:d.next=21;break;case 17:d.prev=17,d.t0=d.catch(4),a=!0,i=d.t0;case 21:d.prev=21,d.prev=22,r||null==o.return||o.return();case 24:if(d.prev=24,!a){d.next=27;break}throw i;case 27:return d.finish(24);case 28:return d.finish(21);case 29:return d.abrupt("return",e);case 30:case"end":return d.stop()}}),Qe,null,[[4,17,21,29],[22,,24,28]])}function Ze(n){var t,e,r;return Ve.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(t=n.state,e=n.entityData,r=E.getPlayer(e),!v.lost(t)){a.next=8;break}return a.next=5,Object(Fe.b)(window.confirm,w.getKillMessage(E.getPlayer(e),E.byId(e,t.causeOfDeath.entityId)));case 5:window.location.reload(),a.next=12;break;case 8:if(!v.won(t)){a.next=12;break}return a.next=11,Object(Fe.b)(window.confirm,"".concat(r.name," escaped. . . this time."));case 11:window.location.reload();case 12:case"end":return a.stop()}}),Ke)}var $e=function(n){return n.map((function(n){return Object(Z.a)({},n,{duration:"FOREVER"!==n.duration?n.duration-1:n.duration})})).filter((function(n){return"FOREVER"===n.duration||n.duration>0}))},nr=Ve.a.mark(tr);function tr(){return Ve.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(Fe.g)(_t.MOVE_PLAYER,Ve.a.mark((function n(t){var e;return Ve.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(Fe.d)($t);case 2:return e=n.sent,n.next=5,Object(Fe.d)(Zt);case 5:if(n.sent||!e){n.next=9;break}return n.next=9,Object(Fe.c)((r=M.create(t.direction?h.move(e.id,t.direction):h.wait(e.id)),{type:_t.REQUEST_STEP,step:r}));case 9:case"end":return n.stop()}var r}),n)})));case 2:case"end":return n.stop()}}),nr)}var er=Ve.a.mark(ir),rr=Ve.a.mark(or),ar=A.withDefault(A.of(localStorage.getItem("name")),(function(){var n=window.prompt("What is your name?")||"";return""!==n&&localStorage.setItem("name",n),""!==n?n:"?"}));function ir(){return Ve.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(Fe.c)(xe({mazeOptions:{dimension:a.randomItem([s.create(10,10),s.create(15,15),s.create(15,15),s.create(15,15),s.create(15,15),s.create(20,20),s.create(25,10),s.create(10,25),s.create(20,15),s.create(15,20),s.create(30,5),s.create(5,30)]),algorithm:a.randomItem(["aldous-broder","aldous-broder","aldous-broder","binary-tree","side-winder"])}}));case 2:case"end":return n.stop()}}),er)}function or(){var n,t,e,a;return Ve.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=1,i.next=4,Object(Fe.f)(_t.REQUEST_NEW_GAME);case 4:return n=i.sent,t=n.options,i.next=8,Object(Fe.b)(r.maze,t.mazeOptions||{});case 8:return e=i.sent,a=f.fromMazeData(e),i.next=12,Object(Fe.c)(Me(a,cr(a)));case 12:i.next=18;break;case 14:i.prev=14,i.t0=i.catch(1),console.warn("Error initializing new game"),console.error(i.t0);case 18:i.next=0;break;case 20:case"end":return i.stop()}}),rr,null,[[1,14]])}var cr=function(n){var t=n.dimension,e=m.create(ar,s.pointAlongEdge(t)),r=x.create(s.randomPoint(t)),o=new Array(i.randomInRange(1,5)).fill(void 0).map((function(n){return T.create(s.randomPoint(t))})),c=new Array(a.randomItem([1,1,2,2,3])).fill(void 0).map((function(n){return S.create(s.randomPoint(t))})),u=[].concat(Object(Y.a)(o),Object(Y.a)(c));return[e,r].concat(Object(Y.a)(u),[g.create(s.randomPoint(t))])},ur=Ve.a.mark(dr),sr=[ir,or,qe,tr];function dr(){return Ve.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(Fe.a)(sr.map((function(n){return Object(Fe.e)(n)})));case 2:case"end":return n.stop()}}),ur)}R.a.render(P.a.createElement(H.a,{store:function(){var n=Object(ze.a)(),t=Object(Ie.d)(Ge,Object(Ie.a)(n));return n.run(dr),t}()},P.a.createElement("div",{className:C.a.app},P.a.createElement(_e,null))),document.getElementById("root"))},8:function(n,t,e){n.exports={root:"GamePad_root__Lay6t",row:"GamePad_row__164Sm",block:"GamePad_block__l2_xd",button:"GamePad_button__3kDFo",wait:"GamePad_wait__5DVYu"}}},[[40,1,2]]]);
//# sourceMappingURL=main.8605ffa6.chunk.js.map