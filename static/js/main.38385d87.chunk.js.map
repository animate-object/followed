{"version":3,"sources":["app/views/Cell.css","app/views/Grid.css","index.css","app/views/App.css","app/views/Entity.css","app/views/Chat.css","app/types/entities/baseEntity.ts","app/util/api.ts","app/util/arrays.ts","app/util/numbers.ts","app/util/camera.ts","app/util/localStorage.ts","app/util/uri.ts","app/types/dimension.ts","app/types/mazeData.ts","app/types/cell.ts","app/types/maze.ts","app/types/loadable.ts","app/types/id.ts","app/types/entities/player.ts","app/types/game/entityData.ts","app/types/instructions/baseInstruction.ts","app/types/game/gameData.ts","app/types/game/gameState.ts","app/types/entities/entity.ts","app/types/entities/hostiles/blindGuardian.ts","app/types/entities/hostiles/wanderingHusk.ts","app/types/entities/exit.ts","app/types/entities/hostiles/sinisterDolls.ts","app/types/entities/hostiles/seeker.ts","app/types/point.ts","app/types/step.ts","app/types/instructions/move.ts","app/types/direction.ts","app/types/instructions/update.ts","app/types/instructions/wait.ts","app/types/instructions/updateGameState.ts","app/types/instructions/see.ts","app/types/instructions/remove.ts","app/types/instructions/add.ts","app/types/instructions/instruction.ts","app/types/phenomenon.ts","app/types/result.ts","app/types/maybe.ts","app/types/outcome.ts","app/actions.ts","app/types/message.ts","app/types/priorityQueue.ts","app/selectors.ts","app/views/Entity.tsx","app/views/Cell.tsx","app/views/Grid.tsx","app/views/GamePad.tsx","app/views/KeyPad.tsx","app/views/Chat.tsx","app/views/Game.tsx","app/views/InfoButton.tsx","app/views/App.tsx","app/state.ts","app/reducer.ts","app/sagas/stepEngine.ts","app/sagas/movePlayer.ts","app/types/entities/items/item.ts","app/types/entities/items/orbOfKnowing.ts","app/sagas/newGame.ts","app/saga.ts","index.tsx","app/store.ts","app/views/GamePad.css"],"names":["module","exports","EntityClass","API_ROOT","maze","dimension","Dimension","create","algorithm","corner","direction","request","fetch","method","mode","headers","body","JSON","stringify","dimensions","then","response","text","base64","MazeData","fromApi","nOf","n","t","Array","fill","sorted","unsorted","sortFn","sort","nonNull","array","filter","randomItem","Math","floor","random","length","randomInRange","start","end","centerOnPoint","grid","point","radius","xMin","x","xMax","yMin","y","yMax","windowedGrid","row","push","Maybe","map","getSiteSetting","key","supplier","withDefault","window","localStorage","getItem","supplied","setItem","parseQuery","location","search","substring","split","reduce","queryMap","pair","parts","width","height","area","d","randomPoint","Point","fromIndex","pointAlongEdge","northOrSouth","Numbers","inBounds","p","bytes","Uint8Array","from","atob","c","charCodeAt","randomDirectionalOptions","Arrays","fromByte","byte","walls","s","e","w","isDeadEnd","fromMazeData","deadends","r","cell","Cell","toIndex","unused","used","traversableNeighbors","Direction","all","canWalk","neighbor","NORTH","EAST","SOUTH","WEST","canTravel","directions","last","undefined","lookInDirection","visionRadius","peekableCorners","corners","seenFromPoint","origin","concat","takeDeadEnd","de","deadEnds","placeEntitiesInDeadEnds","creators","acc","creator","placed","unplaced","isLoading","l","state","isLoaded","isErrored","loading","loaded","data","errored","f","v4","name","position","displayName","randomDisplayName","id","ID","type","cls","BaseEntity","PLAYER","InstructionType","addEntity","entityMap","positionMap","playerEntityId","typeMap","index","fromEntities","entities","m","idx","find","entitiesAtPoint","getPlayer","byId","byType","moveEntity","entity","oldIdx","newIdx","newEntity","eId","removeEntity","Object","keys","k","parseInt","updateEntity","updated","entitiesCrossed","next","a","b","lastA","lastB","nextA","nextB","equals","neighborsCrossedByEntity","neighbors","entityData","player","EntityData","sees","Set","Maze","seen","stepCount","GameState","play","lookForEntityInDirection","gameData","predicate","siteRadius","found","displayGrid","rows","rowIdx","cells","cellIdx","isSeen","has","isVisible","meta","occupants","visible","unknown","generateAllAIInstructions","i","Entity","generateAiInstructions","win","lose","cod","causeOfDeath","won","lost","playing","getColor","getDescription","BlindGuardian","WanderingHusk","SinisterDolls","Seeker","onCollideWithPlayer","HOSTILE","Outcome","Instruction","updateGameState","entityId","ITEM","phenomena","getKillMessage","killer","heading","options","adjacent","inverse","includes","update","move","towardPlayer","lookForPlayerInDirection","instructions","wait","wander","foundPlayer","INANIMATE","prioritize","target","round","distance","addAllToFrontier","frontier","points","queue","PriorityQueue","cameFrom","Map","set","result","none","dequeue","min","newFrontier","nextPoint","item","forEach","calculateOptimalMove","nextTile","of","test","back","get","diagonalNeighbors","sqrt","pow","MOVE","payload","updatePlayerVision","prev","UPDATE","WAIT","UPDATE_GAME_STATE","see","indices","SEE","remove","REMOVE","add","ADD","validate","instruction","Result","ok","err","Move","validateAll","validated","isOk","apply","Update","_","Wait","UpdateGameState","See","Remove","Add","console","warn","error","applyAll","applied","Phenomena","msg","isErr","value","maybe","default_","ifPresent","ActionTypes","outcomes","o","message","speaker","priority","highestPrioritity","prioritizer","priorities","highest","Infinity","log","max","removeFrom","removed","getState","getGame","createSelector","game","getDisplayGrid","Loadable","GameData","getIsProcessingStep","stepId","getWindowedDisplayGrid","Camera","getMessages","chat","messages","className","styles","root","style","color","toUpperCase","getDisplayLetter","drawSide","wall","classNames","borderTop","borderRight","borderBottom","borderLeft","getEntityToDraw","EmptyCell","empty","Grid","largeScreen","large","maybeCell","GamePad","onMove","block","button","onClick","KeyPad","handleKeyDown","event","props","disabled","addEventListener","this","removeEventListener","React","Chat","Game","processingUpdates","minWidth","VERSION","requestNewGame","REQUEST_NEW_GAME","startNewGame","START_NEW_GAME","abortStep","ABORT_STEP","processStep","PROCESS_STEP","DEV","LocalStorage","queryParam","Uri","href","indexOf","version","connect","onFocus","preventDefault","top","left","alert","type_","join","gameInfo","el","blur","document","activeElement","dispatch","MOVE_PLAYER","init","roundsSince","requestingNewGame","newGame","ifGameIsLoaded","requestStep","completeStep","g","Message","slice","addMessage","reducer","State","action","REQUEST_STEP","step","COMPLETE_STEP","ADD_MESSAGE","stepEngine","applyPhenomena","checkGameState","activePhenomena","take","select","call","stepValidation","put","aiInstructions","afterMovement","processCollisions","collisionOutcomes","afterCollisions","phenomenalInstructions","afterPhenomena","prunePhenomena","fn","generatedInstructions","confirm","reload","duration","movePlayer","takeEvery","Step","base","baseItem","knowing","Phenomenon","KNOW_DOOR_LOCATION","exit","firstGame","prompt","mazeOptions","Api","fromData","startingEntities","prePlacement","Player","Exit","OrbOfKnowing","u","sagas","spawn","ReactDOM","render","store","sagaMiddleware","createSagaMiddleware","createStore","applyMiddleware","run","Saga","configureStore","app","getElementById"],"mappings":"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","file":"static/js/main.38385d87.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Cell_root__2ti8K\",\"empty\":\"Cell_empty__1ByI9\",\"seen\":\"Cell_seen__2qSTX\",\"visible\":\"Cell_visible__2bnT3\",\"unknown\":\"Cell_unknown__2tYkG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Grid_root__xSU_B\",\"row\":\"Grid_row__1rWaL\",\"large\":\"Grid_large__2_Ser\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"index_app__2lpzC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"App_root__ZxxJN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Entity_root__MaGTf\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Chat_root__2csEn\"};","import { ID, Point } from \"..\";\n\nexport enum EntityClass {\n  PLAYER = \"PLAYER\",\n  INANIMATE = \"INANIMATE\",\n  HOSTILE = \"HOSTILE\",\n  ITEM = \"ITEM\"\n}\n\nexport interface BaseEntity {\n  position: Point.Point;\n  id: ID.ID;\n  type: string;\n  cls: EntityClass;\n}\n\nexport interface HostileEntity extends BaseEntity {\n  cls: EntityClass.HOSTILE;\n}\n","import { Dimension, MazeData } from \"../types\";\n\nconst API_ROOT = \"https://fv9o21r19a.execute-api.us-east-1.amazonaws.com/dev\";\n\nexport const maze = ({\n  dimension = Dimension.create(10, 10),\n  algorithm = \"aldous-broder\",\n  corner,\n  direction\n}: MazeData.Options = {}): Promise<MazeData.MazeData> => {\n  const request = fetch(`${API_ROOT}`, {\n    method: \"post\",\n    mode: \"cors\",\n    headers: { \"content-type\": \"application/json\" },\n    body: JSON.stringify({\n      dimensions: dimension,\n      algorithm,\n      corner,\n      direction\n    })\n  });\n  return request\n    .then(response => response.text())\n    .then(base64 => MazeData.fromApi(dimension, algorithm, base64));\n};\n","import { Maybe } from \"../types\";\n\nexport const nOf = <T>(n: number, t: T): Array<T> => new Array(n).fill(t);\n\nexport const sorted = <T>(\n  unsorted: Array<T>,\n  sortFn?: (a: T, b: T) => number\n): Array<T> => {\n  const sorted = [...unsorted];\n  sorted.sort(sortFn);\n  return sorted;\n};\n\nexport const nonNull = <T>(array: Array<Maybe.Maybe<T>>): Array<T> =>\n  array.filter(t => t != null) as Array<T>;\n\nexport const randomItem = <T>(array: Array<T>): T =>\n  array[Math.floor(Math.random() * array.length)];\n","export const randomInRange = (start: number, end: number) => {\n  return start + Math.floor(Math.random() * (end - start - 1));\n};\n","import { DisplayGrid, CellAndMeta } from \"../types/game/gameData\";\nimport { Point, Maybe } from \"../types\";\n\nexport type WindowedGrid = Array<Array<Maybe.Maybe<CellAndMeta>>>;\n\nexport const centerOnPoint = (\n  grid: DisplayGrid,\n  point: Point.Point,\n  radius: number\n): WindowedGrid => {\n  const xMin = point.x - radius;\n  const xMax = point.x + radius + 1;\n  const yMin = point.y - radius;\n  const yMax = point.y + radius + 1;\n\n  const windowedGrid: WindowedGrid = [];\n\n  for (let y = yMin; y < yMax; y++) {\n    const row = [];\n    for (let x = xMin; x < xMax; x++) {\n      row.push(Maybe.map(row => row[x], grid[y]));\n    }\n    windowedGrid.push(row);\n  }\n\n  return windowedGrid;\n};\n","import { Maybe } from \"../types\";\n\nconst PREFIX = \"followed.settings\";\n\nexport const getSiteSetting = (\n  key: string,\n  supplier: () => Maybe.Maybe<string>\n): Maybe.Maybe<string> => {\n  return Maybe.withDefault(\n    window.localStorage.getItem(`${PREFIX}.${key}`),\n    () => {\n      const supplied = supplier();\n\n      if (supplied) {\n        window.localStorage.setItem(`${PREFIX}.${key}`, supplied);\n        return supplied;\n      }\n    }\n  );\n};\n","import { Maybe } from \"../types\";\n\nexport const parseQuery = (): Record<string, Maybe.Maybe<string>> =>\n  window.location.search\n    .substring(1)\n    .split(\"&\")\n    .reduce((queryMap: Record<string, string>, pair: string) => {\n      const parts = pair.split(\"=\");\n      return { ...queryMap, [parts[0]]: parts[1] };\n    }, {});\n","import { Point } from \".\";\nimport { Numbers } from \"../util\";\n\nexport interface Dimension {\n  width: number;\n  height: number;\n}\n\nexport const create = (width: number = 0, height: number = 0): Dimension => ({\n  width,\n  height\n});\n\nexport const area = (d: Dimension): number => d.width * d.height;\n\nexport const randomPoint = (d: Dimension): Point.Point =>\n  Point.fromIndex(Math.floor(Math.random() * area(d)), d);\n\nexport const pointAlongEdge = (d: Dimension): Point.Point => {\n  const northOrSouth = Math.random() > 0.5;\n\n  return Point.create(\n    northOrSouth\n      ? Numbers.randomInRange(0, d.width)\n      : Math.random() > 0.5\n      ? 0\n      : d.width - 1,\n    !northOrSouth\n      ? Numbers.randomInRange(0, d.height)\n      : Math.random() > 0.5\n      ? 0\n      : d.height - 1\n  );\n};\n\nexport const inBounds = (d: Dimension, p: Point.Point): boolean =>\n  p.x >= 0 && p.y >= 0 && p.x < d.width && p.y < d.height;\n","import { Dimension } from \".\";\nimport { Arrays } from \"../util\";\n\ntype Algorithm = \"aldous-broder\" | \"binary-tree\" | \"side-winder\";\n\nexport interface MazeData {\n  bytes: Uint8Array;\n  dimension: Dimension.Dimension;\n  algorithm: Algorithm;\n}\n\ntype ApiCorner = \"nw\" | \"ne\" | \"sw\" | \"se\";\ntype ApiDir = \"n\" | \"e\" | \"s\" | \"w\";\n\nexport interface Options {\n  dimension?: Dimension.Dimension;\n  algorithm?: Algorithm;\n  corner?: ApiCorner;\n  direction?: ApiDir;\n}\n\nexport const fromApi = (\n  dimension: Dimension.Dimension,\n  algorithm: Algorithm,\n  base64: string\n): MazeData => {\n  return {\n    bytes: Uint8Array.from(atob(base64), c => c.charCodeAt(0)),\n    dimension,\n    algorithm\n  };\n};\n\nexport const randomDirectionalOptions = (): Pick<\n  Options,\n  \"corner\" | \"direction\"\n> => ({\n  corner: Arrays.randomItem([\"nw\", \"ne\", \"sw\", \"se\"]),\n  direction: Arrays.randomItem([\"n\", \"e\", \"s\", \"w\"])\n});\n","import { Direction } from \".\";\n\nexport interface Cell {\n  walls: Walls;\n}\n\n/**\n * A wall is present to direction n if n === true\n */\nexport interface Walls {\n  n: boolean;\n  e: boolean;\n  s: boolean;\n  w: boolean;\n}\n\nexport const walls = ({ n, e, s, w }: Partial<Walls>): Walls => ({\n  n: n || false,\n  e: e || false,\n  s: s || false,\n  w: w || false\n});\n\nexport const fromByte = (byte: number) => ({\n  walls: walls({\n    n: !((byte & 0b00001000) > 0),\n    s: !((byte & 0b00000100) > 0),\n    e: !((byte & 0b00000010) > 0),\n    w: !((byte & 0b00000001) > 0)\n  })\n});\n\nexport const isDeadEnd = ({ walls }: Cell) => {\n  return (\n    [walls.n, walls.e, walls.s, walls.w].filter(w => w === true).length >= 3\n  );\n};\n\nexport const hasWall = (\n  { walls }: Cell,\n  direction: Direction.Direction\n): boolean => {\n  switch (direction) {\n    case Direction.Direction.NORTH:\n      return walls.n;\n    case Direction.Direction.EAST:\n      return walls.e;\n    case Direction.Direction.SOUTH:\n      return walls.s;\n    case Direction.Direction.WEST:\n      return walls.w;\n  }\n};\n","import * as Cell from \"./cell\";\nimport * as MazeData from \"./mazeData\";\nimport { Dimension, Point, Direction, Maybe } from \".\";\nimport { Arrays } from \"../util\";\nimport { Entity } from \"./entities\";\n\nexport interface Maze {\n  readonly grid: Grid;\n  readonly dimension: Dimension.Dimension;\n  readonly algorithm: string;\n  readonly deadends: DeadEnds;\n}\n\nexport type Grid = Array<Array<Cell.Cell>>;\n\nexport const fromMazeData = ({\n  dimension,\n  bytes,\n  algorithm\n}: MazeData.MazeData): Maze => {\n  const grid: Grid = [];\n  const deadends: number[] = [];\n  for (let r = 0; r < dimension.height; r++) {\n    const row = [];\n    for (let c = 0; c < dimension.width; c++) {\n      const cell = Cell.fromByte(bytes[r * dimension.width + c]);\n      row.push(cell);\n      if (Cell.isDeadEnd(cell)) {\n        deadends.push(Point.toIndex(Point.create(c, r), dimension));\n      }\n    }\n    grid.push(row);\n  }\n\n  return {\n    grid,\n    dimension,\n    algorithm,\n    deadends: {\n      unused: deadends,\n      used: []\n    }\n  };\n};\n\n/**\n * Find traversable neighbors for a point `p` within a `maze`\n * Given their traversability, they should be in bounds\n * @param maze\n * @param p\n */\nexport const traversableNeighbors = (\n  maze: Maze,\n  p: Point.Point\n): Point.Point[] =>\n  Direction.all()\n    .filter(d => canWalk(maze, p, d))\n    .map(d => Point.neighbor(p, d));\n\n/**\n * Answers the question in this `maze`, from this `point`,\n * can we move in `direction`\n * @param maze the maze to query\n * @param startingPoint the point to query from\n * @param direction the direct to test\n */\nexport const canWalk = (\n  maze: Maze,\n  { x, y }: Point.Point,\n  direction: Direction.Direction\n): boolean => {\n  const cell = maze.grid[y][x];\n  return !Cell.hasWall(cell, direction);\n};\n\n/**\n * Take directions as an ordered set of movement instructions\n * Answer the question: given a `maze` from starting point `p`,\n * can an entity follow the direction set without hitting a walla\n * @param maze\n * @param p\n * @param directions\n */\nexport const canTravel = (\n  maze: Maze,\n  p: Point.Point,\n  ...directions: Direction.Direction[]\n): boolean =>\n  !!directions.reduce(\n    (last: Maybe.Maybe<Point.Point>, d) =>\n      last && canWalk(maze, last, d) ? Point.neighbor(last, d) : undefined,\n    p\n  );\n\nexport const lookInDirection = (\n  maze: Maze,\n  d: Direction.Direction,\n  p: Point.Point,\n  visionRadius: number\n): Point.Point[] => {\n  if (canWalk(maze, p, d) && visionRadius > 0) {\n    const neighbor = Point.neighbor(p, d);\n    return [neighbor, ...lookInDirection(maze, d, neighbor, visionRadius - 1)];\n  } else {\n    return [];\n  }\n};\n\nexport const peekableCorners = (maze: Maze, p: Point.Point): Point.Point[] => {\n  let corners: Point.Point[] = [];\n  if (\n    canTravel(maze, p, Direction.Direction.NORTH, Direction.Direction.EAST) ||\n    canTravel(maze, p, Direction.Direction.EAST, Direction.Direction.NORTH)\n  ) {\n    corners.push(Point.create(p.x + 1, p.y - 1));\n  }\n  if (\n    canTravel(maze, p, Direction.Direction.NORTH, Direction.Direction.WEST) ||\n    canTravel(maze, p, Direction.Direction.WEST, Direction.Direction.NORTH)\n  ) {\n    corners.push(Point.create(p.x - 1, p.y - 1));\n  }\n  if (\n    canTravel(maze, p, Direction.Direction.SOUTH, Direction.Direction.EAST) ||\n    canTravel(maze, p, Direction.Direction.EAST, Direction.Direction.SOUTH)\n  ) {\n    corners.push(Point.create(p.x + 1, p.y + 1));\n  }\n  if (\n    canTravel(maze, p, Direction.Direction.SOUTH, Direction.Direction.WEST) ||\n    canTravel(maze, p, Direction.Direction.WEST, Direction.Direction.SOUTH)\n  ) {\n    corners.push(Point.create(p.x - 1, p.y + 1));\n  }\n\n  return corners;\n};\n\nexport const seenFromPoint = (\n  maze: Maze,\n  origin: Point.Point,\n  visionRadius: number\n): Point.Point[] =>\n  Direction.all()\n    .reduce(\n      (p: Point.Point[], d) =>\n        p.concat(lookInDirection(maze, d, origin, visionRadius)),\n      []\n    )\n    .concat(peekableCorners(maze, origin))\n    .concat(origin);\n\n/**\n * Deadends . . .\n */\n\ninterface DeadEnds {\n  used: number[];\n  unused: number[];\n}\n\nexport const takeDeadEnd = (maze: Maze): [number, Maze] => {\n  const de = Arrays.randomItem(maze.deadends.unused);\n  if (de) {\n    return [\n      de,\n      {\n        ...maze,\n        deadends: {\n          unused: maze.deadends.unused.filter(c => c !== de),\n          used: [...maze.deadends.used, de]\n        }\n      }\n    ];\n  } else {\n    return [-1, maze];\n  }\n};\n\nexport const deadEnds = (maze: Maze): number[] => {\n  return [...maze.deadends.used, ...maze.deadends.unused];\n};\n\ntype EntityCreator = (p: Point.Point) => Entity.Entity;\ntype PlacementAcc = {\n  maze: Maze;\n  placed: Entity.Entity[];\n  unplaced: Entity.Entity[];\n};\n\nexport const placeEntitiesInDeadEnds = (\n  maze: Maze,\n  creators: EntityCreator[]\n): PlacementAcc => {\n  return creators.reduce(\n    (acc: PlacementAcc, creator) => {\n      const [de, maze] = takeDeadEnd(acc.maze);\n      let placed;\n      let unplaced;\n      if (de) {\n        placed = [\n          ...acc.placed,\n          creator(Point.fromIndex(de, acc.maze.dimension))\n        ];\n        unplaced = [...acc.unplaced];\n      } else {\n        placed = [...acc.placed];\n        unplaced = [...acc.unplaced, creator(Point.create(-1, -1))];\n      }\n      return {\n        maze,\n        placed,\n        unplaced\n      };\n    },\n    {\n      maze,\n      placed: [],\n      unplaced: []\n    }\n  );\n};\n","interface Loaded<T> {\n  state: \"Loaded\";\n  data: T;\n}\n\ninterface Loading {\n  state: \"Loading\";\n}\n\ninterface Errored {\n  state: \"Errored\";\n  e: any;\n}\n\nexport type Loadable<T> = Loaded<T> | Loading | Errored;\n\nexport const isLoading = <T>(l: Loadable<T>): l is Loading =>\n  l.state === \"Loading\";\n\nexport const isLoaded = <T>(l: Loadable<T>): l is Loaded<T> =>\n  l.state === \"Loaded\";\n\nexport const isErrored = <T>(l: Loadable<T>): l is Errored =>\n  l.state === \"Errored\";\n\nexport const loading = <T>(): Loading => ({ state: \"Loading\" });\n\nexport const loaded = <T>(data: T): Loaded<T> => ({\n  state: \"Loaded\",\n  data\n});\n\nexport const errored = <T>(e: any): Errored => ({ state: \"Errored\", e });\n\nexport const map = <T, R>(f: (t: T) => R, l: Loadable<T>): Loadable<R> =>\n  isLoaded(l) ? loaded(f(l.data)) : l;\n","import { v4 } from \"uuid\";\n\nexport type ID = string;\n\nexport const create = (): ID => v4();\n","import { BaseEntity } from \".\";\nimport { Point, ID } from \"..\";\nimport { Arrays } from \"../../util\";\n\nexport interface Player extends BaseEntity.BaseEntity {\n  type: \"player\";\n  name: string;\n  visionRadius: number;\n  displayName: string;\n  cls: BaseEntity.EntityClass.PLAYER;\n}\n\nexport const create = (\n  name: string,\n  position: Point.Point = Point.create(),\n  visionRadius: number = 5,\n  displayName: string = randomDisplayName()\n): Player => ({\n  id: ID.create(),\n  name,\n  position,\n  type: \"player\",\n  visionRadius,\n  displayName: displayName || name,\n  cls: BaseEntity.EntityClass.PLAYER\n});\n\nexport const randomDisplayName = (): string =>\n  Arrays.randomItem([\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\",\n    \"\"\n    // \"\",\n    // \"\"\n  ]);\n","import { ID, Dimension, Point, Maybe } from \"..\";\nimport { Entity, Player } from \"../entities\";\nimport { Arrays } from \"../../util\";\nimport { EntityData } from \".\";\n\nexport interface EntityData {\n  entityMap: Record<ID.ID, Entity.Entity>;\n  positionMap: Record<number, ID.ID[]>;\n  playerEntityId: Maybe.Maybe<ID.ID>;\n  typeMap: Record<string, ID.ID[]>;\n}\n\nexport const addEntity = (\n  { entityMap, positionMap, playerEntityId, typeMap }: EntityData,\n  d: Dimension.Dimension,\n  e: Entity.Entity\n): EntityData.EntityData => {\n  const index = Point.toIndex(e.position, d);\n\n  return {\n    playerEntityId,\n    positionMap: {\n      ...positionMap,\n      [index]: positionMap[index] ? [...positionMap[index], e.id] : [e.id]\n    },\n    entityMap: { ...entityMap, [e.id]: e },\n    typeMap: {\n      ...typeMap,\n      [e.type]: typeMap[e.type] ? [...typeMap[e.type], e.id] : [e.id]\n    }\n  };\n};\n\nexport const fromEntities = (\n  entities: Entity.Entity[],\n  dimension: Dimension.Dimension\n): EntityData => ({\n  entityMap: entities.reduce((m: Record<ID.ID, Entity.Entity>, e) => {\n    m[e.id] = e;\n    return m;\n  }, {}),\n  positionMap: entities.reduce((m: Record<number, ID.ID[]>, e) => {\n    const idx = Point.toIndex(e.position, dimension);\n    m[idx] = m[idx] ? [...m[idx], e.id] : [e.id];\n    return m;\n  }, {}),\n  playerEntityId: Maybe.map(\n    p => p.id,\n    entities.find(e => e.type === \"player\")\n  ),\n  typeMap: entities.reduce(\n    (m: Record<string, ID.ID[]>, e) => ({\n      ...m,\n      [e.type]: m[e.type] ? [...m[e.type], e.id] : [e.id]\n    }),\n    {}\n  )\n});\n\nexport const entitiesAtPoint = (\n  data: EntityData,\n  p: Point.Point,\n  d: Dimension.Dimension\n): Entity.Entity[] => {\n  const idx = Point.toIndex(p, d);\n  const ids = data.positionMap[idx] || [];\n  return ids.map(id => data.entityMap[id]);\n};\n\nexport const getPlayer = (data: EntityData): Player.Player =>\n  Maybe.map(id => data.entityMap[id] as Player.Player, data.playerEntityId)!;\n\nexport const byId = (data: EntityData, id: ID.ID) => data.entityMap[id];\n\nexport const byType = (data: EntityData, type: string): Entity.Entity[] =>\n  Arrays.nonNull(data.typeMap[type] || []).map(id => data.entityMap[id]);\n\nexport const moveEntity = (\n  id: ID.ID,\n  data: EntityData,\n  p: Point.Point,\n  d: Dimension.Dimension\n): EntityData => {\n  const entity = data.entityMap[id];\n  if (entity != null) {\n    const oldIdx = Point.toIndex(entity.position, d);\n    const newIdx = Point.toIndex(p, d);\n    const newEntity = { ...entity, position: p };\n    return {\n      ...data,\n      entityMap: { ...data.entityMap, [id]: newEntity },\n      positionMap: {\n        ...data.positionMap,\n        [oldIdx]: [\n          ...(data.positionMap[oldIdx] || []).filter(eId => eId !== id)\n        ],\n        [newIdx]: [...(data.positionMap[newIdx] || []), id]\n      }\n    };\n  } else {\n    return data;\n  }\n};\n\nexport const removeEntity = (\n  id: ID.ID,\n  data: EntityData,\n  d: Dimension.Dimension\n): EntityData => {\n  const entity = data.entityMap[id];\n  const idx = Point.toIndex(entity.position, d);\n  return {\n    ...data,\n    entityMap: Object.keys(data.entityMap).reduce(\n      (m: Record<ID.ID, Entity.Entity>, k) => {\n        if (k !== id) {\n          m[k] = data.entityMap[k];\n        }\n        return m;\n      },\n      {}\n    ),\n    typeMap: Object.keys(data.typeMap).reduce(\n      (m: Record<string, ID.ID[]>, k) => {\n        if (k === entity.type) {\n          m[k] = data.typeMap[k].filter(eId => eId !== id);\n        } else {\n          m[k] = data.typeMap[k];\n        }\n        return m;\n      },\n      {}\n    ),\n    positionMap: Object.keys(data.positionMap)\n      .map(k => parseInt(k) as number)\n      .reduce((m: Record<number, ID.ID[]>, k: number) => {\n        if (k === idx) {\n          m[k] = data.positionMap[k].filter(eId => eId !== id);\n        } else {\n          m[k] = data.positionMap[k];\n        }\n        return m;\n      }, {})\n  };\n};\n\n// might need to augment to handle type change\nexport const updateEntity = (\n  updated: Entity.Entity,\n  data: EntityData\n): EntityData => ({\n  ...data,\n  entityMap: { ...data.entityMap, [updated.id]: updated }\n});\n\nexport const entitiesCrossed = (\n  last: EntityData,\n  next: EntityData,\n  a: ID.ID,\n  b: ID.ID\n): boolean => {\n  const lastA = last.entityMap[a];\n  const lastB = last.entityMap[b];\n  const nextA = next.entityMap[a];\n  const nextB = next.entityMap[b];\n\n  return (\n    Point.equals(nextA.position, lastB.position) &&\n    Point.equals(nextB.position, lastA.position)\n  );\n};\n\nexport const neighborsCrossedByEntity = (\n  last: EntityData,\n  next: EntityData,\n  e: ID.ID,\n  d: Dimension.Dimension\n): Entity.Entity[] => {\n  const neighborIndices = Point.neighbors(\n    next.entityMap[e].position,\n    d\n  ).map(p => Point.toIndex(p, d));\n\n  const neighborEntities = neighborIndices.reduce(\n    (entities: ID.ID[], idx) => entities.concat(next.positionMap[idx] || []),\n    []\n  );\n\n  return neighborEntities\n    .filter(id => entitiesCrossed(last, next, e, id))\n    .map(id => next.entityMap[id]);\n};\n","export interface BaseInstruction {\n  type: InstructionType;\n}\n\nexport enum InstructionType {\n  MOVE = \"MOVE\",\n  UPDATE = \"UPDATE\",\n  WAIT = \"WAIT\",\n  UPDATE_GAME_STATE = \"UPDATE_GAME_STATE\",\n  SEE = \"SEE\",\n  REMOVE = \"REMOVE\",\n  ADD = \"ADD\"\n}\n","import { Maze, Cell, Point, Instruction, Direction } from \"..\";\nimport { EntityData, GameData, GameState } from \".\";\nimport { Entity } from \"../entities\";\n\nexport interface GameData {\n  maze: Maze.Maze;\n  entityData: EntityData.EntityData;\n  seen: Set<number>;\n  sees: Set<number>;\n  stepCount: number;\n  state: GameState.GameState;\n}\n\nexport const create = (\n  maze: Maze.Maze,\n  entityData: EntityData.EntityData\n): GameData => {\n  const player = EntityData.getPlayer(entityData);\n  const sees = new Set<number>(\n    player\n      ? Maze.seenFromPoint(maze, player.position, player.visionRadius).map(p =>\n          Point.toIndex(p, maze.dimension)\n        )\n      : []\n  );\n\n  return {\n    maze,\n    entityData,\n    seen: new Set(),\n    sees,\n    stepCount: 0,\n    state: GameState.play()\n  };\n};\n\nexport const lookForEntityInDirection = (\n  d: Direction.Direction,\n  origin: Point.Point,\n  gameData: GameData.GameData,\n  predicate: (e: Entity.Entity) => boolean,\n  siteRadius: number = 5\n): boolean =>\n  Maze.lookInDirection(gameData.maze, d, origin, siteRadius).reduce(\n    (found: boolean, p) =>\n      !found\n        ? EntityData.entitiesAtPoint(\n            gameData.entityData,\n            p,\n            gameData.maze.dimension\n          ).find(predicate) != null\n        : found,\n    false\n  );\n\nexport interface CellMeta {\n  occupants: Entity.Entity[];\n  visible: boolean;\n  seen: boolean;\n  unknown: boolean;\n}\n\nexport interface CellAndMeta {\n  cell: Cell.Cell;\n  meta: CellMeta;\n}\n\nexport type DisplayGrid = CellAndMeta[][];\n\nexport const displayGrid = ({\n  maze,\n  entityData,\n  seen,\n  sees\n}: GameData): DisplayGrid =>\n  maze.grid.reduce(\n    (rows: CellAndMeta[][], row, rowIdx) => [\n      ...rows,\n      row.reduce((cells: CellAndMeta[], cell, cellIdx) => {\n        const p = Point.create(cellIdx, rowIdx);\n        const isSeen = seen.has(Point.toIndex(p, maze.dimension));\n        const isVisible = sees.has(Point.toIndex(p, maze.dimension));\n        return cells.concat({\n          cell,\n          meta: {\n            occupants: EntityData.entitiesAtPoint(\n              entityData,\n              Point.create(cellIdx, rowIdx),\n              maze.dimension\n            ),\n            visible: isVisible,\n            seen: isSeen,\n            unknown: !isVisible && !isSeen\n          }\n        });\n      }, [])\n    ],\n    []\n  );\n\nexport const generateAllAIInstructions = (\n  gameData: GameData.GameData\n): Instruction.Instruction[] => {\n  const aiEntities = Object.keys(gameData.entityData.entityMap)\n    .map(k => EntityData.byId(gameData.entityData, k))\n    .filter(e => e.type !== \"player\");\n\n  return aiEntities.reduce(\n    (i: Instruction.Instruction[], e) =>\n      i.concat(Entity.generateAiInstructions(e, gameData)),\n    []\n  );\n};\n","import { ID } from \"..\";\n\nexport interface Won {\n  type: \"Won\";\n}\n\ninterface Murdered {\n  entityId: ID.ID;\n}\n\ntype CauseOfDeath = Murdered;\n\nexport interface Lost {\n  type: \"Lost\";\n  causeOfDeath: CauseOfDeath;\n}\n\nexport interface Playing {\n  type: \"Playing\";\n}\n\nexport type GameState = Won | Lost | Playing;\n\nexport const win = (): Won => ({ type: \"Won\" });\n\nexport const lose = (cod: CauseOfDeath): Lost => ({\n  type: \"Lost\",\n  causeOfDeath: cod\n});\n\nexport const play = (): Playing => ({ type: \"Playing\" });\n\nexport const won = (state: GameState): state is Won => state.type === \"Won\";\nexport const lost = (state: GameState): state is Lost => state.type === \"Lost\";\nexport const playing = (state: GameState): state is Playing =>\n  state.type === \"Playing\";\n","import { GameData, GameState } from \"../game\";\nimport { Instruction, Outcome } from \"..\";\nimport {\n  BlindGuardian,\n  Player,\n  Exit,\n  WanderingHusk,\n  Entity,\n  SinisterDolls,\n  Seeker\n} from \".\";\nimport { EntityClass } from \"./baseEntity\";\nimport { Items, OrbOfKnowing } from \"./items\";\n\nexport type HostileEntities =\n  | BlindGuardian.BlindGuardian\n  | WanderingHusk.WanderingHusk\n  | SinisterDolls.SinisterDolls\n  | Seeker.Seeker;\n\nexport type Entity = Player.Player | Exit.Exit | HostileEntities | Items;\n\nexport const getColor = (e: Entity): string => {\n  switch (e.type) {\n    default:\n      return \"transparent\";\n  }\n};\n\nexport const getDescription = (e: Entity): string => {\n  switch (e.type) {\n    case \"player\":\n      return e.name;\n    case \"blind-guardian\":\n      return \"a blind guardian\";\n    case \"exit\":\n      return \"an exit\";\n    case \"wandering-husk\":\n      return \"a wandering husk\";\n    case \"orb-of-knowing\":\n      return \"a mysterious, translucent orb\";\n    case \"sinister-dolls\":\n      return \"two lifelike dolls\";\n    case \"seeker\":\n      return \"the seeker\";\n  }\n};\n\nexport const generateAiInstructions = (\n  e: Entity,\n  gameData: GameData.GameData\n): Instruction.Instruction[] => {\n  switch (e.type) {\n    case \"blind-guardian\":\n      return BlindGuardian.next(e, gameData);\n    case \"wandering-husk\":\n      return WanderingHusk.next(e, gameData);\n    case \"sinister-dolls\":\n      return SinisterDolls.next(e, gameData);\n    case \"seeker\":\n      return Seeker.next(e, gameData);\n    default:\n      return [];\n  }\n};\n\nexport const onCollideWithPlayer = (\n  e: Entity,\n  gameData: GameData.GameData\n): Outcome.Outcome => {\n  if (e.cls === EntityClass.HOSTILE) {\n    return Outcome.create([\n      Instruction.updateGameState(GameState.lose({ entityId: e.id }))\n    ]);\n  } else if (e.cls === EntityClass.ITEM) {\n    return Outcome.create(undefined, [e.phenomena]);\n  } else if (e.type === \"exit\") {\n    return Outcome.create([Instruction.updateGameState(GameState.win())]);\n  } else {\n    return Outcome.create();\n  }\n};\n\nexport const getKillMessage = (p: Player.Player, killer: Entity): string => {\n  switch (killer.type) {\n    case \"blind-guardian\":\n      return `${p.name} has been annihilated by ${getDescription(\n        killer\n      )}. Nothing is left.`;\n    case \"wandering-husk\":\n      return `Blood and sinew cling to the maw of the wandering husk. ${p.name} has been consumed.`;\n    case \"sinister-dolls\":\n      return `The dolls draw closer. ${p.name} is frozen. Then, darkness. ${p.name} is never heard from again.`;\n    default:\n      return `${p.name} was killed by ${getDescription(killer)}`;\n  }\n};\n","import { BaseEntity } from \"..\";\nimport { Point, ID, Direction, Instruction, Maze } from \"../..\";\nimport { GameData } from \"../../game\";\nimport { Arrays } from \"../../../util\";\n\n/**\n * The blind guardian is a sightless, senseless automaton\n */\nexport interface BlindGuardian extends BaseEntity.HostileEntity {\n  type: \"blind-guardian\";\n  heading: Direction.Direction;\n}\n\nexport const create = (\n  position: Point.Point = Point.create()\n): BlindGuardian => ({\n  type: \"blind-guardian\",\n  position,\n  id: ID.create(),\n  heading: Direction.Direction.NORTH,\n  cls: BaseEntity.EntityClass.HOSTILE\n});\n\nexport const next = (\n  e: BlindGuardian,\n  gameData: GameData.GameData\n): Instruction.Instruction[] => {\n  const options = Direction.all().filter(d =>\n    Maze.canWalk(gameData.maze, e.position, d)\n  );\n\n  const adjacent = options.filter(d => d !== Direction.inverse(e.heading));\n\n  let direction: Direction.Direction;\n\n  if (options.includes(e.heading) && Math.random() < 0.75) {\n    direction = e.heading;\n  } else if (Math.random() < 0.75 && adjacent.length > 0) {\n    direction = Arrays.randomItem(adjacent);\n  } else {\n    direction = options[0];\n  }\n\n  return [\n    Instruction.update({ ...e, heading: direction }),\n    Instruction.move(e.id, direction)\n  ];\n};\n","import { BaseEntity } from \"..\";\nimport { Point, ID, Direction, Instruction, Maze, Maybe } from \"../..\";\nimport { GameData, EntityData } from \"../../game\";\nimport { Arrays } from \"../../../util\";\n\n/**\n * The wandering husk shambles aimlesslessy, until it lays its eyes on prey.\n * It pursues relentlessly that which it can see.\n */\n\nexport interface WanderingHusk extends BaseEntity.HostileEntity {\n  type: \"wandering-husk\";\n  heading: Direction.Direction;\n}\n\nexport const create = (\n  position: Point.Point = Point.create()\n): WanderingHusk => ({\n  type: \"wandering-husk\",\n  position,\n  id: ID.create(),\n  heading: Direction.random(),\n  cls: BaseEntity.EntityClass.HOSTILE\n});\n\nexport const next = (\n  e: WanderingHusk,\n  gameData: GameData.GameData\n): Instruction.Instruction[] => {\n  const towardPlayer = Direction.all().reduce(\n    (heading: Maybe.Maybe<Direction.Direction>, d) =>\n      !heading\n        ? lookForPlayerInDirection(d, e.position, gameData)\n          ? d\n          : undefined\n        : heading,\n    undefined\n  );\n\n  const instructions = [];\n  let heading: Direction.Direction;\n  if (towardPlayer) {\n    if (Math.random() < 0.9) {\n      heading = towardPlayer;\n\n      instructions.push(Instruction.move(e.id, heading));\n    } else {\n      heading = e.heading;\n      instructions.push(Instruction.wait(e.id));\n    }\n  } else {\n    heading = wander(e, gameData);\n\n    instructions.push(Instruction.move(e.id, heading));\n  }\n\n  return [Instruction.update({ ...e, heading }), ...instructions];\n};\n\nexport const wander = (\n  e: WanderingHusk,\n  gameData: GameData.GameData\n): Direction.Direction => {\n  const options = Direction.all().filter(d =>\n    Maze.canWalk(gameData.maze, e.position, d)\n  );\n\n  const adjacent = options.filter(d => d !== Direction.inverse(e.heading));\n\n  let direction: Direction.Direction;\n\n  if (options.includes(e.heading) && Math.random() < 0.75) {\n    direction = e.heading;\n  } else if (Math.random() < 0.75 && adjacent.length > 0) {\n    direction = Arrays.randomItem(adjacent);\n  } else {\n    direction = options[0];\n  }\n  return direction;\n};\n\nexport const lookForPlayerInDirection = (\n  d: Direction.Direction,\n  origin: Point.Point,\n  gameData: GameData.GameData\n): boolean =>\n  Maze.lookInDirection(gameData.maze, d, origin, 5).reduce(\n    (foundPlayer: boolean, p) =>\n      !foundPlayer\n        ? EntityData.entitiesAtPoint(\n            gameData.entityData,\n            p,\n            gameData.maze.dimension\n          ).find(e => e.type === \"player\") != null\n        : foundPlayer,\n    false\n  );\n","import { BaseEntity } from \".\";\nimport { Point, ID } from \"..\";\n\nexport interface Exit extends BaseEntity.BaseEntity {\n  type: \"exit\";\n  cls: BaseEntity.EntityClass.INANIMATE;\n}\n\nexport const create = (position: Point.Point): Exit => ({\n  position,\n  id: ID.create(),\n  type: \"exit\",\n  cls: BaseEntity.EntityClass.INANIMATE\n});\n","import { BaseEntity } from \"..\";\nimport { Point, ID, Direction, Instruction, Maybe } from \"../..\";\nimport { GameData } from \"../../game\";\nimport { lookForEntityInDirection } from \"../../game/gameData\";\n\n/**\n * The sinister dolls wait for a playmate\n */\n\nexport interface SinisterDolls extends BaseEntity.HostileEntity {\n  type: \"sinister-dolls\";\n}\n\nexport const create = (\n  position: Point.Point = Point.create()\n): SinisterDolls => ({\n  type: \"sinister-dolls\",\n  position,\n  id: ID.create(),\n  cls: BaseEntity.EntityClass.HOSTILE\n});\n\nexport const next = (\n  e: SinisterDolls,\n  gameData: GameData.GameData\n): Instruction.Instruction[] => {\n  const towardPlayer = Direction.all().reduce(\n    (towardPlayer: Maybe.Maybe<Direction.Direction>, d) =>\n      !towardPlayer\n        ? lookForEntityInDirection(\n            d,\n            e.position,\n            gameData,\n            e => e.type === \"player\"\n          )\n          ? d\n          : undefined\n        : towardPlayer,\n    undefined\n  );\n\n  return towardPlayer && Math.random() < 0.9\n    ? [Instruction.move(e.id, towardPlayer)]\n    : [];\n};\n","import { BaseEntity } from \"..\";\nimport { GameData, EntityData } from \"../../game\";\nimport {\n  Instruction,\n  Point,\n  ID,\n  Maze,\n  PriorityQueue,\n  Maybe,\n  Direction,\n  Dimension\n} from \"../..\";\nimport { maze } from \"../../../util/api\";\n\n/**\n * The seeker is a merciless hunter from another world.\n */\nexport interface Seeker extends BaseEntity.HostileEntity {\n  type: \"seeker\";\n}\n\nexport const create = (position: Point.Point = Point.create()): Seeker => ({\n  type: \"seeker\",\n  position,\n  id: ID.create(),\n  cls: BaseEntity.EntityClass.HOSTILE\n});\n\nexport const prioritize = (p: Point.Point, target: Point.Point): number =>\n  Math.round(Point.distance(p, target));\n\ntype Frontier = PriorityQueue.Queue<Point.Point>;\n\nexport const addAllToFrontier = (\n  frontier: Frontier,\n  points: Point.Point[],\n  target: Point.Point\n): Frontier =>\n  points.reduce(\n    (queue, p) => PriorityQueue.queue(queue, p, prioritize(p, target)),\n    frontier\n  );\n\nexport const next = (\n  e: Seeker,\n  gameData: GameData.GameData\n): Instruction.Instruction[] => {\n  const target = EntityData.getPlayer(gameData.entityData).position;\n  const start = e.position;\n  const dimension = gameData.maze.dimension;\n\n  const cameFrom: Map<number, Maybe.Maybe<Point.Point>> = new Map();\n  cameFrom.set(Point.toIndex(start, dimension), undefined);\n  let result: Maybe.Maybe<Point.Point> = Maybe.none();\n  let frontier: Frontier = addAllToFrontier(\n    PriorityQueue.create(),\n    [start],\n    target\n  );\n\n  while (true) {\n    const { queue: newFrontier, item: nextPoint } = PriorityQueue.dequeue(\n      frontier,\n      Math.min,\n      Point.equals\n    );\n\n    if (!nextPoint) {\n      result = Maybe.none();\n      break;\n    }\n\n    const traversableNeighbors = Maze.traversableNeighbors(\n      gameData.maze,\n      nextPoint\n    ).filter(n => !cameFrom.has(Point.toIndex(n, dimension)));\n    traversableNeighbors.forEach(neighbor =>\n      cameFrom.set(Point.toIndex(neighbor, dimension), nextPoint)\n    );\n\n    const found = traversableNeighbors.filter(n => Point.equals(n, target));\n\n    if (found.length > 0) {\n      result = calculateOptimalMove(found[0], start, cameFrom, dimension);\n      break;\n    }\n\n    frontier = addAllToFrontier(newFrontier, traversableNeighbors, target);\n  }\n\n  const direction = Maybe.map(\n    nextTile =>\n      Maybe.of(\n        Direction.all().find(d =>\n          Point.equals(nextTile, Point.neighbor(start, d))\n        )\n      ),\n    result\n  );\n\n  return Maybe.withDefault(\n    Maybe.map(d => [Instruction.move(e.id, d)], direction),\n    []\n  );\n};\n\nexport const calculateOptimalMove = (\n  target: Point.Point,\n  start: Point.Point,\n  cameFrom: Map<number, Maybe.Maybe<Point.Point>>,\n  dimension: Dimension.Dimension\n): Point.Point => {\n  let test = target;\n  while (true) {\n    const back = cameFrom.get(Point.toIndex(test, dimension));\n    if (back == start || back == undefined) {\n      return test;\n    } else {\n      test = back;\n    }\n  }\n};\n","import { Dimension, Point, Direction } from \".\";\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport const create = (x: number = 0, y: number = 0): Point => ({ x, y });\n\nexport const toIndex = (\n  { x, y }: Point,\n  { width }: Dimension.Dimension\n): number => y * width + x;\n\nexport const fromIndex = (idx: number, { width }: Dimension.Dimension): Point =>\n  create(idx % width, Math.floor(idx / width));\n\nexport const neighbor = (p: Point, d: Direction.Direction): Point => {\n  switch (d) {\n    case \"NORTH\":\n      return Point.create(p.x, p.y - 1);\n    case \"SOUTH\":\n      return Point.create(p.x, p.y + 1);\n    case \"EAST\":\n      return Point.create(p.x + 1, p.y);\n    case \"WEST\":\n    default:\n      return Point.create(p.x - 1, p.y);\n  }\n};\n\nexport const neighbors = (p: Point, d: Dimension.Dimension): Point[] =>\n  Direction.all()\n    .map(d => neighbor(p, d))\n    .filter(p => Dimension.inBounds(d, p));\n\nexport const diagonalNeighbors = (p: Point, d: Dimension.Dimension): Point[] =>\n  [\n    create(p.x - 1, p.y - 1),\n    create(p.x + 1, p.y - 1),\n    create(p.x + 1, p.y + 1),\n    create(p.x - 1, p.y + 1)\n  ].filter(p => Dimension.inBounds(d, p));\n\nexport const equals = (a: Point.Point, b: Point.Point): boolean =>\n  a.x === b.x && a.y === b.y;\n\nexport const distance = (a: Point.Point, b: Point.Point): number =>\n  Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));\n","import { Instruction, ID } from \".\";\n\nexport interface Step {\n  instructions: Instruction.Instruction[];\n  id: ID.ID;\n}\n\nexport const create = (...instructions: Instruction.Instruction[]): Step => ({\n  instructions,\n  id: ID.create()\n});\n","import { Direction, ID, Result, Maze, Point } from \"..\";\nimport { GameData, EntityData } from \"../game\";\nimport { BaseInstruction, InstructionType } from \"./baseInstruction\";\nimport { Player } from \"../entities\";\n\nexport interface MoveInstruction extends BaseInstruction {\n  type: InstructionType.MOVE;\n  payload: {\n    direction: Direction.Direction;\n    entityId: ID.ID;\n  };\n}\n\nexport const move = (\n  entityId: ID.ID,\n  direction: Direction.Direction\n): MoveInstruction => ({\n  type: InstructionType.MOVE,\n  payload: { entityId, direction }\n});\n\nexport const validate = (\n  { payload }: MoveInstruction,\n  gameData: GameData.GameData\n): Result.Result<void> =>\n  Maze.canWalk(\n    gameData.maze,\n    gameData.entityData.entityMap[payload.entityId].position,\n    payload.direction\n  )\n    ? Result.ok(undefined)\n    : Result.err(\"way is blocked\");\n\nexport const apply = (\n  move: MoveInstruction,\n  gameData: GameData.GameData\n): GameData.GameData => {\n  const { entityId, direction } = move.payload;\n  const entityData = EntityData.moveEntity(\n    entityId,\n    gameData.entityData,\n    Point.neighbor(gameData.entityData.entityMap[entityId].position, direction),\n    gameData.maze.dimension\n  );\n\n  const player = EntityData.getPlayer(entityData);\n  const { seen, sees } =\n    player && entityId === player.id\n      ? updatePlayerVision(gameData.seen, player, gameData.maze)\n      : gameData;\n\n  return {\n    ...gameData,\n    seen,\n    sees,\n    entityData\n  };\n};\n\nexport const updatePlayerVision = (\n  prev: Set<number>,\n  player: Player.Player,\n  maze: Maze.Maze\n): Pick<GameData.GameData, \"seen\" | \"sees\"> => {\n  const sees = new Set<number>(\n    Maze.seenFromPoint(maze, player.position, player.visionRadius).map(p =>\n      Point.toIndex(p, maze.dimension)\n    )\n  );\n\n  const seen = new Set<number>([...prev, ...sees]);\n\n  return { sees, seen };\n};\n","import * as Arrays from \"../util/arrays\";\n\nexport enum Direction {\n  NORTH = \"NORTH\",\n  SOUTH = \"SOUTH\",\n  EAST = \"EAST\",\n  WEST = \"WEST\"\n}\n\nexport const all = (): Direction[] => [\n  Direction.NORTH,\n  Direction.SOUTH,\n  Direction.EAST,\n  Direction.WEST\n];\n\nexport const inverse = (d: Direction): Direction => {\n  switch (d) {\n    case Direction.NORTH:\n      return Direction.SOUTH;\n    case Direction.SOUTH:\n      return Direction.NORTH;\n    case Direction.EAST:\n      return Direction.WEST;\n    case Direction.WEST:\n      return Direction.EAST;\n  }\n};\n\nexport const random = (): Direction => Arrays.randomItem(all());\n","import { BaseInstruction, InstructionType } from \"./baseInstruction\";\nimport { Entity } from \"../entities\";\nimport { GameData, EntityData } from \"../game\";\n\nexport interface UpdateInstruction extends BaseInstruction {\n  type: InstructionType.UPDATE;\n  payload: {\n    updated: Entity.Entity;\n  };\n}\n\nexport const update = (updated: Entity.Entity): UpdateInstruction => ({\n  type: InstructionType.UPDATE,\n  payload: { updated }\n});\n\nexport const apply = (\n  update: UpdateInstruction,\n  gameData: GameData.GameData\n): GameData.GameData => ({\n  ...gameData,\n  entityData: EntityData.updateEntity(\n    update.payload.updated,\n    gameData.entityData\n  )\n});\n","import { BaseInstruction, InstructionType } from \"./baseInstruction\";\nimport { ID } from \"..\";\nimport { GameData } from \"../game\";\n\nexport interface WaitInstruction extends BaseInstruction {\n  type: InstructionType.WAIT;\n  payload: {\n    entityId: ID.ID;\n  };\n}\n\nexport const wait = (entityId: ID.ID): WaitInstruction => ({\n  type: InstructionType.WAIT,\n  payload: {\n    entityId\n  }\n});\n\nexport const apply = (\n  _: WaitInstruction,\n  gameData: GameData.GameData\n): GameData.GameData => ({ ...gameData });\n","import { BaseInstruction, InstructionType } from \"./baseInstruction\";\nimport { GameState, GameData } from \"../game\";\n\nexport interface UpdateGameStateInstruction extends BaseInstruction {\n  type: InstructionType.UPDATE_GAME_STATE;\n  payload: {\n    updated: GameState.GameState;\n  };\n}\n\nexport const updateGameState = (\n  updated: GameState.GameState\n): UpdateGameStateInstruction => ({\n  type: InstructionType.UPDATE_GAME_STATE,\n  payload: {\n    updated\n  }\n});\n\nexport const apply = (\n  update: UpdateGameStateInstruction,\n  gameData: GameData.GameData\n): GameData.GameData => ({\n  ...gameData,\n  state: GameState.lost(gameData.state)\n    ? gameData.state\n    : update.payload.updated\n});\n","import { BaseInstruction, InstructionType } from \"./baseInstruction\";\nimport { GameData } from \"../game\";\n\nexport interface SeeInstruction extends BaseInstruction {\n  type: InstructionType.SEE;\n  payload: number[];\n}\n\nexport const see = (indices: number[]): SeeInstruction => ({\n  type: InstructionType.SEE,\n  payload: indices\n});\n\nexport const apply = (\n  see: SeeInstruction,\n  gameData: GameData.GameData\n): GameData.GameData => ({\n  ...gameData,\n  seen: new Set([...gameData.seen, ...see.payload])\n});\n","import { BaseInstruction, InstructionType } from \"./baseInstruction\";\nimport { ID } from \"..\";\nimport { GameData, EntityData } from \"../game\";\n\nexport interface RemoveInstruction extends BaseInstruction {\n  type: InstructionType.REMOVE;\n  payload: ID.ID;\n}\n\nexport const remove = (id: ID.ID): RemoveInstruction => ({\n  type: InstructionType.REMOVE,\n  payload: id\n});\n\nexport const apply = (\n  remove: RemoveInstruction,\n  gameData: GameData.GameData\n): GameData.GameData => ({\n  ...gameData,\n  entityData: EntityData.removeEntity(\n    remove.payload,\n    gameData.entityData,\n    gameData.maze.dimension\n  )\n});\n","import { BaseInstruction, InstructionType } from \"./baseInstruction\";\nimport { Entity } from \"../entities\";\nimport { GameData, EntityData } from \"../game\";\n\nexport interface AddInstruction extends BaseInstruction {\n  type: InstructionType.ADD;\n  payload: {\n    entities: Entity.Entity[];\n  };\n}\n\nexport const add = (...entities: Entity.Entity[]): AddInstruction => ({\n  type: InstructionType.ADD,\n  payload: {\n    entities\n  }\n});\n\nexport const apply = (\n  add: AddInstruction,\n  gameData: GameData.GameData\n): GameData.GameData => {\n  return {\n    ...gameData,\n    entityData: add.payload.entities.reduce(\n      (data, e) => EntityData.addEntity(data, gameData.maze.dimension, e),\n      gameData.entityData\n    )\n  };\n};\n","import { Result, Instruction } from \"..\";\nimport * as Move from \"./move\";\nimport * as Update from \"./update\";\nimport * as Wait from \"./wait\";\nimport * as UpdateGameState from \"./updateGameState\";\nimport * as See from \"./see\";\nimport * as Remove from \"./remove\";\nimport * as Add from \"./add\";\nimport { GameData } from \"../game\";\nimport { InstructionType } from \"./baseInstruction\";\n\nexport type Instruction =\n  | Move.MoveInstruction\n  | Update.UpdateInstruction\n  | Wait.WaitInstruction\n  | UpdateGameState.UpdateGameStateInstruction\n  | See.SeeInstruction\n  | Remove.RemoveInstruction\n  | Add.AddInstruction;\n\nexport const validate = (\n  instruction: Instruction,\n  gameData: GameData.GameData\n): Result.Result<void> => {\n  switch (instruction.type) {\n    case InstructionType.MOVE:\n      return Move.validate(instruction, gameData);\n    case InstructionType.WAIT:\n      return Result.ok(undefined);\n    default:\n      return Result.err(`Unkown instruction of type ${instruction.type}`);\n  }\n};\n\nexport const validateAll = (\n  instructions: Instruction[],\n  gameData: GameData.GameData\n): Result.Result<void> =>\n  instructions.reduce(\n    (validated: Result.Result<void>, i) =>\n      Result.isOk(validated) ? validate(i, gameData) : validated,\n    Result.ok(undefined)\n  );\n\nexport const apply = (\n  instruction: Instruction,\n  gameData: GameData.GameData\n): Result.Result<GameData.GameData> => {\n  try {\n    switch (instruction.type) {\n      case InstructionType.MOVE:\n        return Result.ok(Move.apply(instruction, gameData));\n      case InstructionType.UPDATE:\n        return Result.ok(Update.apply(instruction, gameData));\n      case InstructionType.WAIT:\n        return Result.ok(Wait.apply(instruction, gameData));\n      case InstructionType.UPDATE_GAME_STATE:\n        return Result.ok(UpdateGameState.apply(instruction, gameData));\n      case InstructionType.SEE:\n        return Result.ok(See.apply(instruction, gameData));\n      case InstructionType.REMOVE:\n        return Result.ok(Remove.apply(instruction, gameData));\n      case InstructionType.ADD:\n        return Result.ok(Add.apply(instruction, gameData));\n    }\n  } catch (e) {\n    console.warn(\"Error applying instruction\", instruction);\n    console.error(e);\n    return Result.err(\"Error applying instructions\");\n  }\n};\n\nexport const applyAll = (\n  instructions: Instruction[],\n  gameData: GameData.GameData\n): Result.Result<GameData.GameData> =>\n  instructions.reduce(\n    (applied: Result.Result<GameData.GameData>, i) =>\n      Result.isOk(applied) ? apply(i, applied.data) : applied,\n    Result.ok(gameData)\n  );\n","// import * as GameData from \"./game/gameData\";\nimport { Instruction } from \".\";\nimport { SagaIterator } from \"redux-saga\";\n\nexport enum Phenomena {\n  FORGETTING,\n  KNOW_DOOR_LOCATION = \"KNOW_DOOR_LOCATION\"\n}\n\ntype Duration = \"FOREVER\" | number;\n\nexport interface Phenomenon {\n  name: Phenomena;\n  fn: (\n    gameData: any\n  ) => Instruction.Instruction[] | SagaIterator<Instruction.Instruction[]>;\n  duration: Duration;\n}\n","export interface Err {\n  type: \"Error\";\n  msg: string;\n}\n\nexport interface Ok<T> {\n  type: \"Ok\";\n  data: T;\n}\n\nexport type Result<T> = Ok<T> | Err;\n\nexport const ok = <T>(data: T): Ok<T> => ({ type: \"Ok\", data });\n\nexport const err = (msg: string): Err => ({ type: \"Error\", msg });\n\nexport const isErr = <T>(r: Result<T>): r is Err => r.type === \"Error\";\n\nexport const isOk = <T>(r: Result<T>): r is Ok<T> => r.type === \"Ok\";\n\nexport const map = <T, R>(f: (t: T) => R, r: Result<T>): Result<R> =>\n  isOk(r) ? ok(f(r.data)) : r;\n","export type Maybe<T> = T | undefined | null;\n\nexport const of = <T>(value: T | undefined | null): Maybe<T> => value;\nexport const none = <T>(): Maybe<T> => undefined;\n\ntype Supplier<T> = () => T;\n\nexport const withDefault = <T>(maybe: Maybe<T>, default_: T | Supplier<T>): T =>\n  maybe != null\n    ? maybe\n    : typeof default_ === \"function\"\n    ? (default_ as Supplier<T>)()\n    : default_;\n\nexport const map = <T, R>(f: (t: T) => R, maybe: Maybe<T>): Maybe<R> =>\n  maybe != null ? f(maybe) : undefined;\n\nexport const ifPresent = <T>(f: (t: T) => void, maybe: Maybe<T>): void => {\n  if (maybe) {\n    f(maybe);\n  }\n};\n","import { Instruction, Phenomenon } from \".\";\n\nexport interface Outcome {\n  instructions: Instruction.Instruction[];\n  phenomena: Phenomenon.Phenomenon[];\n}\n\nexport const create = (\n  instructions: Instruction.Instruction[] = [],\n  phenomena: Phenomenon.Phenomenon[] = []\n) => ({\n  instructions,\n  phenomena\n});\n\nexport const instructions = (outcomes: Outcome[]): Instruction.Instruction[] =>\n  outcomes.reduce(\n    (i: Instruction.Instruction[], o) => [...i, ...o.instructions],\n    []\n  );\n\nexport const phenomena = (outcomes: Outcome[]): Phenomenon.Phenomenon[] =>\n  outcomes.reduce(\n    (p: Phenomenon.Phenomenon[], o) => [...p, ...o.phenomena],\n    []\n  );\n","import { MazeData, Maze, Step, ID, Direction, Message } from \"./types\";\nimport { Entity } from \"./types/entities\";\nimport { GameData } from \"./types/game\";\n\nexport enum ActionTypes {\n  REQUEST_NEW_GAME = \"REQUEST_NEW_GAME\",\n  START_NEW_GAME = \"START_NEW_GAME\",\n\n  REQUEST_STEP = \"REQUEST_STEP\",\n  PROCESS_STEP = \"PROCESS_STEP\",\n  COMPLETE_STEP = \"COMPLETE_STEP\",\n  ABORT_STEP = \"ABORT_STEP\",\n\n  MOVE_PLAYER = \"MOVE_PLAYER\",\n\n  ADD_MESSAGE = \"ADD_MESSAGE\"\n}\n\ninterface NewGameOptions {\n  mazeOptions?: MazeData.Options;\n}\nexport interface RequestNewGame {\n  type: ActionTypes.REQUEST_NEW_GAME;\n  options: NewGameOptions;\n}\n\nexport interface StartNewGame {\n  type: ActionTypes.START_NEW_GAME;\n  maze: Maze.Maze;\n  entities: Entity.Entity[];\n}\n\nexport interface RequestStep {\n  type: ActionTypes.REQUEST_STEP;\n  step: Step.Step;\n}\n\nexport interface AbortStep {\n  type: ActionTypes.ABORT_STEP;\n  stepId: ID.ID;\n}\n\nexport interface ProcessStep {\n  type: ActionTypes.PROCESS_STEP;\n  stepId: ID.ID;\n  gameData: GameData.GameData;\n}\n\nexport interface CompleteStep {\n  type: ActionTypes.COMPLETE_STEP;\n  stepId: ID.ID;\n}\n\nexport interface MovePlayer {\n  type: ActionTypes.MOVE_PLAYER;\n  direction?: Direction.Direction;\n}\n\nexport interface AddMessage {\n  type: ActionTypes.ADD_MESSAGE;\n  message: Message.Message;\n}\n\nexport type AppAction =\n  | RequestNewGame\n  | StartNewGame\n  | RequestStep\n  | AbortStep\n  | CompleteStep\n  | ProcessStep\n  | MovePlayer\n  | AddMessage;\n\nexport const requestNewGame = (\n  options: NewGameOptions = {}\n): RequestNewGame => ({ type: ActionTypes.REQUEST_NEW_GAME, options });\n\nexport const startNewGame = (\n  maze: Maze.Maze,\n  entities: Entity.Entity[]\n): StartNewGame => ({\n  type: ActionTypes.START_NEW_GAME,\n  maze,\n  entities\n});\n\nexport const requestStep = (step: Step.Step): RequestStep => ({\n  type: ActionTypes.REQUEST_STEP,\n  step\n});\n\nexport const abortStep = (stepId: ID.ID): AbortStep => ({\n  type: ActionTypes.ABORT_STEP,\n  stepId\n});\n\nexport const processStep = (\n  stepId: ID.ID,\n  gameData: GameData.GameData\n): ProcessStep => ({\n  type: ActionTypes.PROCESS_STEP,\n  stepId,\n  gameData\n});\n\nexport const completeStep = (stepId: ID.ID): CompleteStep => ({\n  type: ActionTypes.COMPLETE_STEP,\n  stepId\n});\n\nexport const movePlayer = (direction?: Direction.Direction): MovePlayer => ({\n  type: ActionTypes.MOVE_PLAYER,\n  direction\n});\n\nexport const addMessage = (message: Message.Message): AddMessage => ({\n  type: ActionTypes.ADD_MESSAGE,\n  message\n});\n","export interface Message {\n  message: string;\n  speaker?: string;\n}\n\nexport const create = (message: string, speaker?: string): Message => ({\n  message,\n  speaker\n});\n","import { Maybe } from \".\";\n\nexport type Queue<T> = Record<number, T[]>;\n\nexport const create = <T>(): Queue<T> => ({});\n\nexport const queue = <T>(\n  queue: Queue<T>,\n  item: T,\n  priority: number\n): Queue<T> => ({\n  ...queue,\n  [priority]: queue[priority] ? [...queue[priority], item] : [item]\n});\n\ninterface DequeueResult<T> {\n  queue: Queue<T>;\n  item: Maybe.Maybe<T>;\n}\n\ntype Prioritizer = (...priorities: number[]) => number;\ntype Equals<T> = (a: T, b: T) => boolean;\n\nexport const highestPrioritity = (\n  queue: Queue<any>,\n  prioritizer: Prioritizer\n): Maybe.Maybe<number> => {\n  const priorities = Object.keys(queue)\n    .map(k => (k as any) as number)\n    .filter(k => queue[k] != null && queue[k].length > 0);\n  const highest = prioritizer(...priorities);\n  if (highest === Infinity) {\n    console.log({\n      msg: \"wtf\",\n      priorities,\n      highest,\n      keys: Object.keys(queue),\n      queue\n    });\n  } else {\n    return highest;\n  }\n};\n\nexport const dequeue = <T>(\n  queue: Queue<T>,\n  prioritize: Prioritizer = Math.max,\n  equals: Equals<T> = (a, b) => a === b\n): DequeueResult<T> => {\n  const removeFrom = highestPrioritity(queue, prioritize);\n  if (removeFrom) {\n    const removed = queue[removeFrom][0];\n    const updated = queue[removeFrom].filter(i => !equals(removed, i));\n    return {\n      queue: {\n        ...queue,\n        [removeFrom]: updated\n      },\n      item: Maybe.of(removed)\n    };\n  } else {\n    return { queue, item: Maybe.none() };\n  }\n};\n","import { State } from \"./state\";\nimport { createSelector } from \"reselect\";\nimport { Loadable, Maybe } from \"./types\";\nimport { GameData } from \"./types/game\";\nimport { Camera } from \"./util\";\n\nexport const getState = (state: State): State => state;\n\nexport const getGame = createSelector(getState, state => state.game);\n\nexport const getDisplayGrid = createSelector(getGame, game =>\n  Loadable.map(GameData.displayGrid, game)\n);\n\nexport const getIsProcessingStep = createSelector(\n  getState,\n  state => state.stepId != null\n);\n\nexport const getPlayer = createSelector(getGame, game =>\n  Loadable.isLoaded(game)\n    ? Maybe.map(\n        id => game.data.entityData.entityMap[id],\n        game.data.entityData.playerEntityId\n      )\n    : undefined\n);\n\nexport const getWindowedDisplayGrid = createSelector(\n  getDisplayGrid,\n  getPlayer,\n  (displayGrid, player) =>\n    Loadable.map(\n      grid =>\n        player != null ? Camera.centerOnPoint(grid, player.position, 3) : [],\n      displayGrid\n    )\n);\n\nexport const getMessages = createSelector(\n  getState,\n  state => state.chat.messages\n);\n","import React from \"react\";\nimport { Entity as EntityT } from \"../types/entities\";\nimport styles from \"./Entity.css\";\n\nconst getDisplayLetter = (e: EntityT.Entity): string => {\n  switch (e.type) {\n    case \"player\":\n      return e.name[0].toUpperCase();\n    case \"sinister-dolls\":\n      return \"D\";\n    case \"wandering-husk\":\n      return \"H\";\n    case \"blind-guardian\":\n      return \"G\";\n    case \"orb-of-knowing\":\n      return \"O\";\n    case \"exit\":\n      return \"E\";\n    default:\n      return \"S \";\n  }\n};\n\nconst getColor = (e: EntityT.Entity): string => {\n  if (e.type === \"player\") {\n    return \"black\";\n  } else if (e.type === \"exit\" || e.type === \"orb-of-knowing\") {\n    return \"blue\";\n  } else {\n    return \"red\";\n  }\n};\n\nexport const Entity = (entity: EntityT.Entity): JSX.Element => (\n  <div className={styles.root} style={{ color: getColor(entity) }}>\n    {getDisplayLetter(entity)}\n  </div>\n);\n","import React from \"react\";\nimport { Cell as CellT, Maybe } from \"../types\";\nimport styles from \"./Cell.css\";\nimport classNames from \"classnames\";\nimport { CellMeta } from \"../types/game/gameData\";\nimport { Entity as EntityT } from \"../types/entities\";\nimport { Entity } from \"./Entity\";\n\ninterface Props {\n  cell: CellT.Cell;\n  meta: CellMeta;\n}\n\nconst IS_WALL = \"0.5px solid #444444\";\nconst IS_OPEN = \"0.5px solid transparent\";\nconst drawSide = (wall: boolean) => (wall ? IS_WALL : IS_OPEN);\n\nconst getEntityToDraw = ({\n  visible,\n  seen,\n  occupants\n}: CellMeta): Maybe.Maybe<EntityT.Entity> => {\n  if (visible) {\n    return Maybe.withDefault(\n      occupants.find(e => e.type !== \"player\" && e.type !== \"exit\"),\n      occupants[0]\n    );\n  } else if (seen) {\n    return occupants.find(e => e.type === \"exit\");\n  }\n};\n\nexport const Cell = ({ cell, meta }: Props): JSX.Element => {\n  const { walls } = cell;\n  return (\n    <div\n      className={classNames(styles.root, {\n        [styles.seen]: meta.seen,\n        [styles.visible]: meta.visible,\n        [styles.unknown]: !meta.seen && !meta.visible\n      })}\n      style={\n        !meta.unknown\n          ? {\n              borderTop: drawSide(walls.n),\n              borderRight: drawSide(walls.e),\n              borderBottom: drawSide(walls.s),\n              borderLeft: drawSide(walls.w)\n            }\n          : undefined\n      }\n    >\n      {Maybe.map(\n        o => (\n          <Entity {...o} />\n        ),\n        getEntityToDraw(meta)\n      )}\n    </div>\n  );\n};\n\nexport const EmptyCell = () => (\n  <div className={classNames(styles.empty, styles.root)}></div>\n);\n","import React from \"react\";\nimport { Cell, EmptyCell } from \"./Cell\";\nimport styles from \"./Grid.css\";\nimport { Camera } from \"../util\";\nimport { Maybe } from \"../types\";\nimport classNames from \"classnames\";\n\ninterface Props {\n  grid: Camera.WindowedGrid;\n  largeScreen: boolean;\n}\n\nexport const Grid = ({ grid, largeScreen }: Props): JSX.Element => {\n  return (\n    <div\n      className={classNames(styles.root, {\n        [styles.large]: largeScreen\n      })}\n    >\n      {grid.map((row, idx) => (\n        <div key={idx} className={styles.row}>\n          {row.map((maybeCell, idx) =>\n            Maybe.withDefault(\n              Maybe.map(\n                cell => <Cell key={idx} cell={cell.cell} meta={cell.meta} />,\n                maybeCell\n              ),\n              <EmptyCell key={idx} />\n            )\n          )}\n        </div>\n      ))}\n    </div>\n  );\n};\n","import React from \"react\";\nimport { Effect, Direction } from \"../types\";\nimport styles from \"./GamePad.css\";\nimport classNames from \"classnames\";\n\ninterface DispatchProps {\n  onMove: Effect.Effect1<Direction.Direction | undefined>;\n}\n\ntype Props = DispatchProps;\n\nexport const GamePad = ({ onMove }: Props): JSX.Element => (\n  <div className={styles.root}>\n    <div className={styles.row}>\n      <div className={styles.block}></div>\n      <div className={styles.block}>\n        <button\n          className={styles.button}\n          onClick={() => onMove(Direction.Direction.NORTH)}\n        ></button>\n      </div>\n      <div className={styles.block}></div>\n    </div>\n    <div className={styles.row}>\n      <div className={styles.block}>\n        <button\n          className={styles.button}\n          onClick={() => onMove(Direction.Direction.WEST)}\n        />\n      </div>\n      <div className={styles.block}>\n        <button\n          className={classNames(styles.button, styles.wait)}\n          onClick={() => onMove(undefined)}\n        />\n      </div>\n      <div className={styles.block}>\n        <button\n          className={styles.button}\n          onClick={() => onMove(Direction.Direction.EAST)}\n        ></button>\n      </div>\n    </div>\n    <div className={styles.row}>\n      <div className={styles.block}></div>\n      <div className={styles.block}>\n        <button\n          className={styles.button}\n          onClick={() => onMove(Direction.Direction.SOUTH)}\n        ></button>\n      </div>\n      <div className={styles.block}></div>\n    </div>\n  </div>\n);\n","import * as React from \"react\";\nimport { Effect, Direction } from \"../types\";\n\ninterface Props {\n  onMove: Effect.Effect1<Direction.Direction | undefined>;\n  disabled: boolean;\n}\n\nexport class KeyPad extends React.PureComponent<Props> {\n  componentDidMount() {\n    window.addEventListener(\"keydown\", this.handleKeyDown);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"keydown\", this.handleKeyDown);\n  }\n\n  render() {\n    return <></>;\n  }\n\n  private handleKeyDown = (event: KeyboardEvent) => {\n    if (!this.props.disabled) {\n      if (event.key === \"ArrowUp\" || event.key === \"w\") {\n        this.props.onMove(Direction.Direction.NORTH);\n      } else if (event.key === \"ArrowRight\" || event.key === \"d\") {\n        this.props.onMove(Direction.Direction.EAST);\n      } else if (event.key === \"ArrowDown\" || event.key === \"d\") {\n        this.props.onMove(Direction.Direction.SOUTH);\n      } else if (event.key === \"ArrowLeft\" || event.key === \"a\") {\n        this.props.onMove(Direction.Direction.WEST);\n      } else if (event.key === \" \" || event.key === \"Enter\") {\n        this.props.onMove(undefined);\n      }\n    }\n  };\n}\n","import React from \"react\";\nimport styles from \"./Chat.css\";\nimport { Message } from \"../types\";\n\ninterface Props {\n  messages: Message.Message[];\n}\n\nexport const Chat = ({ messages }: Props): JSX.Element => (\n  <div className={styles.root}>\n    {messages.map((m, i) => (\n      <div key={i}>{m.message}</div>\n    ))}\n  </div>\n);\n","import * as React from \"react\";\nimport { Grid } from \"./Grid\";\nimport { GamePad } from \"./GamePad\";\nimport { Effect, Direction, Message } from \"../types\";\nimport { KeyPad } from \"./KeyPad\";\nimport { Camera } from \"../util\";\nimport MediaQuery from \"react-responsive\";\nimport { Chat } from \"./Chat\";\n\ninterface Props {\n  grid: Camera.WindowedGrid;\n  onMove: Effect.Effect1<Direction.Direction | undefined>;\n  processingUpdates: boolean;\n  messages: Message.Message[];\n}\n\nexport const Game = ({\n  grid,\n  onMove,\n  processingUpdates,\n  messages\n}: Props): JSX.Element => (\n  <MediaQuery minWidth={1024}>\n    {largeScreen => (\n      <>\n        <Chat messages={messages} />\n        <Grid grid={grid} largeScreen={largeScreen} />\n        {!largeScreen && <GamePad onMove={onMove} />}\n        <KeyPad onMove={onMove} disabled={processingUpdates} />\n      </>\n    )}\n  </MediaQuery>\n);\n","import React from \"react\";\nimport { GameData, EntityData } from \"../types/game\";\nimport { LocalStorage, Uri } from \"../util\";\nimport { State } from \"../state\";\nimport { getGame } from \"../selectors\";\nimport { Loadable, Maybe } from \"../types\";\nimport { connect } from \"react-redux\";\n\nconst DEV =\n  LocalStorage.getSiteSetting(\"devmode\", () => {\n    const queryParam = Uri.parseQuery()[\"devmode\"];\n    return !!queryParam && queryParam !== \"false\" ? \"true\" : undefined;\n  }) === \"true\";\n\nlet VERSION: Maybe.Maybe<string>;\n\nfetch(\n  `${window.location.href.substring(\n    0,\n    window.location.href.indexOf(\"?\")\n  )}/VERSION`\n).then(d => d.text().then(version => (VERSION = version)));\n\ninterface Props {\n  gameData: Loadable.Loadable<GameData.GameData>;\n}\n\nconst getEntityCountData = (entityData: EntityData.EntityData): string =>\n  \"\\n\\t\" +\n  Object.keys(entityData.typeMap)\n    .map(type_ => `${type_}: ${entityData.typeMap[type_].length}`)\n    .join(\"\\n\\t\");\n\nconst gameInfo = (gameData: GameData.GameData): string =>\n  [\n    `maze algorithm:: ${gameData.maze.algorithm}`,\n    `maze dimensions:: ${gameData.maze.dimension.width} x ${gameData.maze.dimension.height}`,\n    `entityCount:: ${getEntityCountData(gameData.entityData)}`,\n    `step:: ${gameData.stepCount}`,\n    `version:: ${VERSION}`\n  ].join(\"\\n\");\n\nexport const InfoButton = ({ gameData }: Props): JSX.Element =>\n  DEV && Loadable.isLoaded(gameData) ? (\n    <button\n      onFocus={e => e.preventDefault()}\n      style={{ position: \"absolute\", top: 5, left: 5 }}\n      onClick={() => {\n        window.alert(gameInfo(gameData.data));\n        Maybe.ifPresent(\n          (el: HTMLElement) => el.blur(),\n          document.activeElement as HTMLElement\n        );\n      }}\n    >\n      ?\n    </button>\n  ) : (\n    <></>\n  );\n\nconst mapStateToProps = (state: State): Props => ({\n  gameData: getGame(state)\n});\n\nexport default connect(mapStateToProps)(InfoButton);\n","import React, { Dispatch } from \"react\";\nimport styles from \"./App.css\";\nimport { connect } from \"react-redux\";\nimport { State } from \"../state\";\nimport { Loadable, Effect, Direction, Message } from \"../types\";\nimport {\n  getIsProcessingStep,\n  getWindowedDisplayGrid,\n  getMessages\n} from \"../selectors\";\nimport { Game } from \"./Game\";\nimport { AppAction, movePlayer } from \"../actions\";\nimport { WindowedGrid } from \"../util/camera\";\nimport InfoButton from \"./InfoButton\";\n\ninterface StateProps {\n  grid: Loadable.Loadable<WindowedGrid>;\n  processingUpdates: boolean;\n  messages: Message.Message[];\n}\n\ninterface DispatchProps {\n  onMove: Effect.Effect1<Direction.Direction | undefined>;\n}\n\ntype Props = StateProps & DispatchProps;\n\nconst App = ({ grid, processingUpdates, messages, onMove }: Props) => {\n  return (\n    <div className={styles.root}>\n      {Loadable.isLoading(grid) && <span>Loading . . . </span>}\n      {Loadable.isLoaded(grid) && grid.data && (\n        <>\n          <InfoButton />\n          <Game\n            processingUpdates={processingUpdates}\n            grid={grid.data}\n            onMove={onMove}\n            messages={messages}\n          />\n        </>\n      )}\n    </div>\n  );\n};\n\nexport const mapStateToProps = (state: State): StateProps => ({\n  grid: getWindowedDisplayGrid(state),\n  processingUpdates: getIsProcessingStep(state),\n  messages: getMessages(state)\n});\n\nexport const mapDispatchToProps = (\n  dispatch: Dispatch<AppAction>\n): DispatchProps => ({\n  onMove: d => dispatch(movePlayer(d))\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);\n","import { Maze, ID, Message } from \"./types\";\nimport { Loadable } from \"./types\";\nimport { GameData, EntityData } from \"./types/game\";\nimport { Entity } from \"./types/entities\";\n\nexport interface State {\n  game: Loadable.Loadable<GameData.GameData>;\n  chat: Chat;\n  stepId?: ID.ID;\n}\n\ninterface Chat {\n  messages: Message.Message[];\n  roundsSince: number;\n}\n\nexport const create = (init = {}): State => ({\n  game: Loadable.loading(),\n  chat: { messages: [], roundsSince: 0 },\n  ...init\n});\n\nexport const requestingNewGame = (state: State): State => ({\n  ...state,\n  game: Loadable.loading()\n});\n\nexport const newGame = (\n  state: State,\n  maze: Maze.Maze,\n  entities: Entity.Entity[]\n): State => ({\n  ...state,\n  game: Loadable.loaded(\n    GameData.create(maze, EntityData.fromEntities(entities, maze.dimension))\n  )\n});\n\nexport const ifGameIsLoaded = (f: () => State, state: State): State =>\n  Loadable.isLoaded(state.game) ? f() : state;\n\nexport const requestStep = (state: State, stepId: ID.ID): State => ({\n  ...state,\n  stepId\n});\n\nexport const processStep = (\n  state: State,\n  stepId: ID.ID,\n  gameData: GameData.GameData\n): State =>\n  ifGameIsLoaded(\n    () =>\n      state.stepId === stepId\n        ? {\n            ...state,\n            game: Loadable.loaded(gameData)\n          }\n        : state,\n    state\n  );\n\nexport const completeStep = (state: State, stepId: ID.ID): State =>\n  ifGameIsLoaded(\n    () =>\n      state.stepId === stepId\n        ? {\n            ...state,\n            stepId: undefined,\n            game: Loadable.map(\n              g => ({ ...g, stepCount: g.stepCount + 1 }),\n              state.game\n            ),\n            chat: {\n              ...state.chat,\n              messages: [Message.create(\"\"), ...state.chat.messages].slice(\n                0,\n                5\n              ),\n              roundsSince: state.chat.roundsSince += 1\n            }\n          }\n        : state,\n    state\n  );\n\nexport const abortStep = (state: State, stepId: ID.ID): State =>\n  state.stepId === stepId ? { ...state, stepId: undefined } : state;\n\nexport const addMessage = (state: State, message: Message.Message): State => ({\n  ...state,\n  chat: {\n    messages: [message, ...state.chat.messages].slice(0, 5),\n    roundsSince: 0\n  }\n});\n","import * as State from \"./state\";\nimport { AppAction, ActionTypes } from \"./actions\";\n\nexport const reducer = (\n  state: State.State = State.create(),\n  action: AppAction\n): State.State => {\n  switch (action.type) {\n    case ActionTypes.REQUEST_STEP:\n      return State.requestStep(state, action.step.id);\n    case ActionTypes.COMPLETE_STEP:\n      return State.completeStep(state, action.stepId);\n    case ActionTypes.ABORT_STEP:\n      return State.abortStep(state, action.stepId);\n    case ActionTypes.PROCESS_STEP:\n      return State.processStep(state, action.stepId, action.gameData);\n    case ActionTypes.START_NEW_GAME:\n      return State.newGame(state, action.maze, action.entities);\n    case ActionTypes.REQUEST_NEW_GAME:\n      return State.requestingNewGame(state);\n    case ActionTypes.ADD_MESSAGE:\n      return State.addMessage(state, action.message);\n    default:\n      return state;\n  }\n};\n","import {\n  RequestStep,\n  abortStep,\n  completeStep,\n  ActionTypes,\n  processStep\n} from \"../actions\";\nimport { Loadable, Instruction, Result, Outcome, Phenomenon } from \"../types\";\nimport { GameData, EntityData, GameState } from \"../types/game\";\nimport { select, put, take, call } from \"redux-saga/effects\";\nimport { getGame } from \"../selectors\";\nimport { Entity } from \"../types/entities\";\n\nexport function* stepEngine() {\n  let activePhenomena: Phenomenon.Phenomenon[] = [];\n  while (true) {\n    try {\n      const { step }: RequestStep = yield take(ActionTypes.REQUEST_STEP);\n\n      const game: Loadable.Loadable<GameData.GameData> = yield select(getGame);\n\n      if (Loadable.isLoaded(game)) {\n        const { data: gameData } = game;\n\n        const stepValidation: Result.Result<void> = yield call(\n          Instruction.validateAll,\n          step.instructions,\n          gameData\n        );\n\n        if (Result.isErr(stepValidation)) {\n          yield put(abortStep(step.id));\n          continue;\n        }\n\n        const aiInstructions = GameData.generateAllAIInstructions(gameData);\n        const instructions = [...aiInstructions, ...step.instructions];\n\n        const afterMovement: Result.Result<GameData.GameData> = yield call(\n          Instruction.applyAll,\n          instructions,\n          gameData\n        );\n\n        if (Result.isErr(afterMovement)) {\n          yield put(abortStep(step.id));\n          continue;\n        }\n\n        const collisionOutcomes: Outcome.Outcome[] = yield call(\n          processCollisions,\n          gameData,\n          afterMovement.data\n        );\n\n        const afterCollisions: Result.Result<GameData.GameData> = yield call(\n          Instruction.applyAll,\n          collisionOutcomes.reduce(\n            (i: Instruction.Instruction[], o) => [...i, ...o.instructions],\n            []\n          ),\n          afterMovement.data\n        );\n\n        if (Result.isErr(afterCollisions)) {\n          yield put(abortStep(step.id));\n          continue;\n        }\n\n        activePhenomena = activePhenomena.concat(\n          Outcome.phenomena(collisionOutcomes)\n        );\n\n        const phenomenalInstructions = yield call(\n          applyPhenomena,\n          activePhenomena,\n          gameData\n        );\n\n        const afterPhenomena: Result.Result<GameData.GameData> = yield call(\n          Instruction.applyAll,\n          phenomenalInstructions,\n          afterCollisions.data\n        );\n\n        if (Result.isErr(afterPhenomena)) {\n          yield put(abortStep(step.id));\n          continue;\n        }\n        activePhenomena = yield call(prunePhenomena, activePhenomena);\n\n        yield put(processStep(step.id, afterPhenomena.data));\n        yield call(checkGameState, afterPhenomena.data);\n        yield put(completeStep(step.id));\n      }\n    } catch (e) {\n      console.warn(\"Error processing step\");\n      console.error(e);\n    }\n  }\n}\n\nexport const processCollisions = (\n  last: GameData.GameData,\n  next: GameData.GameData\n) => {\n  const player = EntityData.getPlayer(next.entityData)!;\n  const collisions = EntityData.entitiesAtPoint(\n    next.entityData,\n    player.position,\n    next.maze.dimension\n  )\n    .filter(e => e.id !== player.id)\n    .concat(\n      EntityData.neighborsCrossedByEntity(\n        last.entityData,\n        next.entityData,\n        player.id,\n        next.maze.dimension\n      )\n    );\n\n  return collisions.map(e => Entity.onCollideWithPlayer(e, next));\n};\n\nexport function* applyPhenomena(\n  activePhenomena: Phenomenon.Phenomenon[],\n  gameData: GameData.GameData\n) {\n  let instructions: Instruction.Instruction[] = [];\n  for (const p of activePhenomena) {\n    const generatedInstructions = yield call(p.fn, gameData);\n    instructions = instructions.concat(generatedInstructions);\n  }\n  return instructions;\n}\n\nexport function* checkGameState({ state, entityData }: GameData.GameData) {\n  const player = EntityData.getPlayer(entityData);\n  if (GameState.lost(state)) {\n    yield call(\n      window.confirm,\n      Entity.getKillMessage(\n        EntityData.getPlayer(entityData),\n        EntityData.byId(entityData, state.causeOfDeath.entityId)\n      )\n    );\n    window.location.reload();\n  } else if (GameState.won(state)) {\n    yield call(window.confirm, `${player.name} escaped. . . this time.`);\n    window.location.reload();\n  }\n}\n\nexport const prunePhenomena = (\n  activePhenomena: Phenomenon.Phenomenon[]\n): Phenomenon.Phenomenon[] => {\n  return activePhenomena\n    .map(p => ({\n      ...p,\n      duration: p.duration !== \"FOREVER\" ? p.duration - 1 : p.duration\n    }))\n    .filter(a => a.duration === \"FOREVER\" || a.duration > 0);\n};\n","import { takeEvery, select, put } from \"redux-saga/effects\";\nimport { ActionTypes, MovePlayer, requestStep } from \"../actions\";\nimport { Player } from \"../types/entities\";\nimport { getPlayer, getIsProcessingStep } from \"../selectors\";\nimport { Step, Instruction } from \"../types\";\n\nexport function* movePlayer() {\n  yield takeEvery(ActionTypes.MOVE_PLAYER, function*(action: MovePlayer) {\n    const player = (yield select(getPlayer)) as Player.Player;\n    const isProcessing = (yield select(getIsProcessingStep)) as boolean;\n\n    if (!isProcessing && !!player) {\n      yield put(\n        requestStep(\n          Step.create(\n            action.direction\n              ? Instruction.move(player.id, action.direction)\n              : Instruction.wait(player.id)\n          )\n        )\n      );\n    }\n  });\n}\n","import { BaseEntity, EntityClass } from \"../baseEntity\";\nimport { Phenomenon, Instruction, Point, ID } from \"../..\";\n\nexport interface Item extends BaseEntity {\n  cls: EntityClass.ITEM;\n  phenomena: Phenomenon.Phenomenon;\n  instruction: Instruction.Instruction[];\n}\n\nexport const baseItem = (\n  position: Point.Point\n): Omit<Item, \"type\" | \"phenomena\" | \"instruction\"> => ({\n  id: ID.create(),\n  cls: EntityClass.ITEM,\n  position\n});\n","import * as Point from \"../../point\";\nimport * as Phenomenon from \"../../phenomenon\";\nimport * as Instruction from \"../../instructions\";\nimport * as GameData from \"../../game/gameData\";\nimport * as EntityData from \"../../game/entityData\";\nimport * as Exit from \"../exit\";\nimport { Item, baseItem } from \"./item\";\nimport { ID, Maze } from \"../..\";\nimport { Seeker } from \"..\";\nimport { Arrays } from \"../../../util\";\n\nexport interface OrbOfKnowing extends Item {\n  type: \"orb-of-knowing\";\n}\n\nexport const create = (position: Point.Point): OrbOfKnowing => {\n  const base = baseItem(position);\n  return {\n    ...base,\n    type: \"orb-of-knowing\",\n    phenomena: knowing(base.id),\n    instruction: []\n  };\n};\nexport const knowing = (id: ID.ID): Phenomenon.Phenomenon => ({\n  name: Phenomenon.Phenomena.KNOW_DOOR_LOCATION,\n  duration: 1,\n  fn: (gameData: GameData.GameData): Instruction.Instruction[] => {\n    alert(\n      \"You feel enlightened by the forces of providence.\\n\" +\n        \"For in thine posession is the Orb of Knowing.\"\n    );\n\n    alert(\"Something has entered the maze.\");\n\n    return [\n      ...EntityData.byType(gameData.entityData, \"exit\")\n        .map(e => e as Exit.Exit)\n        .map(exit => Point.toIndex(exit.position, gameData.maze.dimension))\n        .map(p => Instruction.see([p])),\n      Instruction.add(\n        Seeker.create(\n          Point.fromIndex(\n            Arrays.randomItem(gameData.maze.deadends.unused),\n            gameData.maze.dimension\n          )\n        )\n      ),\n      Instruction.remove(id)\n    ];\n  }\n});\n","import {\n  RequestNewGame,\n  ActionTypes,\n  startNewGame,\n  requestNewGame,\n  addMessage\n} from \"../actions\";\nimport { Maze, Dimension, MazeData, Maybe, Message } from \"../types\";\nimport { call, take, put } from \"redux-saga/effects\";\nimport { Api, Numbers, Arrays } from \"../util\";\nimport {\n  Player,\n  BlindGuardian,\n  Entity,\n  Exit,\n  WanderingHusk,\n  SinisterDolls,\n  Seeker\n} from \"../types/entities\";\nimport { OrbOfKnowing } from \"../types/entities/items\";\n\nconst name = Maybe.withDefault(Maybe.of(localStorage.getItem(\"name\")), () => {\n  let n = window.prompt(\"What is your name?\") || \"\";\n  if (n !== \"\") {\n    localStorage.setItem(\"name\", n);\n  }\n  return n !== \"\" ? n : \"?\";\n});\n\nexport function* firstGame() {\n  yield put(\n    requestNewGame({\n      mazeOptions: {\n        dimension: Arrays.randomItem([\n          // Dimension.create(10, 10),\n          // Dimension.create(15, 15),\n          // Dimension.create(15, 15),\n          // Dimension.create(15, 15),\n          // Dimension.create(15, 15),\n          // Dimension.create(20, 20),\n          // Dimension.create(25, 10),\n          // Dimension.create(10, 25),\n          // Dimension.create(20, 15),\n          // Dimension.create(15, 20),\n          // Dimension.create(30, 5),\n          // Dimension.create(5, 30)\n          Dimension.create(5, 5)\n        ]),\n        algorithm: Arrays.randomItem([\n          \"aldous-broder\",\n          \"aldous-broder\",\n          \"aldous-broder\",\n          \"binary-tree\",\n          \"side-winder\"\n        ]),\n        ...MazeData.randomDirectionalOptions()\n      }\n    })\n  );\n}\n\nexport function* newGame() {\n  while (true) {\n    try {\n      const { options }: RequestNewGame = yield take(\n        ActionTypes.REQUEST_NEW_GAME\n      );\n      const data: MazeData.MazeData = yield call(\n        Api.maze,\n        options.mazeOptions || {}\n      );\n      const fromData: Maze.Maze = Maze.fromMazeData(data);\n      const [maze, entities] = startingEntities(fromData);\n      yield put(startNewGame(maze, entities));\n      yield put(addMessage(Message.create(\"The game is afoot.\")));\n    } catch (e) {\n      console.warn(\"Error initializing new game\");\n      console.error(e);\n    }\n  }\n}\n\nexport const startingEntities = (\n  prePlacement: Maze.Maze\n): [Maze.Maze, Entity.Entity[]] => {\n  const { dimension } = prePlacement;\n\n  const player = Player.create(name, Dimension.pointAlongEdge(dimension));\n  // const guardians = new Array(Numbers.randomInRange(1, 5))\n  //   .fill(undefined)\n  //   .map(_ => BlindGuardian.create(Dimension.randomPoint(dimension)));\n  // const husks = new Array(Arrays.randomItem([1, 1, 2, 2, 3]))\n  //   .fill(undefined)\n  //   .map(_ => WanderingHusk.create(Dimension.randomPoint(dimension)));\n\n  // const enemies = [...guardians, ...husks];\n  const enemies: Entity.Entity[] = [];\n  const { placed, maze, unplaced } = Maze.placeEntitiesInDeadEnds(\n    prePlacement,\n    [Exit.create, OrbOfKnowing.create]\n  );\n\n  if (unplaced.length > 0) {\n    console.log(\n      `Ran out of deadends to place these entities ${unplaced\n        .map(u => u.type)\n        .join(\", \")}`\n    );\n  }\n\n  const entities = [player, ...enemies, ...placed];\n\n  return [maze, entities];\n};\n","import { spawn, all } from \"redux-saga/effects\";\nimport { stepEngine } from \"./sagas/stepEngine\";\nimport { movePlayer } from \"./sagas/movePlayer\";\nimport { newGame, firstGame } from \"./sagas/newGame\";\n\nconst sagas = [firstGame, newGame, stepEngine, movePlayer];\n\nexport function* root() {\n  yield all(sagas.map(s => spawn(s)));\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport styles from \"./index.css\";\nimport App from \"./app/views/App\";\nimport { Provider } from \"react-redux\";\nimport { configureStore } from \"./app/store\";\n\nReactDOM.render(\n  <Provider store={configureStore()}>\n    <div className={styles.app}>\n      <App />\n    </div>\n  </Provider>,\n  document.getElementById(\"root\")\n);\n","import { createStore, applyMiddleware, Store } from \"redux\";\nimport { reducer } from \"./reducer\";\nimport createSagaMiddleware from \"redux-saga\";\nimport * as Saga from \"./saga\";\nimport { State } from \"./state\";\nimport { AppAction } from \"./actions\";\n\nexport const configureStore = (): Store<State, AppAction> => {\n  const sagaMiddleware = createSagaMiddleware();\n  const store = createStore(reducer, applyMiddleware(sagaMiddleware));\n\n  sagaMiddleware.run(Saga.root);\n\n  return store;\n};\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"GamePad_root__Lay6t\",\"row\":\"GamePad_row__164Sm\",\"block\":\"GamePad_block__l2_xd\",\"button\":\"GamePad_button__3kDFo\",\"wait\":\"GamePad_wait__5DVYu\"};"],"sourceRoot":""}