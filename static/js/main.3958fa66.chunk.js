(this.webpackJsonpfollowed=this.webpackJsonpfollowed||[]).push([[0],{23:function(t,n,e){t.exports={root:"Grid_root__xSU_B",row:"Grid_row__1rWaL"}},27:function(t,n){},28:function(t,n){},29:function(t,n,e){t.exports={app:"index_app__2lpzC"}},30:function(t,n,e){t.exports={root:"App_root__ZxxJN"}},33:function(t,n,e){t.exports={root:"Cell_root__2ti8K"}},34:function(t,n,e){t.exports={root:"Entity_root__MaGTf"}},36:function(t,n,e){t.exports=e(49)},49:function(t,n,e){"use strict";e.r(n);var r={};e.r(r),e.d(r,"create",(function(){return A}));var a={};e.r(a),e.d(a,"fromApi",(function(){return N}));var o={};e.r(o),e.d(o,"fromMazeData",(function(){return R})),e.d(o,"canWalk",(function(){return D}));var c={};e.r(c),e.d(c,"isLoading",(function(){return I})),e.d(c,"isLoaded",(function(){return L})),e.d(c,"isErrored",(function(){return U})),e.d(c,"loading",(function(){return G})),e.d(c,"loaded",(function(){return W})),e.d(c,"errored",(function(){return z})),e.d(c,"map",(function(){return C}));var i={};e.r(i),e.d(i,"create",(function(){return Q}));var u={};e.r(u),e.d(u,"create",(function(){return V}));var s={};e.r(s),e.d(s,"getColor",(function(){return B}));var d={};e.r(d),e.d(d,"create",(function(){return J})),e.d(d,"toIndex",(function(){return Y})),e.d(d,"fromIndex",(function(){return F})),e.d(d,"neighbor",(function(){return K}));var f={};e.r(f),e.d(f,"create",(function(){return Z}));var l={};e.r(l),e.d(l,"fromEntities",(function(){return tt})),e.d(l,"entitiesAtPoint",(function(){return nt})),e.d(l,"moveEntity",(function(){return et}));var p={};e.r(p),e.d(p,"create",(function(){return rt})),e.d(p,"displayGrid",(function(){return at}));var E={};e.r(E),e.d(E,"create",(function(){return ct})),e.d(E,"validate",(function(){return it})),e.d(E,"apply",(function(){return ut}));var m={};e.r(m),e.d(m,"validate",(function(){return st})),e.d(m,"validateAll",(function(){return dt})),e.d(m,"apply",(function(){return ft})),e.d(m,"applyAll",(function(){return lt})),e.d(m,"Move",(function(){return E}));var v={};e.r(v),e.d(v,"Direction",(function(){return ot}));var b={};e.r(b),e.d(b,"ok",(function(){return Et})),e.d(b,"err",(function(){return mt})),e.d(b,"isErr",(function(){return vt})),e.d(b,"isOk",(function(){return bt})),e.d(b,"map",(function(){return yt}));var y={};e.r(y),e.d(y,"of",(function(){return Ot})),e.d(y,"none",(function(){return _t})),e.d(y,"withDefault",(function(){return Tt})),e.d(y,"map",(function(){return gt})),e.d(y,"ifPresent",(function(){return xt}));var O={};e.r(O),e.d(O,"maze",(function(){return dn}));var _,T=e(1),g=e.n(T),x=e(17),h=e.n(x),w=e(29),k=e.n(w),M=e(30),j=e.n(M),S=e(19),A=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{width:t,height:n}},N=function(t,n){return{bytes:Uint8Array.from(atob(n),(function(t){return t.charCodeAt(0)})),dimension:t}},P=function(t){return{walls:(n={n:!((8&t)>0),s:!((4&t)>0),e:!((2&t)>0),w:!((1&t)>0)},{n:n.n||!1,e:n.e||!1,s:n.s||!1,w:n.w||!1})};var n},R=function(t){for(var n=t.dimension,e=t.bytes,r=[],a=0;a<n.height;a++){for(var o=[],c=0;c<n.width;c++)o.push(P(e[a*n.width+c]));r.push(o)}return{grid:r,dimension:n}},D=function(t,n,e){var r=n.x,a=n.y;return!function(t,n){var e=t.walls;switch(n){case v.Direction.NORTH:return e.n;case v.Direction.EAST:return e.e;case v.Direction.SOUTH:return e.s;case v.Direction.WEST:return e.w}}(t.grid[a][r],e)},I=function(t){return"Loading"===t.state},L=function(t){return"Loaded"===t.state},U=function(t){return"Errored"===t.state},G=function(){return{state:"Loading"}},W=function(t){return{state:"Loaded",data:t}},z=function(t){return{state:"Errored",e:t}},C=function(t,n){return L(n)?W(t(n.data)):n},H=e(32),Q=function(){return Object(H.v4)()},V=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.create();return{id:i.create(),name:t,position:n,type:"player"}},B=(e(27),function(t){switch(t.type){case"player":return"var(--blue)";default:return"var(--red)"}}),J=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{x:t,y:n}},Y=function(t,n){var e=t.x;return t.y*n.width+e},F=function(t,n){var e=n.width;return J(Math.floor(t/e),t%e)},K=function(t,n){switch(n){case"NORTH":return d.create(t.x,t.y-1);case"SOUTH":return d.create(t.x,t.y+1);case"EAST":return d.create(t.x+1,t.y);case"WEST":default:return d.create(t.x-1,t.y)}},Z=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return{instructions:n,id:i.create()}},q=e(8),X=e(13),$=e(14),tt=function(t,n){return{entityMap:t.reduce((function(t,n){return t[n.id]=n,t}),{}),positionMap:t.reduce((function(t,e){var r=d.toIndex(e.position,n);return t[r]=t[r]?[].concat(Object($.a)(t[r]),[e.id]):[e.id],t}),{}),playerEntityId:y.map((function(t){return t.id}),t.find((function(t){return"player"===t.type})))}},nt=function(t,n,e){var r=d.toIndex(n,e);return(t.positionMap[r]||[]).map((function(n){return t.entityMap[n]}))},et=function(t,n,e,r){var a=n.entityMap[t];if(null!=a){var o,c=d.toIndex(a.position,r),i=d.toIndex(e,r),u=Object(q.a)({},a,{position:e});return Object(q.a)({},n,{entityMap:Object(q.a)({},n.entityMap,Object(X.a)({},t,u)),positionMap:Object(q.a)({},n.positionMap,(o={},Object(X.a)(o,c,Object($.a)((n.positionMap[c]||[]).filter((function(n){return n!==t})))),Object(X.a)(o,i,[].concat(Object($.a)(n.positionMap[i]||[]),[t])),o))})}return n},rt=function(t,n){return{maze:t,entityData:n}},at=function(t){var n=t.maze,e=t.entityData;return n.grid.reduce((function(t,r,a){return[].concat(Object($.a)(t),[r.reduce((function(t,r,o){return t.concat({cell:r,occupants:l.entitiesAtPoint(e,d.create(o,a),n.dimension)})}),[])])}),[])};!function(t){t.MOVE="MOVE"}(_||(_={}));var ot,ct=function(t,n){return{type:_.MOVE,entityId:t,payload:{direction:n}}},it=function(t,n){return o.canWalk(n.maze,n.entityData.entityMap[t.entityId].position,t.payload.direction)?b.ok(void 0):b.err("way is blocked")},ut=function(t,n){return Object(q.a)({},n,{entityData:l.moveEntity(t.entityId,n.entityData,d.neighbor(n.entityData.entityMap[t.entityId].position,t.payload.direction),n.maze.dimension)})},st=function(t,n){switch(t.type){case _.MOVE:return E.validate(t,n);default:return b.err("Unkown instruction of type ".concat(t.type))}},dt=function(t,n){return t.reduce((function(t,e){return b.isOk(t)?st(e,n):t}),b.ok(void 0))},ft=function(t,n){try{switch(t.type){case _.MOVE:return b.ok(E.apply(t,n));default:return b.err("Unknown instruction of type ".concat(t.type))}}catch(e){return console.warn("Error applying instruction",t),console.error(e),b.err("Error applying instructions")}},lt=function(t,n){return t.reduce((function(t,n){return b.isOk(t)?ft(n,t.data):t}),b.ok(n))};!function(t){t.NORTH="NORTH",t.SOUTH="SOUTH",t.EAST="EAST",t.WEST="WEST"}(ot||(ot={}));var pt,Et=function(t){return{type:"Ok",data:t}},mt=function(t){return{type:"Error",msg:t}},vt=function(t){return"Error"===t.type},bt=function(t){return"Ok"===t.type},yt=function(t,n){return bt(n)?Et(t(n.data)):n},Ot=(e(28),function(t){return t}),_t=function(){},Tt=function(t,n){return null!=t?t:n},gt=function(t,n){return null!=n?t(n):void 0},xt=function(t,n){n&&t(n)},ht=e(15),wt=function(t){return t},kt=Object(ht.a)(wt,(function(t){return t.game})),Mt=Object(ht.a)(kt,(function(t){return c.map(p.displayGrid,t)})),jt=Object(ht.a)(wt,(function(t){return null!=t.stepId})),St=Object(ht.a)(kt,(function(t){return c.isLoaded(t)?y.map((function(n){return t.data.entityData.entityMap[n]}),t.data.entityData.playerEntityId):void 0})),At=e(33),Nt=e.n(At),Pt=e(34),Rt=e.n(Pt),Dt=function(t){return g.a.createElement("div",{className:Rt.a.root,style:{backgroundColor:s.getColor(t)}},t.name[0])},It=function(t){return t?"0.5px solid black":"0.5px transparent"},Lt=function(t){var n=t.cell,e=t.occupants,r=n.walls;return g.a.createElement("div",{className:Nt.a.root,style:{borderTop:It(r.n),borderRight:It(r.e),borderBottom:It(r.s),borderLeft:It(r.w),height:"1.5rem",width:"1.5rem"}},e.map((function(t,n){return g.a.createElement(Dt,Object.assign({key:n},t))})))},Ut=e(23),Gt=e.n(Ut),Wt=function(t){var n=t.grid;return g.a.createElement("div",{className:Gt.a.root},n.map((function(t,n){return g.a.createElement("div",{key:n,className:Gt.a.row},t.map((function(t,n){return g.a.createElement(Lt,{key:n,cell:t.cell,occupants:t.occupants})})))})))},zt=e(5),Ct=e.n(zt),Ht=e(16),Qt=e.n(Ht),Vt=function(t){var n=t.onMove;return g.a.createElement("div",{className:Ct.a.root},g.a.createElement("div",{className:Ct.a.row},g.a.createElement("div",{className:Ct.a.block}),g.a.createElement("button",{className:Qt()(Ct.a.block,Ct.a.button),onClick:function(){return n(v.Direction.NORTH)}}),g.a.createElement("div",{className:Ct.a.block})),g.a.createElement("div",{className:Ct.a.row},g.a.createElement("button",{className:Qt()(Ct.a.block,Ct.a.button),onClick:function(){return n(v.Direction.WEST)}}),g.a.createElement("div",{className:Ct.a.block}),g.a.createElement("button",{className:Qt()(Ct.a.block,Ct.a.button),onClick:function(){return n(v.Direction.EAST)}})),g.a.createElement("div",{className:Ct.a.row},g.a.createElement("div",{className:Ct.a.block}),g.a.createElement("button",{className:Qt()(Ct.a.block,Ct.a.button),onClick:function(){return n(v.Direction.SOUTH)}}),g.a.createElement("div",{className:Ct.a.block})))},Bt=function(t){var n=t.grid,e=t.onMove;return T.createElement(T.Fragment,null,T.createElement(Wt,{grid:n}),T.createElement(Vt,{onMove:e}))};!function(t){t.REQUEST_NEW_GAME="REQUEST_NEW_GAME",t.START_NEW_GAME="START_NEW_GAME",t.REQUEST_STEP="REQUEST_STEP",t.COMPLETE_STEP="COMPLETE_STEP",t.ABORT_STEP="ABORT_STEP",t.MOVE_PLAYER="MOVE_PLAYER"}(pt||(pt={}));var Jt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:pt.REQUEST_NEW_GAME,options:t}},Yt=function(t){return{type:pt.ABORT_STEP,stepId:t}},Ft=function(t,n){return{type:pt.COMPLETE_STEP,stepId:t,gameData:n}},Kt=Object(S.b)((function(t){return{grid:Mt(t)}}),(function(t){return{onMove:function(n){return t((e=n,{type:pt.MOVE_PLAYER,direction:e}));var e}}}))((function(t){var n=t.grid,e=t.onMove;return g.a.createElement("div",{className:j.a.root},c.isLoading(n)&&g.a.createElement("span",null,"Loading . . . "),c.isLoaded(n)&&g.a.createElement(Bt,{grid:n.data,onMove:e}))})),Zt=e(11),qt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(q.a)({game:c.loading()},t)},Xt=function(t){return Object(q.a)({},t,{game:c.loading()})},$t=function(t,n,e){return Object(q.a)({},t,{game:c.loaded(p.create(n,l.fromEntities(e,n.dimension)))})},tn=function(t,n){return Object(q.a)({},t,{stepId:n})},nn=function(t,n,e){return function(t,n){return c.isLoaded(n.game)?t():n}((function(){return t.stepId===n?Object(q.a)({},t,{stepId:void 0,game:c.loaded(e)}):t}),t)},en=function(t,n){return t.stepId===n?Object(q.a)({},t,{stepId:void 0}):t},rn=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qt(),n=arguments.length>1?arguments[1]:void 0;switch(console.log({state:t,action:n}),n.type){case pt.REQUEST_STEP:return tn(t,n.step.id);case pt.COMPLETE_STEP:return nn(t,n.stepId,n.gameData);case pt.ABORT_STEP:return en(t,n.stepId);case pt.START_NEW_GAME:return $t(t,n.maze,n.entities);case pt.REQUEST_NEW_GAME:return Xt(t);default:return t}},an=e(35),on=e(7),cn=e.n(on),un=e(4),sn="https://fv9o21r19a.execute-api.us-east-1.amazonaws.com/dev",dn=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.dimension,e=void 0===n?r.create(10,10):n,o=t.algorithm,c=void 0===o?"aldous-broder":o,i=fetch("".concat(sn),{method:"post",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify({dimensions:e,algorithm:c})});return i.then((function(t){return t.text()})).then((function(t){return a.fromApi(e,t)}))},fn=cn.a.mark(ln);function ln(){var t,n,e,r,a,o;return cn.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=1,i.next=4,Object(un.f)(pt.REQUEST_STEP);case 4:return t=i.sent,n=t.step,i.next=8,Object(un.d)(kt);case 8:if(e=i.sent,!c.isLoaded(e)){i.next=28;break}return r=e.data,i.next=13,Object(un.b)(m.validateAll,n.instructions,r);case 13:if(a=i.sent,!b.isErr(a)){i.next=19;break}return console.log(a),i.next=18,Object(un.c)(Yt(n.id));case 18:return i.abrupt("continue",0);case 19:return i.next=21,Object(un.b)(m.applyAll,n.instructions,r);case 21:if(o=i.sent,!b.isErr(o)){i.next=26;break}return i.next=25,Object(un.c)(Yt(n.id));case 25:return i.abrupt("continue",0);case 26:return i.next=28,Object(un.c)(Ft(n.id,o.data));case 28:i.next=34;break;case 30:i.prev=30,i.t0=i.catch(1),console.warn("Error processing step"),console.error(i.t0);case 34:i.next=0;break;case 36:case"end":return i.stop()}}),fn,null,[[1,30]])}var pn=cn.a.mark(En);function En(){return cn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(un.g)(pt.MOVE_PLAYER,cn.a.mark((function t(n){var e;return cn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(un.d)(St);case 2:return e=t.sent,t.next=5,Object(un.d)(jt);case 5:if(t.sent||!e){t.next=9;break}return t.next=9,Object(un.c)((r=f.create(m.Move.create(e.id,n.direction)),{type:pt.REQUEST_STEP,step:r}));case 9:case"end":return t.stop()}var r}),t)})));case 2:case"end":return t.stop()}}),pn)}var mn=cn.a.mark(bn),vn=cn.a.mark(On);function bn(){var t,n,e;return cn.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=1,r.next=4,Object(un.f)(pt.REQUEST_NEW_GAME);case 4:return t=r.sent,n=t.options,r.next=8,Object(un.b)(O.maze,n.mazeOptions||{});case 8:return e=r.sent,r.next=11,Object(un.c)((a=o.fromMazeData(e),c=[u.create("Test")],{type:pt.START_NEW_GAME,maze:a,entities:c}));case 11:r.next=17;break;case 13:r.prev=13,r.t0=r.catch(1),console.warn("Error initializing new game"),console.error(r.t0);case 17:r.next=0;break;case 19:case"end":return r.stop()}var a,c}),mn,null,[[1,13]])}var yn=[bn,ln,En];function On(){return cn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(un.a)(yn.map((function(t){return Object(un.e)(t)})));case 2:return t.next=4,Object(un.c)(Jt({mazeOptions:{dimension:r.create(15,15),algorithm:"aldous-broder"}}));case 4:case"end":return t.stop()}}),vn)}h.a.render(g.a.createElement(S.a,{store:function(){var t=Object(an.a)(),n=Object(Zt.d)(rn,Object(Zt.a)(t));return t.run(On),n}()},g.a.createElement("div",{className:k.a.app},g.a.createElement(Kt,null))),document.getElementById("root"))},5:function(t,n,e){t.exports={root:"GamePad_root__Lay6t",row:"GamePad_row__164Sm",block:"GamePad_block__l2_xd",button:"GamePad_button__3kDFo"}}},[[36,1,2]]]);
//# sourceMappingURL=main.3958fa66.chunk.js.map