(this.webpackJsonpfollowed=this.webpackJsonpfollowed||[]).push([[0],{23:function(t,n,e){t.exports={root:"Grid_root__xSU_B",row:"Grid_row__1rWaL"}},27:function(t,n){},28:function(t,n){},29:function(t,n,e){t.exports={app:"index_app__2lpzC"}},30:function(t,n,e){t.exports={root:"App_root__ZxxJN"}},33:function(t,n,e){t.exports={root:"Cell_root__2ti8K"}},34:function(t,n,e){t.exports={root:"Entity_root__MaGTf"}},41:function(t,n,e){t.exports=e(54)},54:function(t,n,e){"use strict";e.r(n);var r={};e.r(r),e.d(r,"maze",(function(){return P}));var a={};e.r(a),e.d(a,"nOf",(function(){return L})),e.d(a,"sorted",(function(){return W})),e.d(a,"nonNull",(function(){return H})),e.d(a,"randomItem",(function(){return G}));var o={};e.r(o),e.d(o,"randomInRange",(function(){return z}));var i={};e.r(i),e.d(i,"create",(function(){return C})),e.d(i,"area",(function(){return Q})),e.d(i,"randomPoint",(function(){return V})),e.d(i,"pointAlongEdge",(function(){return B}));var c={};e.r(c),e.d(c,"fromApi",(function(){return J}));var u={};e.r(u),e.d(u,"fromMazeData",(function(){return Y})),e.d(u,"canWalk",(function(){return F}));var d={};e.r(d),e.d(d,"isLoading",(function(){return Z})),e.d(d,"isLoaded",(function(){return q})),e.d(d,"isErrored",(function(){return X})),e.d(d,"loading",(function(){return $})),e.d(d,"loaded",(function(){return tt})),e.d(d,"errored",(function(){return nt})),e.d(d,"map",(function(){return et}));var s={};e.r(s),e.d(s,"create",(function(){return at}));var f={};e.r(f),e.d(f,"create",(function(){return ot}));var l={};e.r(l),e.d(l,"getColor",(function(){return it})),e.d(l,"getDisplayName",(function(){return ct})),e.d(l,"generateAiInstructions",(function(){return ut}));var p={};e.r(p),e.d(p,"create",(function(){return st})),e.d(p,"next",(function(){return ft}));var m={};e.r(m),e.d(m,"create",(function(){return lt})),e.d(m,"toIndex",(function(){return pt})),e.d(m,"fromIndex",(function(){return mt})),e.d(m,"neighbor",(function(){return Et}));var E={};e.r(E),e.d(E,"create",(function(){return vt}));var v={};e.r(v),e.d(v,"fromEntities",(function(){return bt})),e.d(v,"entitiesAtPoint",(function(){return Ot})),e.d(v,"moveEntity",(function(){return ht})),e.d(v,"updateEntity",(function(){return gt}));var y={};e.r(y),e.d(y,"create",(function(){return Tt})),e.d(y,"displayGrid",(function(){return wt})),e.d(y,"generateAllAIInstructions",(function(){return Mt}));var b={};e.r(b),e.d(b,"create",(function(){return kt})),e.d(b,"validate",(function(){return jt})),e.d(b,"apply",(function(){return xt}));var O={};e.r(O),e.d(O,"create",(function(){return At})),e.d(O,"apply",(function(){return St}));var h={};e.r(h),e.d(h,"validate",(function(){return Dt})),e.d(h,"validateAll",(function(){return Nt})),e.d(h,"apply",(function(){return Rt})),e.d(h,"applyAll",(function(){return It})),e.d(h,"Move",(function(){return b})),e.d(h,"Update",(function(){return O}));var g={};e.r(g),e.d(g,"Direction",(function(){return _t})),e.d(g,"all",(function(){return Ut})),e.d(g,"inverse",(function(){return Lt}));var T={};e.r(T),e.d(T,"ok",(function(){return Wt})),e.d(T,"err",(function(){return Ht})),e.d(T,"isErr",(function(){return Gt})),e.d(T,"isOk",(function(){return zt})),e.d(T,"map",(function(){return Ct}));var w={};e.r(w),e.d(w,"of",(function(){return Qt})),e.d(w,"none",(function(){return Vt})),e.d(w,"withDefault",(function(){return Bt})),e.d(w,"map",(function(){return Jt})),e.d(w,"ifPresent",(function(){return Kt}));var M,_=e(1),k=e.n(_),j=e(17),x=e.n(j),A=e(29),S=e.n(A),D=e(30),N=e.n(D),R=e(19),I="https://fv9o21r19a.execute-api.us-east-1.amazonaws.com/dev",P=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.dimension,e=void 0===n?i.create(10,10):n,r=t.algorithm,a=void 0===r?"aldous-broder":r,o=fetch("".concat(I),{method:"post",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify({dimensions:e,algorithm:a})});return o.then((function(t){return t.text()})).then((function(t){return c.fromApi(e,t)}))},U=e(8),L=function(t,n){return new Array(t).fill(n)},W=function(t,n){var e=Object(U.a)(t);return e.sort(n),e},H=function(t){return t.filter((function(t){return null!=t}))},G=function(t){return t[Math.floor(Math.random()*t.length)]},z=function(t,n){return t+Math.floor(Math.random()*(n-t-1))},C=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{width:t,height:n}},Q=function(t){return t.width*t.height},V=function(t){return m.fromIndex(Math.floor(Math.random()*Q(t)),t)},B=function(t){var n=Math.random()>.5;return m.create(n?o.randomInRange(0,t.width):Math.random()>.5?0:t.width-1,n?Math.random()>.5?0:t.height-1:o.randomInRange(0,t.height))},J=function(t,n){return{bytes:Uint8Array.from(atob(n),(function(t){return t.charCodeAt(0)})),dimension:t}},K=function(t){return{walls:(n={n:!((8&t)>0),s:!((4&t)>0),e:!((2&t)>0),w:!((1&t)>0)},{n:n.n||!1,e:n.e||!1,s:n.s||!1,w:n.w||!1})};var n},Y=function(t){for(var n=t.dimension,e=t.bytes,r=[],a=0;a<n.height;a++){for(var o=[],i=0;i<n.width;i++)o.push(K(e[a*n.width+i]));r.push(o)}return{grid:r,dimension:n}},F=function(t,n,e){var r=n.x,a=n.y;return!function(t,n){var e=t.walls;switch(n){case g.Direction.NORTH:return e.n;case g.Direction.EAST:return e.e;case g.Direction.SOUTH:return e.s;case g.Direction.WEST:return e.w}}(t.grid[a][r],e)},Z=function(t){return"Loading"===t.state},q=function(t){return"Loaded"===t.state},X=function(t){return"Errored"===t.state},$=function(){return{state:"Loading"}},tt=function(t){return{state:"Loaded",data:t}},nt=function(t){return{state:"Errored",e:t}},et=function(t,n){return q(n)?tt(t(n.data)):n},rt=e(32),at=function(){return Object(rt.v4)()},ot=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.create();return{id:s.create(),name:t,position:n,type:"player"}},it=(e(27),function(t){switch(t.type){case"player":return"var(--blue)";default:return"var(--red)"}}),ct=function(t){switch(t.type){case"player":return t.name[0];default:return t.type[0]}},ut=function(t,n){switch(t.type){case"blind-guardian":return p.next(t,n);default:return[]}},dt=e(4),st=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.create();return{type:"blind-guardian",position:t,id:s.create(),heading:g.Direction.NORTH}},ft=function(t,n){var e,r=g.all().filter((function(e){return u.canWalk(n.maze,t.position,e)})),o=r.filter((function(n){return n!==g.inverse(t.heading)}));return e=r.includes(t.heading)&&Math.random()>.75?t.heading:Math.random()>.75&&o.length>0?a.randomItem(o):r[0],[h.Update.create(Object(dt.a)({},t,{heading:e})),h.Move.create(t.id,e)]},lt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{x:t,y:n}},pt=function(t,n){var e=t.x;return t.y*n.width+e},mt=function(t,n){var e=n.width;return lt(Math.floor(t/e),t%e)},Et=function(t,n){switch(n){case"NORTH":return m.create(t.x,t.y-1);case"SOUTH":return m.create(t.x,t.y+1);case"EAST":return m.create(t.x+1,t.y);case"WEST":default:return m.create(t.x-1,t.y)}},vt=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return{instructions:n,id:s.create()}},yt=e(12),bt=function(t,n){return{entityMap:t.reduce((function(t,n){return t[n.id]=n,t}),{}),positionMap:t.reduce((function(t,e){var r=m.toIndex(e.position,n);return t[r]=t[r]?[].concat(Object(U.a)(t[r]),[e.id]):[e.id],t}),{}),playerEntityId:w.map((function(t){return t.id}),t.find((function(t){return"player"===t.type}))),typeMap:t.reduce((function(t,n){return Object(dt.a)({},t,Object(yt.a)({},n.type,t[n.id]?[].concat(Object(U.a)(t[n.id]),[n.id]):[n.id]))}),{})}},Ot=function(t,n,e){var r=m.toIndex(n,e);return(t.positionMap[r]||[]).map((function(n){return t.entityMap[n]}))},ht=function(t,n,e,r){var a=n.entityMap[t];if(null!=a){var o,i=m.toIndex(a.position,r),c=m.toIndex(e,r),u=Object(dt.a)({},a,{position:e});return Object(dt.a)({},n,{entityMap:Object(dt.a)({},n.entityMap,Object(yt.a)({},t,u)),positionMap:Object(dt.a)({},n.positionMap,(o={},Object(yt.a)(o,i,Object(U.a)((n.positionMap[i]||[]).filter((function(n){return n!==t})))),Object(yt.a)(o,c,[].concat(Object(U.a)(n.positionMap[c]||[]),[t])),o))})}return n},gt=function(t,n){return Object(dt.a)({},n,{entityMap:Object(dt.a)({},n.entityMap,Object(yt.a)({},t.id,t))})},Tt=function(t,n){return{maze:t,entityData:n}},wt=function(t){var n=t.maze,e=t.entityData;return n.grid.reduce((function(t,r,a){return[].concat(Object(U.a)(t),[r.reduce((function(t,r,o){return t.concat({cell:r,occupants:v.entitiesAtPoint(e,m.create(o,a),n.dimension)})}),[])])}),[])},Mt=function(t){return Object.keys(t.entityData.entityMap).map((function(n){return t.entityData.entityMap[n]})).filter((function(t){return"player"!==t.type})).reduce((function(n,e){return n.concat(l.generateAiInstructions(e,t))}),[])};!function(t){t.MOVE="MOVE",t.UPDATE="UPDATE"}(M||(M={}));var _t,kt=function(t,n){return{type:M.MOVE,entityId:t,payload:{direction:n}}},jt=function(t,n){return u.canWalk(n.maze,n.entityData.entityMap[t.entityId].position,t.payload.direction)?T.ok(void 0):T.err("way is blocked")},xt=function(t,n){return Object(dt.a)({},n,{entityData:v.moveEntity(t.entityId,n.entityData,m.neighbor(n.entityData.entityMap[t.entityId].position,t.payload.direction),n.maze.dimension)})},At=function(t){return{type:M.UPDATE,entityId:t.id,payload:{updated:t}}},St=function(t,n){return Object(dt.a)({},n,{entityData:v.updateEntity(t.payload.updated,n.entityData)})},Dt=function(t,n){switch(t.type){case M.MOVE:return b.validate(t,n);default:return T.err("Unkown instruction of type ".concat(t.type))}},Nt=function(t,n){return t.reduce((function(t,e){return T.isOk(t)?Dt(e,n):t}),T.ok(void 0))},Rt=function(t,n){try{switch(t.type){case M.MOVE:return T.ok(b.apply(t,n));case M.UPDATE:return T.ok(O.apply(t,n))}}catch(e){return console.warn("Error applying instruction",t),console.error(e),T.err("Error applying instructions")}},It=function(t,n){return t.reduce((function(t,n){return T.isOk(t)?Rt(n,t.data):t}),T.ok(n))};!function(t){t.NORTH="NORTH",t.SOUTH="SOUTH",t.EAST="EAST",t.WEST="WEST"}(_t||(_t={}));var Pt,Ut=function(){return[_t.NORTH,_t.SOUTH,_t.EAST,_t.WEST]},Lt=function(t){switch(t){case _t.NORTH:return _t.SOUTH;case _t.SOUTH:return _t.NORTH;case _t.EAST:return _t.WEST;case _t.WEST:return _t.EAST}},Wt=function(t){return{type:"Ok",data:t}},Ht=function(t){return{type:"Error",msg:t}},Gt=function(t){return"Error"===t.type},zt=function(t){return"Ok"===t.type},Ct=function(t,n){return zt(n)?Wt(t(n.data)):n},Qt=(e(28),function(t){return t}),Vt=function(){},Bt=function(t,n){return null!=t?t:n},Jt=function(t,n){return null!=n?t(n):void 0},Kt=function(t,n){n&&t(n)},Yt=e(15),Ft=function(t){return t},Zt=Object(Yt.a)(Ft,(function(t){return t.game})),qt=Object(Yt.a)(Zt,(function(t){return d.map(y.displayGrid,t)})),Xt=Object(Yt.a)(Ft,(function(t){return null!=t.stepId})),$t=Object(Yt.a)(Zt,(function(t){return d.isLoaded(t)?w.map((function(n){return t.data.entityData.entityMap[n]}),t.data.entityData.playerEntityId):void 0})),tn=e(33),nn=e.n(tn),en=e(34),rn=e.n(en),an=function(t){return k.a.createElement("div",{className:rn.a.root,style:{backgroundColor:l.getColor(t)}},l.getDisplayName(t))},on=function(t){return t?"0.5px solid black":"0.5px transparent"},cn=function(t){var n=t.cell,e=t.occupants,r=n.walls;return k.a.createElement("div",{className:nn.a.root,style:{borderTop:on(r.n),borderRight:on(r.e),borderBottom:on(r.s),borderLeft:on(r.w),height:"1.5rem",width:"1.5rem"}},w.map((function(t){return k.a.createElement(an,t)}),e[0]))},un=e(23),dn=e.n(un),sn=function(t){var n=t.grid;return k.a.createElement("div",{className:dn.a.root},n.map((function(t,n){return k.a.createElement("div",{key:n,className:dn.a.row},t.map((function(t,n){return k.a.createElement(cn,{key:n,cell:t.cell,occupants:t.occupants})})))})))},fn=e(6),ln=e.n(fn),pn=e(16),mn=e.n(pn),En=function(t){var n=t.onMove;return k.a.createElement("div",{className:ln.a.root},k.a.createElement("div",{className:ln.a.row},k.a.createElement("div",{className:ln.a.block}),k.a.createElement("button",{className:mn()(ln.a.block,ln.a.button),onClick:function(){return n(g.Direction.NORTH)}}),k.a.createElement("div",{className:ln.a.block})),k.a.createElement("div",{className:ln.a.row},k.a.createElement("button",{className:mn()(ln.a.block,ln.a.button),onClick:function(){return n(g.Direction.WEST)}}),k.a.createElement("div",{className:ln.a.block}),k.a.createElement("button",{className:mn()(ln.a.block,ln.a.button),onClick:function(){return n(g.Direction.EAST)}})),k.a.createElement("div",{className:ln.a.row},k.a.createElement("div",{className:ln.a.block}),k.a.createElement("button",{className:mn()(ln.a.block,ln.a.button),onClick:function(){return n(g.Direction.SOUTH)}}),k.a.createElement("div",{className:ln.a.block})))},vn=e(35),yn=e(36),bn=e(39),On=e(37),hn=e(40),gn=function(t){function n(){var t,e;Object(vn.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=Object(bn.a)(this,(t=Object(On.a)(n)).call.apply(t,[this].concat(a)))).handleKeyDown=function(t){e.props.disabled||("ArrowUp"===t.key||"w"===t.key?e.props.onMove(g.Direction.NORTH):"ArrowRight"===t.key||"d"===t.key?e.props.onMove(g.Direction.EAST):"ArrowDown"===t.key||"d"===t.key?e.props.onMove(g.Direction.SOUTH):"ArrowLeft"!==t.key&&"a"!==t.key||e.props.onMove(g.Direction.WEST))},e}return Object(hn.a)(n,t),Object(yn.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleKeyDown)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){return _.createElement(_.Fragment,null)}}]),n}(_.PureComponent),Tn=function(t){var n=t.grid,e=t.onMove,r=t.processingUpdates;return _.createElement(_.Fragment,null,_.createElement(sn,{grid:n}),_.createElement(En,{onMove:e}),_.createElement(gn,{onMove:e,disabled:r}))};!function(t){t.REQUEST_NEW_GAME="REQUEST_NEW_GAME",t.START_NEW_GAME="START_NEW_GAME",t.REQUEST_STEP="REQUEST_STEP",t.COMPLETE_STEP="COMPLETE_STEP",t.ABORT_STEP="ABORT_STEP",t.MOVE_PLAYER="MOVE_PLAYER"}(Pt||(Pt={}));var wn=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:Pt.REQUEST_NEW_GAME,options:t}},Mn=function(t,n){return{type:Pt.START_NEW_GAME,maze:t,entities:n}},_n=function(t){return{type:Pt.ABORT_STEP,stepId:t}},kn=function(t,n){return{type:Pt.COMPLETE_STEP,stepId:t,gameData:n}},jn=Object(R.b)((function(t){return{grid:qt(t),processingUpdates:Xt(t)}}),(function(t){return{onMove:function(n){return t((e=n,{type:Pt.MOVE_PLAYER,direction:e}));var e}}}))((function(t){var n=t.grid,e=t.processingUpdates,r=t.onMove;return k.a.createElement("div",{className:N.a.root},d.isLoading(n)&&k.a.createElement("span",null,"Loading . . . "),d.isLoaded(n)&&k.a.createElement(Tn,{processingUpdates:e,grid:n.data,onMove:r}))})),xn=e(13),An=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(dt.a)({game:d.loading()},t)},Sn=function(t){return Object(dt.a)({},t,{game:d.loading()})},Dn=function(t,n,e){return Object(dt.a)({},t,{game:d.loaded(y.create(n,v.fromEntities(e,n.dimension)))})},Nn=function(t,n){return Object(dt.a)({},t,{stepId:n})},Rn=function(t,n,e){return function(t,n){return d.isLoaded(n.game)?t():n}((function(){return t.stepId===n?Object(dt.a)({},t,{stepId:void 0,game:d.loaded(e)}):t}),t)},In=function(t,n){return t.stepId===n?Object(dt.a)({},t,{stepId:void 0}):t},Pn=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:An(),n=arguments.length>1?arguments[1]:void 0;switch(n.type){case Pt.REQUEST_STEP:return Nn(t,n.step.id);case Pt.COMPLETE_STEP:return Rn(t,n.stepId,n.gameData);case Pt.ABORT_STEP:return In(t,n.stepId);case Pt.START_NEW_GAME:return Dn(t,n.maze,n.entities);case Pt.REQUEST_NEW_GAME:return Sn(t);default:return t}},Un=e(38),Ln=e(9),Wn=e.n(Ln),Hn=e(5),Gn=Wn.a.mark(zn);function zn(){var t,n,e,r,a,o,i,c;return Wn.a.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=1,u.next=4,Object(Hn.f)(Pt.REQUEST_STEP);case 4:return t=u.sent,n=t.step,u.next=8,Object(Hn.d)(Zt);case 8:if(e=u.sent,!d.isLoaded(e)){u.next=29;break}return r=e.data,u.next=13,Object(Hn.b)(h.validateAll,n.instructions,r);case 13:if(a=u.sent,!T.isErr(a)){u.next=18;break}return u.next=17,Object(Hn.c)(_n(n.id));case 17:return u.abrupt("continue",0);case 18:return o=y.generateAllAIInstructions(r),i=[].concat(Object(U.a)(o),Object(U.a)(n.instructions)),u.next=22,Object(Hn.b)(h.applyAll,i,r);case 22:if(c=u.sent,!T.isErr(c)){u.next=27;break}return u.next=26,Object(Hn.c)(_n(n.id));case 26:return u.abrupt("continue",0);case 27:return u.next=29,Object(Hn.c)(kn(n.id,c.data));case 29:u.next=35;break;case 31:u.prev=31,u.t0=u.catch(1),console.warn("Error processing step"),console.error(u.t0);case 35:u.next=0;break;case 37:case"end":return u.stop()}}),Gn,null,[[1,31]])}var Cn=Wn.a.mark(Qn);function Qn(){return Wn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Hn.g)(Pt.MOVE_PLAYER,Wn.a.mark((function t(n){var e;return Wn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Hn.d)($t);case 2:return e=t.sent,t.next=5,Object(Hn.d)(Xt);case 5:if(t.sent||!e){t.next=9;break}return t.next=9,Object(Hn.c)((r=E.create(h.Move.create(e.id,n.direction)),{type:Pt.REQUEST_STEP,step:r}));case 9:case"end":return t.stop()}var r}),t)})));case 2:case"end":return t.stop()}}),Cn)}var Vn=Wn.a.mark(Bn);function Bn(){var t,n,e,a;return Wn.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=1,o.next=4,Object(Hn.f)(Pt.REQUEST_NEW_GAME);case 4:return t=o.sent,n=t.options,o.next=8,Object(Hn.b)(r.maze,n.mazeOptions||{});case 8:return e=o.sent,a=u.fromMazeData(e),o.next=12,Object(Hn.c)(Mn(a,Jn(a)));case 12:o.next=18;break;case 14:o.prev=14,o.t0=o.catch(1),console.warn("Error initializing new game"),console.error(o.t0);case 18:o.next=0;break;case 20:case"end":return o.stop()}}),Vn,null,[[1,14]])}var Jn=function(t){var n=f.create("Test",i.pointAlongEdge(t.dimension)),e=new Array(o.randomInRange(1,5)).fill(void 0).map((function(n){return p.create(i.randomPoint(t.dimension))}));return[n].concat(Object(U.a)(e))},Kn=Wn.a.mark(Fn),Yn=[Bn,zn,Qn];function Fn(){return Wn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Hn.a)(Yn.map((function(t){return Object(Hn.e)(t)})));case 2:return t.next=4,Object(Hn.c)(wn({mazeOptions:{dimension:i.create(15,15),algorithm:"aldous-broder"}}));case 4:case"end":return t.stop()}}),Kn)}x.a.render(k.a.createElement(R.a,{store:function(){var t=Object(Un.a)(),n=Object(xn.d)(Pn,Object(xn.a)(t));return t.run(Fn),n}()},k.a.createElement("div",{className:S.a.app},k.a.createElement(jn,null))),document.getElementById("root"))},6:function(t,n,e){t.exports={root:"GamePad_root__Lay6t",row:"GamePad_row__164Sm",block:"GamePad_block__l2_xd",button:"GamePad_button__3kDFo"}}},[[41,1,2]]]);
//# sourceMappingURL=main.9e8ccd3e.chunk.js.map